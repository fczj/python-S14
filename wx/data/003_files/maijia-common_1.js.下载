;/*!components/bootstrap-modal/modal.js*/
define('components/bootstrap-modal/modal', function(require, exports, module) {

  /* ========================================================================
   * Bootstrap: modal.js v3.3.4
   * http://getbootstrap.com/javascript/#modals
   * ========================================================================
   * Copyright 2011-2015 Twitter, Inc.
   * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
   * ======================================================================== */
  var jQuery = require('components/jquery/jquery');
  var css = ".fade {\r\n  opacity: 0;\r\n  -webkit-transition: opacity .15s linear;\r\n       -o-transition: opacity .15s linear;\r\n          transition: opacity .15s linear;\r\n}\r\n.fade.in {\r\n  opacity: 1;\r\n}\r\n.modal-open {\r\n  overflow: hidden;\r\n}\r\n\r\n.modal {\r\n  position: fixed;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  z-index: 1050;\r\n  display: none;\r\n  overflow: hidden;\r\n  -webkit-overflow-scrolling: touch;\r\n  outline: 0;\r\n}\r\n.modal.fade .modal-dialog {\r\n  -webkit-transition: -webkit-transform .3s ease-out;\r\n       -o-transition:      -o-transform .3s ease-out;\r\n          transition:         transform .3s ease-out;\r\n  -webkit-transform: translate(0, -25%);\r\n      -ms-transform: translate(0, -25%);\r\n       -o-transform: translate(0, -25%);\r\n          transform: translate(0, -25%);\r\n}\r\n.modal.in .modal-dialog {\r\n  -webkit-transform: translate(0, 0);\r\n      -ms-transform: translate(0, 0);\r\n       -o-transform: translate(0, 0);\r\n          transform: translate(0, 0);\r\n}\r\n.modal-open .modal {\r\n  overflow-x: hidden;\r\n  overflow-y: auto;\r\n}\r\n.modal-dialog {\r\n  position: relative;\r\n  width: auto;\r\n  margin: 10px;\r\n}\r\n.modal-content {\r\n  position: relative;\r\n  background-color: #fff;\r\n  -webkit-background-clip: padding-box;\r\n          background-clip: padding-box;\r\n  border: 1px solid #999;\r\n  border: 1px solid rgba(0, 0, 0, .2);\r\n  border-radius: 6px;\r\n  outline: 0;\r\n  -webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, .5);\r\n          box-shadow: 0 3px 9px rgba(0, 0, 0, .5);\r\n}\r\n.modal-backdrop {\r\n  position: fixed;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  z-index: 1040;\r\n  background-color: #000;\r\n}\r\n.modal-backdrop.fade {\r\n  filter: alpha(opacity=0);\r\n  opacity: 0;\r\n}\r\n.modal-backdrop.in {\r\n  filter: alpha(opacity=50);\r\n  opacity: .5;\r\n}\r\n.modal-header {\r\n  min-height: 16.42857143px;\r\n  padding: 15px;\r\n  border-bottom: 1px solid #e5e5e5;\r\n}\r\n.modal-header .close {\r\n  margin-top: -2px;\r\n}\r\n.modal-title {\r\n  margin: 0;\r\n  line-height: 1.42857143;\r\n}\r\n.modal-body {\r\n  position: relative;\r\n  padding: 15px;\r\n}\r\n.modal-footer {\r\n  padding: 15px;\r\n  text-align: right;\r\n  border-top: 1px solid #e5e5e5;\r\n}\r\n.modal-footer .btn + .btn {\r\n  margin-bottom: 0;\r\n  margin-left: 5px;\r\n}\r\n.modal-footer .btn-group .btn + .btn {\r\n  margin-left: -1px;\r\n}\r\n.modal-footer .btn-block + .btn-block {\r\n  margin-left: 0;\r\n}\r\n.modal-scrollbar-measure {\r\n  position: absolute;\r\n  top: -9999px;\r\n  width: 50px;\r\n  height: 50px;\r\n  overflow: scroll;\r\n}\r\n@media (min-width: 768px) {\r\n  .modal-dialog {\r\n    width: 600px;\r\n    margin: 30px auto;\r\n  }\r\n  .modal-content {\r\n    -webkit-box-shadow: 0 5px 15px rgba(0, 0, 0, .5);\r\n            box-shadow: 0 5px 15px rgba(0, 0, 0, .5);\r\n  }\r\n  .modal-sm {\r\n    width: 300px;\r\n  }\r\n}\r\n@media (min-width: 992px) {\r\n  .modal-lg {\r\n    width: 900px;\r\n  }\r\n}"; 
  jQuery('<style id="bootstrap-modal">'+css+'</style>').appendTo(jQuery('head'));
  
  +function ($) {
    'use strict';
  
    // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
    // ============================================================
  
    function transitionEnd() {
      var el = document.createElement('bootstrap')
  
      var transEndEventNames = {
        WebkitTransition : 'webkitTransitionEnd',
        MozTransition    : 'transitionend',
        OTransition      : 'oTransitionEnd otransitionend',
        transition       : 'transitionend'
      }
  
      for (var name in transEndEventNames) {
        if (el.style[name] !== undefined) {
          return { end: transEndEventNames[name] }
        }
      }
  
      return false // explicit for ie8 (  ._.)
    }
  
    // http://blog.alexmaccaw.com/css-transitions
    $.fn.emulateTransitionEnd = function (duration) {
      var called = false
      var $el = this
      $(this).one('bsTransitionEnd', function () { called = true })
      var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
      setTimeout(callback, duration)
      return this
    }
  
    $(function () {
      $.support.transition = transitionEnd()
  
      if (!$.support.transition) return
  
      $.event.special.bsTransitionEnd = {
        bindType: $.support.transition.end,
        delegateType: $.support.transition.end,
        handle: function (e) {
          if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
        }
      }
    })
  
  }(jQuery);
  
  +function ($) {
    'use strict';
  
    // MODAL CLASS DEFINITION
    // ======================
  
    var Modal = function (element, options) {
      this.options             = options
      this.$body               = $(document.body)
      this.$element            = $(element)
      this.$dialog             = this.$element.find('.modal-dialog')
      this.$backdrop           = null
      this.isShown             = null
      this.originalBodyPad     = null
      this.scrollbarWidth      = 0
      this.ignoreBackdropClick = false
  
      if (this.options.remote) {
        this.$element
          .find('.modal-content')
          .load(this.options.remote, $.proxy(function () {
            this.$element.trigger('loaded.bs.modal')
          }, this))
      }
    }
  
    Modal.VERSION  = '3.3.4'
  
    Modal.TRANSITION_DURATION = 300
    Modal.BACKDROP_TRANSITION_DURATION = 150
  
    Modal.DEFAULTS = {
      backdrop: true,
      keyboard: true,
      show: true
    }
  
    Modal.prototype.toggle = function (_relatedTarget) {
      return this.isShown ? this.hide() : this.show(_relatedTarget)
    }
  
    Modal.prototype.show = function (_relatedTarget) {
      var that = this
      var e    = $.Event('show.bs.modal', { relatedTarget: _relatedTarget })
  
      this.$element.trigger(e)
  
      if (this.isShown || e.isDefaultPrevented()) return
  
      this.isShown = true
  
      this.checkScrollbar()
      this.setScrollbar()
      this.$body.addClass('modal-open')
  
      this.escape()
      this.resize()
  
      this.$element.on('click.dismiss.bs.modal', '[data-dismiss="modal"]', $.proxy(this.hide, this))
  
      this.$dialog.on('mousedown.dismiss.bs.modal', function () {
        that.$element.one('mouseup.dismiss.bs.modal', function (e) {
          if ($(e.target).is(that.$element)) that.ignoreBackdropClick = true
        })
      })
  
      this.backdrop(function () {
        var transition = $.support.transition && that.$element.hasClass('fade')
  
        if (!that.$element.parent().length) {
          that.$element.appendTo(that.$body) // don't move modals dom position
        }
  
        that.$element
          .show()
          .scrollTop(0)
  
        that.adjustDialog()
  
        if (transition) {
          that.$element[0].offsetWidth // force reflow
        }
  
        that.$element
          .addClass('in')
          .attr('aria-hidden', false)
  
        that.enforceFocus()
  
        var e = $.Event('shown.bs.modal', { relatedTarget: _relatedTarget })
  
        transition ?
          that.$dialog // wait for modal to slide in
            .one('bsTransitionEnd', function () {
              that.$element.trigger('focus').trigger(e)
            })
            .emulateTransitionEnd(Modal.TRANSITION_DURATION) :
          that.$element.trigger('focus').trigger(e)
      })
    }
  
    Modal.prototype.hide = function (e) {
      if (e) e.preventDefault()
  
      e = $.Event('hide.bs.modal')
  
      this.$element.trigger(e)
  
      if (!this.isShown || e.isDefaultPrevented()) return
  
      this.isShown = false
  
      this.escape()
      this.resize()
  
      $(document).off('focusin.bs.modal')
  
      this.$element
        .removeClass('in')
        .attr('aria-hidden', true)
        .off('click.dismiss.bs.modal')
        .off('mouseup.dismiss.bs.modal')
  
      this.$dialog.off('mousedown.dismiss.bs.modal')
  
      $.support.transition && this.$element.hasClass('fade') ?
        this.$element
          .one('bsTransitionEnd', $.proxy(this.hideModal, this))
          .emulateTransitionEnd(Modal.TRANSITION_DURATION) :
        this.hideModal()
    }
  
    Modal.prototype.enforceFocus = function () {
      $(document)
        .off('focusin.bs.modal') // guard against infinite focus loop
        .on('focusin.bs.modal', $.proxy(function (e) {
          if (this.$element[0] !== e.target && !this.$element.has(e.target).length) {
            this.$element.trigger('focus')
          }
        }, this))
    }
  
    Modal.prototype.escape = function () {
      if (this.isShown && this.options.keyboard) {
        this.$element.on('keydown.dismiss.bs.modal', $.proxy(function (e) {
          e.which == 27 && this.hide()
        }, this))
      } else if (!this.isShown) {
        this.$element.off('keydown.dismiss.bs.modal')
      }
    }
  
    Modal.prototype.resize = function () {
      if (this.isShown) {
        $(window).on('resize.bs.modal', $.proxy(this.handleUpdate, this))
      } else {
        $(window).off('resize.bs.modal')
      }
    }
  
    Modal.prototype.hideModal = function () {
      var that = this
      this.$element.hide()
      this.backdrop(function () {
        that.$body.removeClass('modal-open')
        that.resetAdjustments()
        that.resetScrollbar()
        that.$element.trigger('hidden.bs.modal')
      })
    }
  
    Modal.prototype.removeBackdrop = function () {
      this.$backdrop && this.$backdrop.remove()
      this.$backdrop = null
    }
  
    Modal.prototype.backdrop = function (callback) {
      var that = this
      var animate = this.$element.hasClass('fade') ? 'fade' : ''
  
      if (this.isShown && this.options.backdrop) {
        var doAnimate = $.support.transition && animate
  
        this.$backdrop = $('<div class="modal-backdrop ' + animate + '" />')
          .appendTo(this.$body)
  
        this.$element.on('click.dismiss.bs.modal', $.proxy(function (e) {
          if (this.ignoreBackdropClick) {
            this.ignoreBackdropClick = false
            return
          }
          if (e.target !== e.currentTarget) return
          this.options.backdrop == 'static'
            ? this.$element[0].focus()
            : this.hide()
        }, this))
  
        if (doAnimate) this.$backdrop[0].offsetWidth // force reflow
  
        this.$backdrop.addClass('in')
  
        if (!callback) return
  
        doAnimate ?
          this.$backdrop
            .one('bsTransitionEnd', callback)
            .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :
          callback()
  
      } else if (!this.isShown && this.$backdrop) {
        this.$backdrop.removeClass('in')
  
        var callbackRemove = function () {
          that.removeBackdrop()
          callback && callback()
        }
        $.support.transition && this.$element.hasClass('fade') ?
          this.$backdrop
            .one('bsTransitionEnd', callbackRemove)
            .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :
          callbackRemove()
  
      } else if (callback) {
        callback()
      }
    }
  
    // these following methods are used to handle overflowing modals
  
    Modal.prototype.handleUpdate = function () {
      this.adjustDialog()
    }
  
    Modal.prototype.adjustDialog = function () {
      var modalIsOverflowing = this.$element[0].scrollHeight > document.documentElement.clientHeight
  
      this.$element.css({
        paddingLeft:  !this.bodyIsOverflowing && modalIsOverflowing ? this.scrollbarWidth : '',
        paddingRight: this.bodyIsOverflowing && !modalIsOverflowing ? this.scrollbarWidth : ''
      })
    }
  
    Modal.prototype.resetAdjustments = function () {
      this.$element.css({
        paddingLeft: '',
        paddingRight: ''
      })
    }
  
    Modal.prototype.checkScrollbar = function () {
      var fullWindowWidth = window.innerWidth
      if (!fullWindowWidth) { // workaround for missing window.innerWidth in IE8
        var documentElementRect = document.documentElement.getBoundingClientRect()
        fullWindowWidth = documentElementRect.right - Math.abs(documentElementRect.left)
      }
      this.bodyIsOverflowing = document.body.clientWidth < fullWindowWidth
      this.scrollbarWidth = this.measureScrollbar()
    }
  
    Modal.prototype.setScrollbar = function () {
      var bodyPad = parseInt((this.$body.css('padding-right') || 0), 10)
      this.originalBodyPad = document.body.style.paddingRight || ''
      if (this.bodyIsOverflowing) this.$body.css('padding-right', bodyPad + this.scrollbarWidth)
    }
  
    Modal.prototype.resetScrollbar = function () {
      this.$body.css('padding-right', this.originalBodyPad)
    }
  
    Modal.prototype.measureScrollbar = function () { // thx walsh
      var scrollDiv = document.createElement('div')
      scrollDiv.className = 'modal-scrollbar-measure'
      this.$body.append(scrollDiv)
      var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth
      this.$body[0].removeChild(scrollDiv)
      return scrollbarWidth
    }
  
  
    // MODAL PLUGIN DEFINITION
    // =======================
  
    function Plugin(option, _relatedTarget) {
      return this.each(function () {
        var $this   = $(this)
        var data    = $this.data('bs.modal')
        var options = $.extend({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)
  
        if (!data) $this.data('bs.modal', (data = new Modal(this, options)))
        if (typeof option == 'string') data[option](_relatedTarget)
        else if (options.show) data.show(_relatedTarget)
      })
    }
  
    var old = $.fn.modal
  
    $.fn.modal             = Plugin
    $.fn.modal.Constructor = Modal
  
  
    // MODAL NO CONFLICT
    // =================
  
    $.fn.modal.noConflict = function () {
      $.fn.modal = old
      return this
    }
  
  
    // MODAL DATA-API
    // ==============
  
    $(document).on('click.bs.modal.data-api', '[data-toggle="modal"]', function (e) {
      var $this   = $(this)
      var href    = $this.attr('href')
      var $target = $($this.attr('data-target') || (href && href.replace(/.*(?=#[^\s]+$)/, ''))) // strip for ie7
      var option  = $target.data('bs.modal') ? 'toggle' : $.extend({ remote: !/#/.test(href) && href }, $target.data(), $this.data())
  
      if ($this.is('a')) e.preventDefault()
  
      $target.one('show.bs.modal', function (showEvent) {
        if (showEvent.isDefaultPrevented()) return // only register focus restorer if modal will actually get shown
        $target.one('hidden.bs.modal', function () {
          $this.is(':visible') && $this.trigger('focus')
        })
      })
      Plugin.call($target, option, this)
    })
  
  }(jQuery);
  

});

;/*!components/maijia-clickpoint/index.js*/
define('components/maijia-clickpoint/index', function(require, exports, module) {

  module.exports = (function(RC, $) {
      if(!RC) return;
      var $ = $ || require('components/jquery/jquery'),
          rc = RC || window.Tatami,
          rce = rc.events,
          rcp = rc.pages,
          req = rc.request,
          rcu_date = rc.util.date;
      rc.modules.define({
          methodsMap: {
              /**
               *
               * @param {htmlElement} curNode	当前点击的元素
               * 判断是否该元素的class符合我们的需求
               */
              _isMatchClass: function(curNode) {
                  var reg = RegExp('\\b' + this.getMdulData('_markClassName'));
                  if (reg.test(curNode.className)) {
                      return curNode;
                  }
                  var _target = curNode;
                  while (_target !== document.body && !reg.test(_target.className) && _target !== null) {
                      _target = _target.parentNode;
                      if (!_target) {
                          return false;
                      }
                      if (reg.test(_target.className)) {
                          return _target;
                      }
                  }
                  return false;
              },
  
              _getEleKey: function(ele){
                  var _markClassName = this.getMdulData('_markClassName');
                  var classes = ele.className.split(' ');
                  for (var i = 0; i < classes.length; i++) {
                      if(classes[i].indexOf(_markClassName) > -1){
                          // return classes[i].split(_markClassName)[1];
                          return classes[i + 1]
                      }
                  }
                  return false;
              },
  
              /**
               * @param {Object} params	从捕获的元素节点上拿到到数据
               * 用于和规则匹配之后，传递我们需要传递到内容
               *
               */
              _pubParams: function(params) {
                  // 简单直接派发point 和 其他
                  if (!params.ruleMapping) {
                      this.getMethod('_directPub', params);
                      return;
                  }
                  var json;
                  try {
                      json = JSON.parse(params.ruleMapping);
                  } catch (e) {
                      try {
                          json = eval('(' + params.ruleMapping + ')');
                      } catch (e) {}
                  }
                  if (!json) {
                      return;
                  }
  
                  var np;
                  // byuser
                  if (params.type === 'byuser' && params.result !== undefined && json[params.result] && (np = this.getMethod('_filterPoint', json[params.result]))) {
                      this.getMethod('_directPub', np);
                      return;
                  }
                  // byhashs
                  this.getMethod('_followHashs', json);
              },
  
  
              /**
               * @param {Object} json
               * 如果是依托hash来处理，那么这里可以看目前的hash结构来做相应的处理
               */
              _followHashs: function(json) {
                  var funcIsMatch = rcp.getHashKey,
                      localHashs = this.getMdulData('_curHashObj'),
                      funcCheck = !localHashs ? function(key, value) {
                          return funcIsMatch[key] == value;
                      } : function(key, value) {
                          return localHashs[key] == value;
                      },
                      i;
                  var isMatch, j, nj, he, it, se;
                  for (i in json) {
                      he = i.split('&');
                      j = 0;
                      nj = he.length;
                      isMatch = true;
                      for (; j < nj; j++) {
                          it = he[j].split('=');
                          if (!funcCheck(it[0], it[1])) {
                              isMatch = false;
                              break;
                          }
                      }
                      if (isMatch && (se = this.getMethod('_filterPoint', json[i]))) {
                          this.getMethod('_directPub', se);
                          break;
                      }
                  }
  
              },
  
              _filterPoint: function(strObj) {
                  if (!strObj) {
                      return false;
                  }
                  var re = {},
                      he, it;
                  strObj = strObj.split('&');
                  if (!strObj.length) {
                      return false;
                  }
                  he = strObj.pop();
                  while (he) {
                      it = he.split('=');
                      re[it[0]] = it[1];
                      he = strObj.pop();
                  }
                  // 必须含有point和_fm信息
                  // @yanjunqiang
                  // 配置了fm 才必须有fm
                  if (!re['point']) {
                      return false;
                  }
                  return re;
              },
  
              /**
               * @param {Object} params	从捕获的元素节点上拿到到数据
               * 直接把数据发出
               */
              _directPub: function(params) {
                var img = new Image(),
                  keyMap = {
                    app_type: 'url_tj',
                    log_type: 'click',
                    taobaoNick: window.SysUserInfo && window.SysUserInfo.nick || '',
                    point: ''
                  };
                  var queryStr;
                  params.rad = Math.random();
                  queryStr = $.param($.extend({}, keyMap, params));
                  img.onload = function () {
                    img = null
                  }
                  img.src = '//ftj.superboss.cc/tj.jpg?' + queryStr
  
                  // var $body = $('body'),
                  //     $img = $('<img style="position:absolute;bottom:0;left:-100px;width:0;height:0;" />'),
                  //     keyMap = {
                  //         app_type: 'url_tj',
                  //         log_type: 'click',
                  //         taobaoNick: window.SysUserInfo && window.SysUserInfo.nick || '',
                  //         point: ''
                  //     };
                  //
                  // var queryStr;
                  // params.rad = Math.random();
                  // queryStr = $.param($.extend({}, keyMap, params));
                  // $img.attr('src', '//ftj.superboss.cc/tj.jpg?' + queryStr);
                  // $img.on('load', function() {
                  //     $img.remove();
                  // });
                  // $body.append($img);
              },
              _submitData: function(){
                  var hashs = window.location.hash;
                  var path = hashs.replace(/^\#/, '');
                  var pathLastX = path.lastIndexOf('/');
                  path = path.slice(0, pathLastX) + path.slice(pathLastX + 1, path.length);
                  req.forceCall({
                      dataType: 'form',
                      requestAddr: '//log.superboss.cc/spalog',
                      method: 'post',
                      data: {
                          taobaoId: window.SysUserInfo && window.SysUserInfo.id || '',
                          taobaoNick: window.SysUserInfo && window.SysUserInfo.nick || '',
                          apptype: 'qn_wd_data_mobile',
                          action: 'pageChangeCapture',
                          time: rcu_date.getdate(new Date(), 'YY-MM-DD HH:MM:SS'),
                          path: path,
                          domain: window.location.host
                      }
                  }, function(){
                      console.log('log success');
                  });
              }
          },
          events: {
              /**
               *
               * @param {Object} evtObj
               * 接受来自框架的全局点击事件
               */
              'EVENTS.DOCCLICK': function(evtObj) {
                  if (!evtObj || !evtObj.target) {
                      return;
                  }
                  var clickElm = this.getMethod('_isMatchClass', evtObj.target),
                      params;
  
                  if (clickElm) {
                      var key = this.getMethod('_getEleKey', clickElm);
                      if(key){
                          params = this.getMdulData('_pointConfig')[key] || {};
                          if (!params.point) {
                              return;
                          }
                          this.getMethod('_pubParams', params);
                      }
                      // // 需要获得该节点的一些属性
                      // params = this.getMethod('_filterPoint', clickElm.getAttribute('data-clickData-points')) || {}
  
                      // // 如是需要通过hashs或者功能来调整的传输数据，采用此模式。
                      // if (clickElm.getAttribute('data-clickData-type')) {
                      //     params.type = clickElm.getAttribute('data-clickData-type');
                      // }
                      // // 规则部分，默认为基于内容
                      // if (clickElm.getAttribute('data-clickData-rulesMap')) {
                      //     params.ruleMapping = clickElm.getAttribute('data-clickData-rulesMap');
                      // }
                      // // 在type 为byuser，并且存在rulesMap的情况下可用
                      // if (clickElm.getAttribute('data-clickData-result')) {
                      //     params.result = clickElm.getAttribute('data-clickData-result');
                      // }
  
                      // @yanjunqiang
                      // 配置了fm 才必须有fm
                      // 必须有point
  
                  }
              },
  
              /**
               * @param {Object} hashs
               * 来自框架的hashchange 事件，我们用于收集整理数据。
               */
              'EVENTS.HASHCHANGE': function(href) {
              },
  
              // 每次hash发生改变
              'PAGES.HASHCHANGE': function(hashs){
                  this.setMdulData('_curHashObj', hashs || {});
              },
              // root、app、classification发生改变
              'PAGES.PAGECHANGE': function(hashs){
                  console.log(hashs);
                  this.getMethod('_submitData', hashs);
              },
              /**
               * 手动触发打点
               * @param  {[type]} params [传入打点规则]
               * @return {[type]}        [description]
               */
              'Tatami.clickPoint.trigger': function(params) {
                  this.getMethod('_directPub', params);
              },
  
              /**
               * 手动触发配置项
               * @param  {[type]} key [传入配置项key值]
               * @return {[type]}     [description]
               */
              'Tatami.clickPoint.triggerKey': function(key){
                  key && this.getMethod('_pubParams', this.getMdulData('_pointConfig')[key] || {});
              },
              'Tatami.clickPoint.triggerPoint': function(point){
                  this.getMethod('_pubParams', {
                      point: point
                  });
              },
              'Tatami.MDUL_ACTIVED': function(hashs) {
                  // this.getMethod('_directPub', hashs);
              }
          },
          activation: function() {},
          name: 'clickPoint',
          type: 'basic',
          dataMap: {
              // 标记的class
              _markClassName: 'J-clickPoint',
              // 当前的hash对象
              _curHashObj: null,
  
              _pointConfig: {
  
                  // 历史成本-添加新成本
                  'click_tsj': {
                      point: '10888.10889'
                  },
                  // 首页
                  'click_tsj_industry': {
                      point: '10888.10889.10890'
                  },
                  'click_tsj_industry_wholeMarket': {
                      point: '10888.10889.10890.10935'
                  },
                  'click_tsj_industry_offTime': {
                      point: '10888.10889.10890.10938'
                  },
                  'click_tsj_industry_priceDistrib': {
                      point: '10888.10889.10890.10939'
                  },
                  'click_tsj_industry_hotWordRank': {
                      point: '10888.10889.10890.10940'
                  },
                  'click_tsj_industry_sellerAnalysis': {
                      point: '10888.10889.10890.10943'
                  },
                  'click_tsj_industry_hotBrandRank': {
                      point: '10888.10889.10890.10947'
                  },
                  'click_tsj_industry_hotStoreRank': {
                      point: '10888.10889.10890.10948'
                  },
                  'click_tsj_industry_hotGoodsRank': {
                      point: '10888.10889.10890.10949'
                  },
                  'click_tsj_industry_upGoodsRank': {
                      point: '10888.10889.10890.10950'
                  },
                  'click_tsj_industry_dealDistrib': {
                      point: '10888.10889.10890.10951'
                  },
                  'click_tsj_industry_dataExport': {
                      point: '10888.10889.10890.11028'
                  },
                  'click_tsj_store': {
                      point: '10888.10889.10891'
                  },
                  // 销售分析
                  'click_tsj_store_wholeStatus': {
                      point: '10888.10889.10891.10911'
                  },
                  // 利润统计
                  'click_tsj_store_dataDetail': {
                      point: '10888.10889.10891.10912'
                  },
                  'click_tsj_store_salesAnalysis': {
                      point: '10888.10889.10891.10913'
                  },
                  'click_tsj_store_goodsAnalysis': {
                      point: '10888.10889.10891.10917'
                  },
                  'click_tsj_store_marketing': {
                      point: '10888.10889.10891.10922'
                  },
                  'click_tsj_store_flowAnalysis': {
                      point: '10888.10889.10891.10930'
                  },
                  'click_tsj_store_titleDiagnosis': {
                      point: '10888.10889.10891.10933'
                  },
                  'click_tsj_store_buyerAnalysis': {
                      point: '10888.10889.10891.10934'
                  },
                  'click_tsj_store_dataExport': {
                      point: '10888.10889.10891.11029'
                  },
                  'click_tsj_goods': {
                      point: '10888.10889.10952'
                  },
                  'click_tsj_goods_wholeStatus': {
                      point: '10888.10889.10952.11050'
                  },
                  'click_tsj_goods_upAdjustment': {
                      point: '10888.10889.10952.11051'
                  },
                  'click_tsj_goods_upAdjustment_upAnalysis': {
                      point: '10888.10889.10952.11051.11054'
                  },
                  'click_tsj_goods_upAdjustment_renameFollow': {
                      point: '10888.10889.10952.11051.11055'
                  },
                  'click_tsj_goods_upAdjustment_adjustmentFollow': {
                      point: '10888.10889.10952.11051.11056'
                  },
                  'click_tsj_goods_marketing_ztc': {
                      point: '10888.10889.10952.11052.11057'
                  },
                  'click_tsj_goods_marketing_jhs': {
                      point: '10888.10889.10952.11052.11058'
                  },
                  'click_tsj_goods_marketing_tbk': {
                      point: '10888.10889.10952.11052.11059'
                  },
                  'click_tsj_goods_marketing_inAct': {
                      point: '10888.10889.10952.11052.11060'
                  },
                  'click_tsj_goods_marketing_outAct': {
                      point: '10888.10889.10952.11052.11061'
                  },
                  'click_tsj_goods_flowAnalysis': {
                      point: '10888.10889.10952.11053'
                  },
                  'click_tsj_chooseWords': {
                      point: '10888.10889.10953'
                  },
                  'click_tsj_chooseWords_storeDiagnose': {
                      point: '10888.10889.10953.10963'
                  },
                  'click_tsj_chooseWords_keywordsAnalysis': {
                      point: '10888.10889.10953.10964'
                  },
                  'click_tsj_chooseWords_soaredWordsRank': {
                      point: '10888.10889.10953.10965'
                  },
                  'click_tsj_chooseWords_directTrainPanWords': {
                      point: '10888.10889.10953.10966'
                  },
                  'click_tsj_chooseWords_directTrainPanWords_accurate': {
                      point: '10888.10889.10953.10966.10967'
                  },
                  'click_tsj_chooseWords_directTrainPanWords_wireless': {
                      point: '10888.10889.10953.10966.10968'
                  },
                  'click_tsj_chooseWords_dataExport': {
                      point: '10888.10889.10953.11030'
                  },
                  'click_tsj_goodsRank': {
                      point: '10888.10889.10954'
                  },
                  'click_tsj_titleDiagnosis': {
                      point: '10888.10889.10955'
                  },
                  'click_tsj_invisibleDowngrading': {
                      point: '10888.10889.10956'
                  },
  
                  // wish
                  'click_wish': {
                      point: '10888.10960'
                  },
                  'click_wish_wholePointSituation': {
                      point: '10888.10960.10969'
                  },
                  'click_wish_wholePointSituation_salesCondition': {
                      point: '10888.10960.10969.10979'
                  },
                  'click_wish_wholePointSituation_storeTrendency': {
                      point: '10888.10960.10969.10980'
                  },
                  'click_wish_wholePointSituation_productsTrendency': {
                      point: '10888.10960.10969.10981'
                  },
                  'click_wish_wholePointSituation_bestsellerProducts': {
                      point: '10888.10960.10969.10982'
                  },
                  'click_wish_wholePointSituation_buyerAnalysis': {
                      point: '10888.10960.10969.10983'
                  },
                  'click_wish_industryStatistics': {
                      point: '10888.10960.10970'
                  },
                  'click_wish_productStatistics': {
                      point: '10888.10960.10971'
                  },
                  'click_wish_productStatistics_productsSearch': {
                      point: '10888.10960.10971.10972'
                  },
                  'click_wish_productStatistics_productsBestsellerRank': {
                      point: '10888.10960.10971.10973'
                  },
                  'click_wish_productStatistics_productsSoaredRank': {
                      point: '10888.10960.10971.10974'
                  },
                  'click_wish_productStatistics_newProductsBestsellerRank': {
                      point: '10888.10960.10971.10975'
                  },
                  'click_wish_productStatistics_newProductsSoaredRank': {
                      point: '10888.10960.10971.10976'
                  },
                  'click_wish_productStatistics_newStoreProductsBestSellerRank': {
                      point: '10888.10960.10971.10977'
                  },
                  'click_wish_productStatistics_newStoreProductsSoaredRank': {
                      point: '10888.10960.10971.10978'
                  },
                  'click_wish_storeStatistics': {
                      point: '10888.10960.10984'
                  },
                  'click_wish_storeStatistics_storeSearch': {
                      point: '10888.10960.10984.10986'
                  },
                  'click_wish_storeStatistics_storeBestsellerRank': {
                      point: '10888.10960.10984.10987'
                  },
                  'click_wish_storeStatistics_storeSoaredRank': {
                      point: '10888.10960.10984.10988'
                  },
                  'click_wish_storeStatistics_newStoreBestsellerRank': {
                      point: '10888.10960.10984.10989'
                  },
                  'click_wish_storeStatistics_newStoreSoaredRank': {
                      point: '10888.10960.10984.10990'
                  },
                  'click_wish_labelStatistics': {
                      point: '10888.10960.10985'
                  },
                  'click_wish_labelStatistics_labelStatistics': {
                      point: '10888.10960.10985.10991'
                  },
                  'click_wish_labelStatistics_labelBestchoosed': {
                      point: '10888.10960.10985.10992'
                  },
                  'click_wish_toolsBox': {
                      point: '10888.10960.11023'
                  },
                  'click_wish_toolsBox_wishDuplicate': {
                      point: '10888.10960.11023.11024'
                  },
                  'click_wish_toolsBox_wishPlugin': {
                      point: '10888.10960.11023.11025'
                  },
                  'click_wish_dataExport': {
                      point: '10888.10960.11027'
                  },
                  'click_wish_search': {
                      point: '10888.10960.11033'
                  },
  
                  // ebay
                  'click_ebay': {
                      point: '10888.10961'
                  },
                  'click_ebay_productStatistics': {
                      point: '10888.10961.11010'
                  },
                  'click_ebay_productStatistics_wholeNetworkBestsellerProducts': {
                      point: '10888.10961.11010.11011'
                  },
                  'click_ebay_sellerStatistics': {
                      point: '10888.10961.11012'
                  },
                  'click_ebay_sellerStatistics_wholeNetworkBestsellers': {
                      point: '10888.10961.11012.11013'
                  },
                  'click_ebay_industryStatistics': {
                      point: '10888.10961.11014'
                  },
                  'click_ebay_industryStatistics_wholeMarketCondition': {
                      point: '10888.10961.11014.11015'
                  },
                  'click_ebay_industryStatistics_putawayTimeDistribution': {
                      point: '10888.10961.11014.11016'
                  },
                  'click_ebay_industryStatistics_transactionTimeDistribution': {
                      point: '10888.10961.11014.11017'
                  },
                  'click_ebay_industryStatistics_attributeTransactionDistribution': {
                      point: '10888.10961.11014.11018'
                  },
                  'click_ebay_industryStatistics_bestseller': {
                      point: '10888.10961.11014.11019'
                  },
                  'click_ebay_industryStatistics_bestsellerProducts': {
                      point: '10888.10961.11014.11020'
                  },
                  'click_ebay_titleOptimize': {
                      point: '10888.10961.11021'
                  },
                  'click_ebay_dataExport': {
                      point: '10888.10961.11022'
                  },
                  'click_ebay_search': {
                      point: '10888.10961.11031'
                  },
  
  
                  // amazon
                  'click_amazon': {
                      point: '10888.10962'
                  },
                  'click_amazon_productSearch': {
                      point: '10888.10962.10995'
                  },
                  'click_amazon_storeSearch': {
                      point: '10888.10962.10996'
                  },
                  'click_amazon_categoryStatistics': {
                      point: '10888.10962.10997'
                  },
                  'click_amazon_categoryStatistics_categoryBestseller': {
                      point: '10888.10962.10997.10998'
                  },
                  'click_amazon_categoryStatistics_categoryAnalysis': {
                      point: '10888.10962.10997.10999'
                  },
                  'click_amazon_toolsBox': {
                      point: '10888.10962.11005'
                  },
                  'click_amazon_toolsBox_freeKeywords': {
                      point: '10888.10962.11005.11006'
                  },
                  'click_amazon_toolsBox_costsCalculator': {
                      point: '10888.10962.11005.11007'
                  },
                  'click_amazon_toolsBox_brandSearch': {
                      point: '10888.10962.11005.11008'
                  },
                  'click_amazon_toolsBox_linkCreator': {
                      point: '10888.10962.11005.11009'
                  },
                  'click_amazon_search': {
                      point: '10888.10962.11032'
                  },
  
                  // 数据定制
                  'click_dataCustomization': {
                      point: '10888.10994'
                  },
  
              }
          }
      });
  })(window.Tatami, window.jQuery);
  

});

;/*!components/maijia-qq/qq.js*/
define('components/maijia-qq/qq', function(require, exports, module) {

  //api
  //https://id.b.qq.com/combo/account/bizqq/wpa/WPAOpenAPI.pdf
  var getScript = {
  	_callbackList: [],
  	_status: 0,
  	done: function(url, callback){
  		if(this._status === 2){
  			callback();
  		}else{
  			this._callbackList.push(callback);
  			if(this._status === 0){
  				var _this = this;
  				this._createScript(url, function(){
  					_this._status = 2;
  					_this._handleFunArr();
  				})
  				this._status = 1;
  			}
  		}
  	},
  	_handleFunArr: function(){
  		for(var i = 0,l = this._callbackList.length; i < l; i++){
  			this._callbackList[i]();
  		}
  		this._callbackList = [];
  	},
  	_createScript: function(src, func){
  		var script = document.createElement('script');
  	    script.async = "async";
  	    script.type = 'text/javascript';
  	    script.src = src;
  	    if (func) {
  	    	if ('onload' in script) {
  	            script.onload = func;
  	        } else {
  	            script.onreadystatechange = function() {
  	                if (this.readyState == 'loaded' || this.readyState == 'complete') {
  	                	func();
  	                }
  	            }
  	        }
  	    }
  	    document.getElementsByTagName("head")[0].appendChild( script );
  	}
  };
  
  var qq = {
  	bind: function(selectorId, groupId){
  		//   //wpa.b.qq.com/cgi/wpa.php
  		getScript.done('//wpa.b.qq.com/cgi/wpa.php', function(){
  			BizQQWPA.addCustom({aty: '2', a: groupId || '2', nameAccount: '800098528', selector: selectorId});
  		});
  	}
  };
  
  module.exports = qq;

});

;/*!components/maijia-footer/src/index.js*/
define('components/maijia-footer/src/index', function(require, exports, module) {

  var $ = require('components/jquery/jquery');
  $('style').each(function(inx,it){
  	if(it.innerHTML.indexOf('c-maijia-footer-2017')!=-1){
  		$(it).remove();
  	}
  });
  module.exports = {
  	init: function(){
          if(!!~window.location.href.indexOf('//www.taosj.com/')){
              var css = ".c-data-footer{background:#f9f9f9;border-top:1px solid #eee;font-family:\"PingFang SC\",arial;font-size:12px;line-height:20px;color:#777;padding:26px 0 20px}.c-data-footer .inner{width:1180px;margin:0 auto;text-align:center}.c-data-footer .links a{color:#777;text-decoration:none;padding:0 12px;margin:0;font-size:14px;font-family:微软雅黑}.c-data-footer .links a:hover{text-decoration:underline;color:#FD8944}.c-data-footer .links a+a{border-left:1px solid #E5E5E5}.c-data-footer .copyright{color:#999;margin-top:12px}.c-data-footer .contact-us{margin-top:13px}.c-data-footer .contact-us .inner{width:322px;margin:0 auto}.c-data-footer .contact-us .inner:after{visibility:hidden;display:block;height:0;content:\".\";font-size:0;clear:both}.c-data-footer .contact-us .inner .contact-bd{display:none;position:absolute;bottom:64px;left:-120px;border:1px solid #ddd;background:#fff;-webit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;padding:21px;width:330px;-webkit-box-shadow:0 1px 6px 0 rgba(0,0,0,.12);box-shadow:0 1px 6px 0 rgba(0,0,0,.12)}.c-data-footer .contact-us .inner .contact-bd:after{visibility:hidden;display:block;height:0;content:\".\";font-size:0;clear:both}.c-data-footer .contact-us .inner .weibo-weixin{float:left;display:inline;position:relative}.c-data-footer .contact-us .inner .qq{float:left;display:inline;margin-left:42px}";
              var innerHtml = "<div class=\"c-data-footer\" id=\"J_C_Data_Footer\">\r\n\t<div class=\"inner\">\r\n\t\t<div class=\"links\">\r\n\t\t\t<a href=\"http://www.taosj.com\">首页</a>\r\n\t\t\t<a href=\"/help/about.html\" target=\"_blank\">关于我们</a>\r\n\t\t\t<a href=\"/help/contactus.html\" target=\"_blank\">联系我们</a>\r\n\t\t\t<!--<a rel=\"nofollow\" id=\"J_C_Maijia_Footer_BizQQWPA\">联系我们</a>-->\r\n\t\t\t<a rel=\"nofollow\" href=\"http://login.taosj.com/register/agreement.htm\">法律声明</a>\r\n\t\t\t<a rel=\"nofollow\" href=\"/help/index.html\">帮助中心</a>\r\n\t\t</div>\r\n\t\t<div class=\"copyright\">淘数据&nbsp;<span style=\"font-family:arial;\">©</span>2016&nbsp;taosj.com&nbsp;&nbsp;版权所有&nbsp;&nbsp;浙ICP备14032119号-3</div>\r\n\t</div>\r\n</div>\r\n";
          }else{
              var css = "html,body{min-width:1200px}.c-maijia-footer#J_C_Maijia_Footer{padding:0;border:0}.c-maijia-footer .c-maijia-footer-2017{background:#f9f9f9;border-top:1px solid #eee;font-family:Helvetica,\"PingFang SC\",\"微软雅黑\",Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\";font-size:12px;line-height:20px;color:#6c6c6c;padding:30px 0 0}.c-maijia-footer .c-maijia-footer-2017 .inner{max-width:1180px;margin:0 auto}.c-maijia-footer .c-maijia-footer-2017 .links{line-height:1em}.c-maijia-footer .c-maijia-footer-2017 .links a{color:#6c6c6c;text-decoration:none;padding:0 12px;margin:0}.c-maijia-footer .c-maijia-footer-2017 .links a:hover{text-decoration:none;color:#ff8939}.c-maijia-footer .c-maijia-footer-2017 .links a.last{padding-right:0}.c-maijia-footer .c-maijia-footer-2017 .links .pro-links{width:715px;margin:0 auto}.c-maijia-footer .c-maijia-footer-2017 .links .page-links{width:525px;margin:20px auto}.c-maijia-footer .c-maijia-footer-2017 .links .page-links a{border-right:1px solid #ddd}.c-maijia-footer .c-maijia-footer-2017 .links .page-links a.last{border-right:0}.c-maijia-footer .c-maijia-footer-2017 .links .page-links a.first{padding-left:0}.c-maijia-footer .c-maijia-footer-2017 .copyright{color:#9c9c9c;text-align:center}.c-maijia-footer .c-maijia-footer-2017 .ercode{width:305px;margin:17px auto 0;padding:0;height:85px}.c-maijia-footer .c-maijia-footer-2017 .ercode .tt{margin-bottom:15px;line-height:1em;font-size:14px;color:#6c6c6c}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .icon-con{cursor:pointer;position:relative;height:56px;width:56px;margin-right:20px}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .icon-con .hbk{left:50%;margin-left:-70px;position:absolute;bottom:50px;display:none}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .icon-con .hbk.hbk-t{margin-left:-54px}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .icon-con .hbk .code-t{text-align:center;position:relative;top:-7px}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .icon-con .hbk .code-t span{position:absolute;left:0;text-align:center;width:100%;color:#6c6c6c;top:15px}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .icon-con .hbk .aw{height:0;width:0;margin:0 auto;border-width:10px;border-style:solid;border-color:#fff transparent transparent}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .icon-con:hover .hbk{display:block}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .wx-con{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/wx.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .wx-con:hover{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/wx-h.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .qq-con{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/qq.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .qq-con:hover{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/qq-h.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .app-con{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/phone.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .app-con:hover{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/phone-h.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .sina-con{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/sina.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .ercode .icons .sina-con:hover{background:url(//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/sina-h.png) no-repeat center center}.c-maijia-footer .c-maijia-footer-2017 .clearfix:after{display:table;clear:both;content:\"\"}.c-maijia-footer .c-maijia-footer-2017 .fl{float:left;border:0;background:transparent}.c-maijia-footer .c-maijia-footer-2017 .fr{width:auto;float:right}";
              var innerHtml = "<div class=\"c-maijia-footer-2017\">\r\n    <div class=\"inner clearfix\">\r\n        <div class=\"links\">\r\n            <div class=\"pro-links clearfix\">\r\n                <div class=\"link-p fl\">\r\n                    公司产品：\r\n                </div>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=appstore-9092&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级店长\r\n                </a>\r\n                <a href=\"http://www.maijia.com/wish/\" target=\"_blank\" class=\"link-p fl\">\r\n                    卖家数据\r\n                </a>\r\n                <a href=\"http://xueyuan.maijia.com/\" target=\"_blank\" class=\"link-p fl\">\r\n                    卖家学院\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1865889&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    旺店交易\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1859514&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    旺店商品\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1834824&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级快车\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=service-0-23008&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级绩效\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://cjytg.raycloud.com/\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级云托管\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1868297&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl last\">\r\n                    快麦CRM\r\n                </a>\r\n            </div>\r\n            <div class=\"page-links clearfix\">\r\n                <a href=\"/\" target=\"_blank\" class=\"link-p fl first\">\r\n                    首页\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/other/index.html#/about/contact/\" target=\"_blank\" class=\"link-p fl\">\r\n                    商务合作\r\n                </a>\r\n                <a href=\"http://www.maijia.com/sitemap.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    网站地图\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/help/contact.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    关于我们\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/other/index.html#/about/notices/\" target=\"_blank\" class=\"link-p fl\">\r\n                    法律声明\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/job.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    人才招聘\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/help/index.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    帮助中心\r\n                </a>\r\n                <a rel=\"nofollow\" rel=\"nofollow\" class=\"tab-a-mobile link-p fl last\" href=\"http://m.maijia.com\">移动版</a>\r\n            </div>\r\n            <div class=\"copyright\">\r\n                <span style=\"font-family:arial;\">©</span>&nbsp;2014-{!year!}&nbsp;杭州麦家科技有限公司&nbsp;版权所有&nbsp;浙ICP备14032119号\r\n            </div>\r\n        </div>\r\n        <div class=\"ercode\">\r\n            <div class=\"icons clearfix\">\r\n                <div class=\"wx-con icon-con fl\">\r\n                    <div class=\"hbk\">\r\n                        <div class=\"ct code-ct\">\r\n                            <img width=\"140\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/mj-code.png\" alt=\"\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <a rel=\"nofollow\" href=\"http://weibo.com/maijiacom\" target=\"_blank\"><div class=\"sina-con icon-con fl\">\r\n                    <div class=\"hbk hbk-t\">\r\n                        <div class=\"ct code-t code-tt\">\r\n                            <img width=\"108\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/tt2.png\" alt=\"\">\r\n                            <span>新浪微博</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                </a>\r\n                <div class=\"app-con icon-con fl\">\r\n                    <div class=\"hbk\">\r\n                        <div class=\"ct code-ct\">\r\n                            <img width=\"140\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/app-code.png\" alt=\"\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"qq-con icon-con fl\" id=\"J_C_Maijia_Footer_BizQQWPA\">\r\n                    <div class=\"hbk hbk-t\">\r\n                        <div class=\"ct code-t code-tt\">\r\n                             <img width=\"108\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/tt2.png\" alt=\"\">\r\n                            <span> 联系客服</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n";
          }
  		require.loadCss({content: css});
  		this.$el = $('#J_C_Maijia_Footer');
  		innerHtml = innerHtml.replace(/\{!year!\}/,new Date().getFullYear());
  		this.$el.html(innerHtml);
  		// this.render();
  		this._eventBind();
  		var html = this.$el.find('.copyright').html();
  		this.$el.find('.copyright').html(html.replace(/\{!year!\}/,new Date().getFullYear()));
  	},
  	render: function(){
  	},
      renderTo: function(selector){
      	// var css = __inline('./layout.less');
  		// require.loadCss({content: css});
  		var html = "<div class=\"c-maijia-footer\" id=\"J_C_Maijia_Footer\">\r\n\t<div class=\"c-maijia-footer-2017\">\r\n    <div class=\"inner clearfix\">\r\n        <div class=\"links\">\r\n            <div class=\"pro-links clearfix\">\r\n                <div class=\"link-p fl\">\r\n                    公司产品：\r\n                </div>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=appstore-9092&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级店长\r\n                </a>\r\n                <a href=\"http://www.maijia.com/wish/\" target=\"_blank\" class=\"link-p fl\">\r\n                    卖家数据\r\n                </a>\r\n                <a href=\"http://xueyuan.maijia.com/\" target=\"_blank\" class=\"link-p fl\">\r\n                    卖家学院\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1865889&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    旺店交易\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1859514&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    旺店商品\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1834824&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级快车\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=service-0-23008&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级绩效\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://cjytg.raycloud.com/\" target=\"_blank\" class=\"link-p fl\">\r\n                    超级云托管\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"https://fuwu.taobao.com/ser/detail.html?service_code=FW_GOODS-1868297&tracelog=raycloud\" target=\"_blank\" class=\"link-p fl last\">\r\n                    快麦CRM\r\n                </a>\r\n            </div>\r\n            <div class=\"page-links clearfix\">\r\n                <a href=\"/\" target=\"_blank\" class=\"link-p fl first\">\r\n                    首页\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/other/index.html#/about/contact/\" target=\"_blank\" class=\"link-p fl\">\r\n                    商务合作\r\n                </a>\r\n                <a href=\"http://www.maijia.com/sitemap.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    网站地图\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/help/contact.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    关于我们\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/other/index.html#/about/notices/\" target=\"_blank\" class=\"link-p fl\">\r\n                    法律声明\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/job.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    人才招聘\r\n                </a>\r\n                <a rel=\"nofollow\" href=\"http://www.maijia.com/help/index.html\" target=\"_blank\" class=\"link-p fl\">\r\n                    帮助中心\r\n                </a>\r\n                <a rel=\"nofollow\" rel=\"nofollow\" class=\"tab-a-mobile link-p fl last\" href=\"http://m.maijia.com\">移动版</a>\r\n            </div>\r\n            <div class=\"copyright\">\r\n                <span style=\"font-family:arial;\">©</span>&nbsp;2014-{!year!}&nbsp;杭州麦家科技有限公司&nbsp;版权所有&nbsp;浙ICP备14032119号\r\n            </div>\r\n        </div>\r\n        <div class=\"ercode\">\r\n            <div class=\"icons clearfix\">\r\n                <div class=\"wx-con icon-con fl\">\r\n                    <div class=\"hbk\">\r\n                        <div class=\"ct code-ct\">\r\n                            <img width=\"140\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/mj-code.png\" alt=\"\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <a rel=\"nofollow\" href=\"http://weibo.com/maijiacom\" target=\"_blank\"><div class=\"sina-con icon-con fl\">\r\n                    <div class=\"hbk hbk-t\">\r\n                        <div class=\"ct code-t code-tt\">\r\n                            <img width=\"108\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/tt2.png\" alt=\"\">\r\n                            <span>新浪微博</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                </a>\r\n                <div class=\"app-con icon-con fl\">\r\n                    <div class=\"hbk\">\r\n                        <div class=\"ct code-ct\">\r\n                            <img width=\"140\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/app-code.png\" alt=\"\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"qq-con icon-con fl\" id=\"J_C_Maijia_Footer_BizQQWPA\">\r\n                    <div class=\"hbk hbk-t\">\r\n                        <div class=\"ct code-t code-tt\">\r\n                             <img width=\"108\" src=\"//cdn.maijia.com/maijia-common/components/maijia-footer/src/img/tt2.png\" alt=\"\">\r\n                            <span> 联系客服</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n</div>";
  		html = html.replace(/\{!year!\}/,new Date().getFullYear());
          $(selector).html(html);
          this.init();
  	},
  	_eventBind: function(){
  		var qq = require('components/maijia-qq/qq');
  		qq.bind('J_C_Maijia_Footer_BizQQWPA');
  
  		var timer = null;
  		$("#J_C_Maijia_Footer .tab-a-mobile").on("click",function(){
  			document.cookie = "pc=1; expires=Fri, 21 Dec 1976 04:31:24 GMT;domain=maijia.com";
  			window.location.href="http://m.maijia.com";
  			return false;
  		});
  		// $('#J_C_Maijia_Footer .weibo-weixin').mouseenter(function(){
  		// 	if(timer){
  		// 		clearTimeout(timer);
  		// 		timer = null;
  		// 	}
  		// 	$(this).find('.contact-bd').show();
  		// }).mouseleave(function(){
  		// 	var $el = $(this).find('.contact-bd');
  		// 	timer = setTimeout(function(){
  		// 		$el && $el.hide();
  		// 	}, 300);
  		// });
  	}
  }
  
  //添加360统计,先丢在尾部
  // $('body').append('<script type="text/javascript" src="//s.union.360.cn/5501.js"></script>');
  

});

;/*!components/maijia-login/src/login.js*/
define('components/maijia-login/src/login', function(require, exports, module) {

  var $ = require('components/jquery/jquery');
  require('components/bootstrap-modal/modal');
  
  var css = "#C_maijia-login .close{position:absolute;top:10px;right:10px;z-index:2;background:0 0;border:0}#C_maijia-login .close span{display:block;width:50px;height:50px;line-height:50px;color:#fff;font-size:0;text-align:center;background:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAxMkVCQkZBRjBFMzExRTRBMDNGOTBGMDA5NkU2NzFFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAxMkVCQkZCRjBFMzExRTRBMDNGOTBGMDA5NkU2NzFFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDEyRUJCRjhGMEUzMTFFNEEwM0Y5MEYwMDk2RTY3MUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDEyRUJCRjlGMEUzMTFFNEEwM0Y5MEYwMDk2RTY3MUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7Lc1a2AAABlklEQVR42rTWSU4CQRTG8dKlE7QCCuLATfQSXs4rmLhm6RjBCRSUoRVMXJvowmhclK/iq/il0kMVVHfyX/RUP5rAS89IKfeFEDVqj3oT2Wwl6oBqCwLP5d92TS1TwnMlqsNGXR1Yox4BDTxiRcBaVEGfyAJV2D1gal/gBWVAr6i8J6ytMRPUaG9KVC1+F4VFgaoKoJeOaJERyU9YNK+Ju1GhfUBzllgrCUsCXdECYJ04LA1UrVMDXqgZg1pjNqCJNgx0hboFrJS2nu2PoQroBaOIdW0wF1CjQ0BvAFu1Xcf1P6bQUP5vDy6YatZx6n9SH7D/Tn05reDw6QKes5JHoH7SM8v/qdNXamJq2G9QT4Au+QIDnqsaK8O5TUBPbdA0LA9Yz8AQfQZ0cVIwzyNNY5WEa63RuAVygPVTMN0WNeJ7TqgFW3ASzBqNwpp8w4DnqOtw2Ab02ERNrDElhugY0HkTzPF81FjVw0tUDdAjjZrY0BOG6Augc+pgnQ+EnrEo9FAN7x+qS+1Qrxm85o+oXSqkvn8FGAC4+cXax7saRQAAAABJRU5ErkJggg==\") 11px 11px no-repeat}#C_maijia-login .close:hover{background:#f60;cursor:pointer}#C_maijia-login .close:focus{outline:0}#C_maijia-login .modal-content{background:url(\"data:image/gif;base64,R0lGODlhHAAcAPeWANHR0b+/v56enri4uLKysqampoyMjNnZ2XNzc1lZWfT09O3t7fLy8u/v7/Pz8/f39/Dw8Pb29uvr6/Hx8ebm5vj4+PX19dfX1+7u7uPj4+np6dzc3Pn5+ejo6Orq6ufn5/r6+uTk5OXl5ezs7ODg4NPT097e3s7OztjY2N/f39ra2v39/eLi4sHBwd3d3dvb2+Hh4fz8/K+vr9LS0sjIyPv7+7W1tcLCwry8vMrKytTU1MTExMXFxaenp7q6uru7u6mpqdXV1cnJyaOjo83NzaioqM/Pz/7+/tbW1rm5uZ2dnbS0tKKiorGxsaurq5GRkcPDw66urpubm1paWqCgoL29vY2Njbe3t6GhocbGxm9vb3R0dKqqqnh4eICAgMvLy4aGhl5eXr6+vnZ2drOzs62trXJycpeXl5CQkI+Pj5SUlLa2tmlpaXd3d4GBgVhYWJycnF1dXbCwsGBgYJOTk39/f6SkpJ+fn8DAwHp6etDQ0KysrFdXV2pqanx8fHl5eVZWVmFhYZWVlZiYmIKCgqWlpYuLi5aWln19fYqKiomJiVxcXGhoaJKSksfHx35+foiIiGdnZ19fX3BwcJmZmczMzP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkI5RDJEMjlGREI4NTExRTA4MDMzRkNFNkY2RDA0OTNEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkI5RDJEMkEwREI4NTExRTA4MDMzRkNFNkY2RDA0OTNEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6QjlEMkQyOUREQjg1MTFFMDgwMzNGQ0U2RjZEMDQ5M0QiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6QjlEMkQyOUVEQjg1MTFFMDgwMzNGQ0U2RjZEMDQ5M0QiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIxMC8uLSwrKikoJyYlJCMiISAfHh0cGxoZGBcWFRQTEhEQDw4NDAsKCQgHBgUEAwIBAAAh+QQFAACWACwAAAAAHAAcAAAI/wAtCRxI0FIMIWPGCIlRsKFDCBIWWHqBoCICF5ZCsPDgsKGHMwasiHBhcYuLDW8SsCHRkWARAyEFTXhSkQ4GRglyumk5sABMA2osQbhyBYKlQDmndOEp0AQamBca7siZYEZHBgMGfLAkYkOKjgC+YOQQQgSIgRN6UKI0ZCtTgSA2HDhg4qylEWvXfn1rycHcuRUEYlCyFg4LvpYUqJj7gsNADE6KbEAskEGKFIEFdtDgmDLBGAoUWDogQEATDJ4FPlABAMCC0qVppObaujVsAbJTi6gNgLQAGQ1mr24tsYOHzrNBixbYYA0ZlpQXlAgSYSAELgUKAKGAGMKJSpVOPIJgnj17BsQNwIOvbokBgexlNCBmMAN8icyJW7TgiOEDR4cLSGAUAxtsgFxBHthAAAEhNNRBAAHcMMJbOyxIwBqWVKCCCuNBAWEAJ1BooQ8P0JCVIxXw8GGITE2QxIINYJBVVg1MACEPDvBlwQQ5LjDjABJZoMB4qa2QgQ8+ZLACUwEBACH5BAUAAJYALAAAAAAcABwAAAj/AC0JHEhQ4Iw0aWYUXMjQEoMFDSyxMEDRQAZLHSgsaFhwxBBKlDRkqGglAwwzCLyI4DiwCUhKTBwUothjQh0EONWwFOgSJBVLDqBAcWApD04EgnZKVALyxUIiOPMgaegAB44OGElcZIhChwlLFyh6IOhEgIAeSgciYZMggRaslhaYNUsiraUcbdvWtdSAiVksW5UaCZOAz6KVA+U4+WrX0o4+jxBb8iCh8cIaICJY2lCgwBUIlgXWCIHiAITOnSuFtqThgOsDqAuoDt36NecCNkCHrsDCNWgNI0CsHhhBs0AGeKqEsNwABYoHAxnYIEBgiQa7DGYAAFBi4ATq1D/YfYWwfTt0SwpwUE8ywq6CINsvcBhoIUeOjQ00VGY4oQFRBSmkwJEEPwwwAAULLVBJJSfoxpIQBg6Ag0AmmFCBJXosWAkKSkFoIB4VEBFAAJVwMIOGHO7EQAAGQgDBiCNCoMCCABi3UwQMKMAXjAFgYMkDEVy4GgUttIDgTgEBACH5BAUAAJYALAAAAAAcABwAAAj/AC0JHEjQ0ooLUqRcWFGwoUNLGASKoESREgVLCyRAeFhwQQ8BAjx8qEjpAwUDBs544DjQBkgBBRTIoCjHwSGUBoqwFLjk5RBLCnLkUGDpCU4gOy1lYALSRUMkKJ+YeKigRYuVGmCEeJhiw1YXIBcMZECgQIEoK5Na2uAFAQIwEgQ2MGs2g1pLJdy6FSFwAhezQC6qvdDGbZ4OAyGsIUDirkAjihIJxogBhOOCFg5csASDAIEWDC4LZNElQYIqnj2XEG0Ji2nTqQmsFq1kyuvOBPCEFt2BEaApVSizHljDhI6BDnjcmKyWAQwKEZD/GDDAR1y1ClQcOOCCg0AG1Kkjf1brYPv2CgIttKAeIKLaCC62m7AsMMKJExEhSBDrkMEEC5ZEIIII9DW0wA0BBDAeQQ0AAEAJu7F0QoIB3GAJCANapoODAGyQ1IQJZsHBBZVUcgEIQXDo4U7JJciAAyWW6IAFDgbxgFoPKAAgAzFWEloFD3gn2hESEEGEBEfsFBAAIfkEBQAAlgAsAAAAABwAHAAACP8ALQkcSFDgASpUDhRcyNCSgwYTLH0QQFHAB0sNFjBoWLBBlAIFRnSoKKCDBkqUhozgOPAHyAJlLJChSEbBEJSUmrAU6OOlE0sWiBCxYOkOTgI7LVEAApLEwhcoBbBoaCFHjgWWJISg0DADiYsZZMiIKFABDgIEkmBNainDGQMGpDQQOAEt2otsVcCF60EgAxtol2hga8kEGriNVvrFUyUEYYEoKEoYiGHu44IPUphoO2BAFgeXBVKwggABjc6dL4S2JKN0adQDVIeW4xpBhs48QIem8GSLaUuVa6wWaEHzQAVfaAx+nGXSlgzHbwQI0GJtUiNhEiSYA93h9OmT2Qp60a7dqaUINKbvgEAYRaApCbR0GPigRAn2CiA2VOCggiUVihjQF0MTnFBJJdYNxMABB6jAQVIoHFiJEQJ9gNcLDB7A1U4RHjgDCC8AAIAKNbiQIQxJRQDAgQooIKKIFjzAoAv+JVVBBA849CIAoHFQAQjDLTDDDAk2FBAAIfkEBQAAlgAsAAAAABwAHAAACP8ALQkcSFDghiJFNhRcyNCShQkOLHUoQLGABoEYGi6ckIQAAQweKhbw4EGAgB4LNA7c4ZHAgAg+KPqw0MOkABsqBbL0eEUgAAARLA2xiTOnBhseQyx0YZJJhoYRTpzIiOGDh4YhYFz8MGAAg4EWWnQNkDGnQApDKFHqMUEgg65dO5gVmEKt2hECHfzo6kPCXEss4KhVUtaSgx03KPw1CIRLSoEQJtRYXLCCiKcUAgT4ooCyQAlMDBgAoFnzC8+WxIgWXTqACtSqV2cOkKOzZw+FrIy21GBCDNQCH4RQKjACkhKP/xoBk+jDwAcnKlU6AeHvhTYIEPyRaymCdOkN/pZ9yJ5dhMAKJaQDiDjXBaHsYPwK5LBhQ8SHXxkCqHTAkos7AiRXEAMl/BReQTckkMAcRpi1wU8A6GBJDRJI8NsiCiZQh4MQIlEDDAccIAEEgWTohlkPBPGTBRGEeMAGE5jARwJskDAXBw9U4JCLKHBgSQgsXIUaBCqoUF1OAQEAIfkEBQAAlgAsAAAAABwAHAAACP8ALQkcSFAgjCVLYBRcyNBSBAYKLI0gQJHACEsTGjhoWJBBgAEDGiyoaHFEgQJRGnAcKATkADEPoFDcEaHMyQI/Vgqk4RKHpQcXLjywxOWmT50SfoCksDDFSSBMGT4oUQKCpQYaJDSkEEJrBxw4NgqMQCNAAB5WdQr80EOAACcDHZg1q1WtJRJu3S4QaOGG2RZ77WbA4paJSoEKvjjSYHegiT0yMMRVEKPxQg4dPliSUKkSkgiWBy4oQ4nShc6dWYQWyKN0adSVVK/O4poSZ8+gVy+IUvqCJQcRVw+skHnggwMoDje+oOROXYElAACYwaCxCTQGDDy5+FO69LRqX2SAz+5BIIcL0nUEV5thUHYpyi2lSBExAvCGKHSksJRBjowJDSmgwgEHrDfQCQgg0AUSarFA4AEhSAQEEHv5kSACdDRI4As6TJBHAgn4YYkbF6qhVgUuHLABAzpMAeIbB5CwBQJeiGAXCBVwYEkJIIIYhCUaUBBYaDUEEEccAdSgU0AAIfkEBQAAlgAsAAAAABwAHAAACP8ALQkcSFBgBh8+MhRcyNDSAwUWLC0YQHHAAksOJkRsSNABjwABJmCoOABDAwIEkkzgOPAEyAA7KtCgSONBEpQEdrAUSOQlFIEqVFSwtAYnj50SW4DssDAEyjUaGnLYsMGBpQkSLjL08OGihhYtFAysUKJSJQBWkVrSEKVAAQIMBEYwa7aBWksZ3Lq16/CE2RMQ7lIA4pZLYLlBSmi9S2KJjcOWIN5tqIHpAgAAVDyYPBBDEwECDmDGLIKzQBqgQY8GUNo06tSXAaDYbNoz6AORLawwPZBD5bEkUsSdvKGIEwy9Xxw4oEKsWhZwKFFSgtxSheXLNyJNIV36CIEgTBx2QBFiMgU70nusBC/ig9ULZxum2FCaAsXhC7/MSZBAZ8ELBhjwhAlI+cFfAnNYAsEVVwRGR4AG9ICUG/y90QcEdCCAABoMDAJhEUiRwEYCb2yQgoYImJECBVYYcIYHannAQnkboIjACxJJANlkMQgxxhhCxLBTQAAh+QQFAACWACwAAAAAHAAcAAAI/wAtCRxIUCCFFi0oFFzI0FKFCA8sNQhAMUADSwoYRGhYMAKASpUUTKwIAcKAAQEYcByIAmQlPRyIUDxRIcDJAUJWCmwJUo9DEyYE4riZU+eEEyAXLKRw8ocHjilSKMDYYEJDCRoujsiRw8JADhcAAAgyVafAEUkIEMBR9oFYsRDMCvygVq1VgSXEzlApV8MStTb4Wnqg4sJFuQJFiBEjGCJihiAkPIVw4AAJDo8HNrhSoMCGypU1ZBZYqXNn0CiUji5tGgKKDRMEP26QpPMGSxw0jiYoeWAILVqyZDaxJwrBDGESJAhjBHEGLAIEMDlMQrnyHIhJRI+uuoMW5ZEuIHP+0CO6E4IeDBhCYYmEDvYMM5DoYKkDDhwOGqLoggABkYUvUEKJEiyYJUh/CPxhiQNQQJEfFQJS0oRZavRnBiEMFGCAAXYoYEeEE+okghcImMGCCBtuGIIGAg4xglwLUEBfBikaUGADC8j22AxppDGDWQEBACH5BAUAAJYALAAAAAAcABwAAAj/AC0JHEjQ0hEJRIhIOFKwoUMODypYYlCpYiUHliwoeOCw4YMgAABYcGDx4oQAAXhg7DhwQ0gAOkBcqIjC0g6UAU6wHPjipQ5LIESIAGHpBk4jOwUyKBGyQcMOKG8s6BhURISMExh0XCABgiUMJ05cFQjCxIEDLsYmtbQgwIABLSwIrHD27Mq1Hd6+1WqpgokXB1QoWCtQgo+3P+5GuCBiMGGBFG7suHsBCcfHDTFMrZJgyhgSmAcyaEGAAIwEqBNgCS2wROnSqRNQYW1Jx2sCnN+MCUF7wo3SMCxdeEF7IIgFUyFbgYQUMwkyNrwK7PAHAYI2Fx5TAFKgABfpIqxbgJ/xOEP37k4tSQBjvY6LxxpkdCfAl60AJSYsidiQomMIGBpYokELLTjWUApPGGAAEg25IIAATGSwVhEKGvCEJQrkkMNgQzwogA0TVjiIAjJQQokMFvTgIYhJeXCGgh98YKKJH3jwYA/JJQWBBFNRMCMlIgiEQXErXCCFFBeskFRAACH5BAUAAJYALAAAAAAcABwAAAj/AC0JHEhQ4IIZMxYUXMjQEogKHCw5AEARgMAHESo0LFjBxYEDDxRUBKBAQaVKACJsHAjj44ENll5QfAECwMlKKFYK9IDi4wuBHz4INHLzgE6BLQ8wWLjgpBEIDT0YMBBEYsmGExo4sNSgRIkHAztoSZCgT4mjAhvwCBCAhkpLJMiSzYHWkgS2bLdaCiGJbBgjdRe0YHtDwcAMbbTwqCtQg5AchgWaIPGW8cAaDTBYooEAQRqhliVmGTAgQ+fOMkJbukCa9GkEqUOzbs3ZjKEOqhmMLm3JBQywqtNqFigBi4ALlkNUCbBU4IgnU9GYqKthCQECNppLnWpARd0P169PdkgrZeqhDHVH+LiOI7KlCTJkhLDUgQR6hhRCSLA0IkcOCw2xoAQllPxUEAkFFACECEc1QSAld1hiARFEAOhEggX80OCDdlhAhgACkGFJFBhqqNMIQxCoQQcggqjBCAlG0QBaDCww4wctCiBUVnqFdgAVVBilU0AAIfkEBQAAlgAsAAAAABwAHAAACP8ALQkcSFAgBBUqIBRcyNCSBxYhLD04QPGABUsVHnBoWJAEmwSASIBAUTGCBQAAgjzgONBNggR8zFQIQZGFpSAoAWxgKbDOywRTLMWQIKGGJR05d/LUE+bljYUNUJZg0HCBAAEmLKmoBKAhgwkKLDnYsGGjQAlgECDwkpWnQAcAKlUqUUGgCLVqS7gV2ECu3AgCO3RR2+bCXksQTsg9AVjgBytgThwWiEGHjsaWMlBYObkgBIUADBgYMqKzQAVfAgSgIFq0GNOWXqhW3dpAFdiyZ4c2QKW0aQWVVFPITKEubEs1Pg9c4KSI0sMUbkBxMBCDEkqU4NjcK8HHgAE/qFt9GoEde4rDHb5/p2ppQg/sQ4bvXRDge4uLAhl8/2BJA4yIDHnwwQKWYHACYw1lwMRVLiwUAgEE2KCBWzZcJcAQlkSAkkBXQEjADhRaWIQlPhRQQBIP+OAhiDwt0MNVHnhgookSYABhEhMchoFAGsxYQAdiTYCfaRsU4ZxbAQEAIfkEBQAAlgAsAAAAABwAHAAACP8ALQkcSNBSjQBx4gSoUbChwwUUNFgKkqDilBmWOFQA4bChCC8Itli6UDEBIBcKXhxwUaEjQTUIQj7CgKjiFg4hDuhk4XJgo5gIEFlaAATICEswdB7I0FPghS4xTzRUoFOFgo4TZMgIYYmEDhQdFTiIYElBihQEG0gxYOAM16YCFQQBAOACB4Ee2LJVAVcgBLp0Hwgc8YQtGhN9LTGYQbeEYIESsMC5kFhgAxQHHlv6oKFlZYIxxI6kRKkMhs8CIyCpVEkCadI8UFtiwZr1a0qxUWeoXekCadOyI1xgLWFzh7uyBTpwMBCDjD2IK2ugIeSqZSYCBGBh2ndBiwABbliCX5A9O4nEEsCDZy7QSfYCHxI34AGeBlnlOHB0sCQhBIWOEmjQgCUQlOBYRxQAUUABaBVEwQAD/OABXD8sWAAXljxwwQWC4QDhAEJQaKEMD0BBAAE3WBLAhyE21UAUC46wwIknLtAAhAEw0JcDDUxgyQg0EnCUAgzchxoMSywBA1wBAQA7\") center center no-repeat #fbfbfb;border:0;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}#C_maijia-login .modal-body{padding:0}#C_maijia-login iframe{background:transparent}";
  require.loadCss({content: css});
  
  var Login = {
  	init: function(){
  		this.render();
  		this.callback = null;
  		
  	},
  	_rendered: false,
  	render: function(){
  		if(this._rendered === true){
  			return;
  		}
  		var TEMP = "<div class=\"modal fade\" id=\"C_maijia-login\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\r\n\t<!--[if lt IE 9]>\r\n\t<style>\r\n\t\t#C_maijia-login .modal-dialog{width: 600px;position: absolute; left: 50%; margin-left: -300px; top: 10px;}\r\n\t</style>\r\n\t<![endif]-->\r\n\t<div class=\"modal-dialog\">\r\n\t\t<div class=\"modal-content\">\r\n\t\t\t<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\r\n\t\t\t <div class=\"modal-body\">\r\n\t\t\t\t<iframe src=\"about:blank\" width=\"600\" height=\"380\" border=\"0\" allowtransparency=\"true\" scrolling=\"no\" frameborder=\"no\" ></iframe>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>";
  		this.$el = $(TEMP).appendTo('body');
  		this._rendered = true;
  		//暂时放这里
          if(!!~window.location.href.indexOf('//www.taosj.com/')){
              this.domain = 'taosj';
          }else{
              this.domain = 'maijia';
          }
  		this.addEvent();
  	},
  	addEvent: function(){
  		var _this = this;
  		$(window).on('message', function(e){
  			e = e.originalEvent;
  			if(e.origin !== ('https://login.'+_this.domain+'.com') && e.origin !== ('http://login.'+_this.domain+'.com')){
  				return;
  			}
  			var data = {};
  			try{
  				data = JSON.parse(e.data);
  			}catch(e){
  				data = null;
  			}
  
  			$('#C_maijia-login').modal('hide');
  			if(data === null){
  				window.location.reload();
  				return;
  			} 
  			
  			if(data.loginStatus != ''){
  				_this.callback();
  			}else if(data.redirectURL){
  				window.location.href = data.redirectURL;
  			}
  		})
  	},
  	updateFrame: function(){
  	    if(this.domain == 'taosj'){
  	        var src = 'http://login.'+this.domain+'.com/?style=win&redirectURL='+encodeURIComponent(window.location.href);
  	    }else{
  	        var src = 'https://login.'+this.domain+'.com/?style=win&redirectURL='+encodeURIComponent(window.location.href);
  	    }
  		this.$el.find('iframe').attr('src', src);
  	},
  	show: function(callback){
  		this.callback = callback || function(){};
  		this.render();
  		this.updateFrame();
  		//@todo close clean callback
  		$('#C_maijia-login').modal('show');
  	}
  };
  module.exports = Login;

});

;/*!components/maijia-session/jquery.cookie.js*/
define('components/maijia-session/jquery.cookie', function(require, exports, module) {

  /*!
   * jQuery Cookie Plugin v1.4.1
   * https://github.com/carhartl/jquery-cookie
   *
   * Copyright 2006, 2014 Klaus Hartl
   * Released under the MIT license
   */
  (function (factory) {
  	if (typeof define === 'function' && define.amd) {
  		// AMD (Register as an anonymous module)
  		define(['jquery'], factory);
  	} else if (typeof exports === 'object') {
  		// Node/CommonJS
  		module.exports = factory(require('components/jquery/jquery'));
  	} else {
  		// Browser globals
  		factory(jQuery);
  	}
  }(function ($) {
  
  	var pluses = /\+/g;
  
  	function encode(s) {
  		return config.raw ? s : encodeURIComponent(s);
  	}
  
  	function decode(s) {
  		return config.raw ? s : decodeURIComponent(s);
  	}
  
  	function stringifyCookieValue(value) {
  		return encode(config.json ? JSON.stringify(value) : String(value));
  	}
  
  	function parseCookieValue(s) {
  		if (s.indexOf('"') === 0) {
  			// This is a quoted cookie as according to RFC2068, unescape...
  			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
  		}
  
  		try {
  			// Replace server-side written pluses with spaces.
  			// If we can't decode the cookie, ignore it, it's unusable.
  			// If we can't parse the cookie, ignore it, it's unusable.
  			s = decodeURIComponent(s.replace(pluses, ' '));
  			return config.json ? JSON.parse(s) : s;
  		} catch(e) {}
  	}
  
  	function read(s, converter) {
  		var value = config.raw ? s : parseCookieValue(s);
  		return $.isFunction(converter) ? converter(value) : value;
  	}
  
  	var config = $.cookie = function (key, value, options) {
  
  		// Write
  
  		if (arguments.length > 1 && !$.isFunction(value)) {
  			options = $.extend({}, config.defaults, options);
  
  			if (typeof options.expires === 'number') {
  				var days = options.expires, t = options.expires = new Date();
  				t.setMilliseconds(t.getMilliseconds() + days * 864e+5);
  			}
  
  			return (document.cookie = [
  				encode(key), '=', stringifyCookieValue(value),
  				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
  				options.path    ? '; path=' + options.path : '',
  				options.domain  ? '; domain=' + options.domain : '',
  				options.secure  ? '; secure' : ''
  			].join(''));
  		}
  
  		// Read
  
  		var result = key ? undefined : {},
  			// To prevent the for loop in the first place assign an empty array
  			// in case there are no cookies at all. Also prevents odd result when
  			// calling $.cookie().
  			cookies = document.cookie ? document.cookie.split('; ') : [],
  			i = 0,
  			l = cookies.length;
  
  		for (; i < l; i++) {
  			var parts = cookies[i].split('='),
  				name = decode(parts.shift()),
  				cookie = parts.join('=');
  
  			if (key === name) {
  				// If second argument (value) is a function it's a converter...
  				result = read(cookie, value);
  				break;
  			}
  
  			// Prevent storing a cookie that we couldn't decode.
  			if (!key && (cookie = read(cookie)) !== undefined) {
  				result[name] = cookie;
  			}
  		}
  
  		return result;
  	};
  
  	config.defaults = {};
  
  	$.removeCookie = function (key, options) {
  		// Must not alter options, thus extending a fresh object...
  		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
  		return !$.cookie(key);
  	};
  
  }));
  

});

;/*!components/maijia-session/session.js*/
define('components/maijia-session/session', function(require, exports, module) {

  //简单处理
  
  var $ = require('components/jquery/jquery');
  require('components/maijia-session/jquery.cookie');
  var domain,redomain;
  if(!!~window.location.href.indexOf('//www.taosj.com/')){
      domain = 'taosj';
      redomain = 'maijia';
  }else{
      domain = 'maijia';
      redomain = 'taosj';
  }
  var appendDialog = function (content) {
    var html = '<div class="shadow" style="position: fixed;width: 100%;height: 100%;top:0;left:0;background: rgba(0,0,0,.3);z-index: 1000;"></div><div class="dialog" style="width: 600px;position: fixed;left: 50%;top: 50%;margin: -100px 0 0 -300px;z-index: 1001;font-size:14px;font-family:"Microsoft YaHei";"><div class="dialog-hd" style="height: 50px;line-height: 50px;padding: 0 20px;background: #f3f3f3;"><span class="dialog-close" style="float: right;display: inline-block;font-size: 20px;cursor: pointer;">×</span><h5 style="font-size: 16px;line-height: 50px;">提示</h5></div><div class="dialog-bd" style="padding: 10px 30px;background: #fff;">' + content + '</div><div class="dialog-ft" style="text-align: center;padding: 10px 0;background: #f3f3f3;"><a href="javascript:;" class="dialog-btn" style="display: inline-block;background: #f87720;height: 40px;line-height: 40px;width: 120px;color:#fff;">知道了</a></div></div>'
    $('body').append(html)
    $('.dialog-close, .dialog-btn').on('click', function () {
      window.location.reload()
      $('.shadow').remove()
      $('.dialog').remove()
    })
  }
  module.exports = {
  	_data: null,
  	_inited: false,
  	_ready: false,
  	_loading: false,
    _timer: null,
  	init: function(data){
  		if(data !== undefined){
  			this._inited = true;
  			this._set(data, true);
  			this._ready = true;
  		}
  	},
  	_get: function(){
  		if(this._ready === false){
  			throw Error('can not _get before ready.')
  		}
  		if(this._data === null){
  			return null;
  		}
  		return {id: this._data.id, nick: this._data.nick, mobile: this._data.mobile};
  	},
  	get: function(callback){
  		callback = callback || function(){};
  		if(this._ready !== false){
  			callback(this._get());
  			return;
  		}
  		this._readyList.push(callback);
  		this._getFromRemote();
  	},
  	_readyList: [],
  	_readyDone: function(){
  		for(var i=0, list=this._readyList, len=list.length; i<len; i++){
  			list[i](this._get());
  		}
  		this._readyList = [];
  	},
  	_load: function(callback){
      var self = this
  		/*
  		$.getJSON('http://i.maijia.com/restapi/user/baseinfo').then(function(json){
  			callback(json);
  		});
  		*/
      self._stopCheck()
  		if($.cookie('token')){
              var dataType='json'
              if(window.navigator.userAgent.indexOf("MSIE 8.0") || window.navigator.userAgent.indexOf("MSIE 9.0") ){
                dataType='jsonp'
              }
              $.ajax({
                  url:'https://login.'+redomain+'.com/user/login/synchronization?token='+$.cookie('token'),
                  dataType:dataType,
                  xhrFields: {withCredentials: true},
                  success: function(data){
  
                      //读取cookies
                      function getCookie(name)
                      {
                          var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
  
                          if(arr=document.cookie.match(reg))
  
                              return unescape(arr[2]);
                          else
  
  
                              return null;
                      }
  
                      //删除cookies
                      function delCookie(name,domain)
                      {
                          var exp = new Date();
                          exp.setTime(exp.getTime() - 1);
                          var cval=getCookie(name);
                          if(cval!=null)
                              document.cookie= name + "="+cval+";expires="+exp.toGMTString() +";path=/;domain="+domain+".com";
                      }
                      delCookie('token', domain);
                      $.ajax({
                          url: '//i.maijia.com/restapi/user/baseinfo',
                          type: 'get',
                          dataType: 'jsonp',
                          success: function(json){
                            callback(json);
                          },
                          error:function(e){
                          }
                      });
                  },
                  error:function(e){
                  }
              });
          }else{
              $.ajax({ //没有同步token情况下 获取登录信息
                  url: '//i.maijia.com/restapi/user/baseinfo',
                  type: 'get',
                  dataType: 'jsonp',
                  success: function(json){
                    callback(json);
                  }
              });
          }
  	},
    _checkLoginOut: function () {
      var self = this,
        url = 'https://login.' + domain + '.com/user/logout/info';
      $.ajax({
        url: url,
        type: 'get',
        dataType: 'json',
        xhrFields: {
          withCredentials: true
        },
        success: function (res) {
          if (res.result === 1 && res.data === 1) {
            appendDialog('<div style="overflow:auto;padding:10px 0;"><img style="height:50px;width:50px;float:left;" src="http://cdn.maijia.com/www/www-old/resources/css/build/images/wDialog-warn.png" /><p style="margin-left: 70px;">您的账号已经有多人在线，您已被强制下线，如非您本人操作请立即登录并修改密码。<a style="color:#f60;" href="http://login.' + domain + '.com/?redirectURL=http%3A%2F%2Fwww.' + domain + '.com%2F">[重新登录]</a></p></div>')
            self._stopCheck()
          }
        },
        error: function (err) {
        }
      })
    },
    _startCheck: function () {
      var self = this
      this._timer = window.setInterval(function () {
        self._checkLoginOut()
      }, 1000 * 10)
    },
    _stopCheck: function () {
      window.clearInterval(this._timer)
    },
  	//_inited ?
  	_getFromRemote: function(){
  		var _this = this;
  		if(this._loading === true){
  			return;
  		}
  		this._loading = true;
  		this._load(function(json){
  			_this._loading = false;
  			_this._ready = true;
  			var data = json.result == 1 ? json.data : null;
  			_this._set(data, !_this._inited);
  			_this._inited = true;
  			_this._readyDone();
  
        if (json.result === 1) {
          $.cookie('user', json.data.id)
          window.SysUserInfo || (window.SysUserInfo = {})
          window.SysUserInfo.nick = json.data.id
          _this._startCheck();
        } else {
          $.cookie('user', null, { expires: -1 })
        }
  
        _this = null;
  		});
  	},
  	_set: function(obj, silent){
  		silent = silent === true ? true : false;
  		var data = this._data;
  		if(obj === null && data === null){
  			return;
  		}else if(obj === null){
  			this._data = null;
  			!silent && this.emit("remove");
  		}else if(data === null){
  			this._data = {
  				id: obj.id, nick: obj.nick||'', mobile: obj.mobile||''
  			};
  			//多个事件handler如果改动参数，引用会被改动。 这里只保证自己的不被改动。 todo: event emit不可变数据
  			!silent && this.emit("add", this._get());
  		}else{
  			var change = data.id !== obj.id || data.nick != obj.nick || data.mobile != obj.mobile;
  			this._data = {
  				id: obj.id, nick: obj.nick||'', mobile: obj.mobile||''
  			};
  			!silent && change && this.emit("update", this._get());
  		}
  
  	},
  	_eventMap: {},
  	on: function(name, handler, context){
  		var map = this._eventMap[name];
  		if(!map){
  			map = this._eventMap[name] = [];
  		}
  		map.push([handler,context||null]);
  	},
  	emit: function(name, args){
  		var list = this._eventMap[name] || [];
  		for(var i=0,len=list.length, handler, context; i<len; i++){
  			handler = list[i][0];
  			context = list[i][1];
  			handler.apply(handler, [].slice(arguments,1));
  		}
  	},
  	removeListener: function(name, fn){
  		if(!name){
  			this._eventMap = {};
  		}else {
  			if(!this._eventMap[name]){
  				return;
  			}
  			if(fn === undefined){
  				this._eventMap[name] = null;
  			}else{
  				var list = this._eventMap[name];
  				for(var i=0, len=list.length; i<len; i++){
  					if(fn === list[i][0]){
  						this._eventMap[name].splice(i,1);
  						break;
  					}
  				}
  			}
  		}
  	},
  	refresh: function(){
  		this._ready = false;
  		this._getFromRemote();
  	},
  	destroy: function(){
  		this._data = null;
  		this._inited = false;
  		this._ready = false;
  		this._readyList = [];
  		this._eventMap = {};
  	}
  }
  

});

;/*!components/maijia-session/index.js*/
define('components/maijia-session/index', function(require, exports, module) {

  var session = require('components/maijia-session/session');
  module.exports = session;
  
  //sessionStorage 切换tab无效
  //localStorage 无法跨domain
  //todo: 本地通信实现后， 再加上session窗口同步
  session.init();

});

;/*!components/maijia-session/jquery.xdomainrequest.min.js*/
define('components/maijia-session/jquery.xdomainrequest.min', function(require, exports, module) {

  /*!
   * jQuery-ajaxTransport-XDomainRequest - v1.0.4 - 2015-03-05
   * https://github.com/MoonScript/jQuery-ajaxTransport-XDomainRequest
   * Copyright (c) 2015 Jason Moon (@JSONMOON)
   * Licensed MIT (/blob/master/LICENSE.txt)
   */
  (function(a){if(typeof define==='function'&&define.amd){define(['jquery'],a)}else if(typeof exports==='object'){module.exports=a(require('components/jquery/jquery'))}else{a(jQuery)}}(function($){if($.support.cors||!$.ajaxTransport||!window.XDomainRequest){return $}var n=/^(https?:)?\/\//i;var o=/^get|post$/i;var p=new RegExp('^(\/\/|'+location.protocol+')','i');$.ajaxTransport('* text html xml json',function(j,k,l){if(!j.crossDomain||!j.async||!o.test(j.type)||!n.test(j.url)||!p.test(j.url)){return}var m=null;return{send:function(f,g){var h='';var i=(k.dataType||'').toLowerCase();m=new XDomainRequest();if(/^\d+$/.test(k.timeout)){m.timeout=k.timeout}m.ontimeout=function(){g(500,'timeout')};m.onload=function(){var a='Content-Length: '+m.responseText.length+'\r\nContent-Type: '+m.contentType;var b={code:200,message:'success'};var c={text:m.responseText};try{if(i==='html'||/text\/html/i.test(m.contentType)){c.html=m.responseText}else if(i==='json'||(i!=='text'&&/\/json/i.test(m.contentType))){try{c.json=$.parseJSON(m.responseText)}catch(e){b.code=500;b.message='parseerror'}}else if(i==='xml'||(i!=='text'&&/\/xml/i.test(m.contentType))){var d=new ActiveXObject('Microsoft.XMLDOM');d.async=false;try{d.loadXML(m.responseText)}catch(e){d=undefined}if(!d||!d.documentElement||d.getElementsByTagName('parsererror').length){b.code=500;b.message='parseerror';throw'Invalid XML: '+m.responseText;}c.xml=d}}catch(parseMessage){throw parseMessage;}finally{g(b.code,b.message,c,a)}};m.onprogress=function(){};m.onerror=function(){g(500,'error',{text:m.responseText})};if(k.data){h=($.type(k.data)==='string')?k.data:$.param(k.data)}m.open(j.type,j.url);m.send(h)},abort:function(){if(m){m.abort()}}}});return $}));

});

;/*!components/maijia-tool/src/tool.js*/
define('components/maijia-tool/src/tool', function(require, exports, module) {

  module.exports = function(type){
  	var $ = require('components/jquery/jquery');
  	var TEMP ="<div class=\"c-maijia-tool\">\r\n    <div class=\"maijia-tool-moniter\"></div>\r\n    <div class=\"maijia-tool-concert\"></div>\r\n</div>\r\n";
  	var Template = require('components/art-template/template');
  	var toolCompile = Template.compile("<style type=\"text/css\">*{text-decoration:none}.c-maijia-tool{z-index:3;position:fixed;right:0;top:25%;width:38px;border-radius:3px;font-size:12px;cursor:pointer;color:#9C9C9C}.c-maijia-tool .maijia-tool-moniter{border:1px solid #e5e5e5;background:#fff;margin-bottom:20px}.c-maijia-tool .maijia-tool-moniter .toolm{padding:7px;font-size:12px;padding-bottom:0;text-align:center;color:#6c6c6c;font-family:Helvetica,\"PingFang SC\",Simsun,Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\";word-break:normal;line-height:14px}.c-maijia-tool .maijia-tool-moniter .toolm:hover{color:#fd8944}.c-maijia-tool .maijia-tool-moniter .monitor-num{padding:5px 0;text-align:center;color:#ff8939}.c-maijia-tool .maijia-tool-moniter .line{margin:0 5px;height:1px;background:#e5e5e5}.c-maijia-tool img{display:block;margin:0 auto}.c-maijia-tool .maijia-tool-concert{height:78px;background:#FFF;border:1px solid #E5E5E5}.c-maijia-tool .maijia-tool-concert .qq{overflow:hidden;height:40px;text-align:center;border-bottom:1px solid #e5e5e5}.c-maijia-tool .maijia-tool-concert .qq img{width:18px;height:20px;margin-top:10px}.c-maijia-tool .maijia-tool-concert .qq:hover{background:#f9f9f9}.c-maijia-tool .maijia-tool-concert .qq:hover img{display:none}.c-maijia-tool .maijia-tool-concert .qq:hover .tt{display:block}.c-maijia-tool .maijia-tool-concert .qq .tt{display:none;height:24px;width:24px;line-height:1em;margin:9px auto 0}.c-maijia-tool .maijia-tool-concert .top{height:40px;text-align:center}.c-maijia-tool .maijia-tool-concert .top img{margin-top:6px;width:18px;height:10px}.c-maijia-tool .maijia-tool-concert .top .tt{height:17px;margin-top:3px}</style>\r\n\t<div class=\"qq J_qq\" id=\"J_tool_bind_qq\">\r\n\t\t<img src=\"//cdn.maijia.com/maijia-common/components/maijia-tool/src/qq.png\" alt=\"\">\r\n\t\t<div class=\"tt\">\r\n\t\t\t联系客服\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"top J_top\">\r\n\t\t<img src=\"//cdn.maijia.com/maijia-common/components/maijia-tool/src/top.png\" alt=\"\">\r\n\t\t<div class=\"tt\">顶部</div>\r\n\t</div>\r\n");
  	var moniterCompile = Template.compile("<div class=\"tool-monitor\">\r\n  <a href=\"http://www.taosj.com/index.html#/user/index/?from=top\" style=\"text-decoration:none\" target=\"_blank\"><div class=\"tool-monitor-shop toolm\">\r\n      我监控的店铺\r\n  </div></a>\r\n  <a href=\"http://www.taosj.com/index.html#/user/index/?from=top\" style=\"text-decoration:none\" target=\"_blank\"><div class=\"monitor-num\">\r\n      ({{data.shop||0}})\r\n  </div></a>\r\n  <div class=\"line\"></div>\r\n  <a href=\"http://www.taosj.com/index.html#/user/index/?type=industry\" style=\"text-decoration:none\" target=\"_blank\"><div class=\"tool-monitor-industry toolm\">\r\n      我监控的行业\r\n  </div></a>\r\n  <a href=\"http://www.taosj.com/index.html#/user/index/?type=industry\" style=\"text-decoration:none\" target=\"_blank\"><div class=\"monitor-num\">\r\n      ({{data.industry||0}})\r\n  </div></a>\r\n  <div class=\"line\"></div>\r\n  <a href=\"http://www.taosj.com/index.html#/user/index/?type=item\" style=\"text-decoration:none\" target=\"_blank\"><div class=\"tool-monitor-tool toolm\">\r\n      我监控的宝贝\r\n  </div></a>\r\n  <a href=\"http://www.taosj.com/index.html#/user/index/?type=item\" style=\"text-decoration:none\" target=\"_blank\"><div class=\"monitor-num\">\r\n    ({{data.item||0}})\r\n  </div></a>\r\n</div>\r\n");
  	var data={};
  	$(function(){
  		var $el, width, tt, ttime,lh;
  		var lhtest=[
  			/^http\:\/\/www.taosj.com\/tool\/tool.htm\#\/shop\/diagnosis\//,
  			/^http\:\/\/www.taosj.com\/index.html\#\/surecharge\//,
  			/^http\:\/\/www.taosj.com\/events\/meal.html/,
  			/^http\:\/\/www.taosj.com\/index.html\#\/user\//,
  			/^http\:\/\/www.taosj.com\/tool\/ztc.htm\#wordResolve/,
  			/^http\:\/\/www.taosj.com\/tool\/tool.htm\#\/shop_diagnosis\//
  		];
  		var lht=false;
  		if($el){
  			return;
  		}
  		$('.c-maijia-tool').remove();
  		$el = $(TEMP).appendTo('body');
  		lh=location.href;
  		for(var i=0;i<lhtest.length;i++){
  			if(lhtest[i].test(lh)){
  					lht=true;
  			}
  		}
  		if(location.hostname=='www.taosj.com'&&lh!='http://www.taosj.com/'&&!lht){
  			$.get('/user/monitor/shop/list',{api_name:'user_monitor_shop_list'},function(json){
  				data.shop=JSON.parse(json).data.total;
  				$.get('/user/monitor/industry/list',{api_name:'user_monitor_industry_list'},function(json){
  					data.industry=JSON.parse(json).data.total;
  					$.get('/user/item/all/list',{api_name:'user_item_all_list'},function(json){
  						data.item=JSON.parse(json).data.total;
  						$el.find('.maijia-tool-moniter').html(moniterCompile({data:data}));
  					})
  				})
  			})
  			$el.find('.maijia-tool-moniter').html(moniterCompile({data:data}));
  			$el.find('.maijia-tool-concert').html(toolCompile({}));
  		}else{
  			$el.css('top','60%');
  			$el.find('.maijia-tool-moniter').hide();
  			$el.find('.maijia-tool-concert').html(toolCompile({}));
  		}
  		var $qq = require('components/maijia-qq/qq');
  		require('components/maijia-qq/qq').bind('J_tool_bind_qq');
  
  		$el.find('.J_top').on('click',function(){
  			window.scrollTo(0,0);
  		});
  	});
  }
  

});

;/*!components/maijia-top/src/nick-dialog.js*/
define('components/maijia-top/src/nick-dialog', function(require, exports, module) {

  var session = require('components/maijia-session/index'),
      $ = require('components/jquery/jquery'),
      Template = require('components/art-template/template');
  var temp = "<style>\r\n    .nick-dialog .nick-bk{\r\n        background-color: #000000;\r\n        filter:alpha(opacity=60);\r\n        -moz-opacity:0.6;\r\n        opacity: 0.6;\r\n        position: fixed;\r\n        left: 0;\r\n        top: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        z-index: 1000;\r\n    }\r\n    .nick-dialog .nick-iframe{\r\n        background-color: #ffffff;\r\n        position: absolute;\r\n        left: 50%;\r\n        margin-left: -236px;\r\n        top: 100px;\r\n        z-index: 1001;\r\n    }\r\n</style>\r\n<div class=\"nick-dialog J_nick_dialog\">\r\n    <div class=\"nick-bk\"></div>\r\n    <div class=\"nick-iframe\">\r\n        <iframe id=\"nickDialog\" name=\"nickDialog\"  src=\"//i.maijia.com/nick-dialog.html\" frameborder=\"0\" style=\"width:472px;height: 300px; \"></iframe>\r\n    </div>\r\n</div>";
  
  function addEvent(name, fn){
      if(window.addEventListener){
          window.addEventListener(name, fn, false);
      }else if(window.attachEvent){
          window.attachEvent('on' + name, fn);
      }else{
          window['on' + name] = fn;
      }
  }
  addEvent('message', function(e){
      if(e.source != window.frames['nickDialog']){
          return;
      }
  
      var msg = e.data;
      if(msg == 'success'){
          window.location.reload();
      }
  });
  
  function check(){
      var list1 = [
      '//www.maijia.com/index.html#/seniorcharge',
      '//www.maijia.com/events/meal.html',
      '//www.maijia.com/events/xiaoye.html',
      '//www.maijia.com/events/fenxiao.html',
      '//www.maijia.com/events/senior.html',
      '//www.maijia.com/index.html#/surecharge',
      '//www.maijia.com/events/xueyuan.html'
      ],
      list2 = ['//job.maijia.com'],
      i = 0, j = 0, url = window.location.href;
      for(; i < list1.length; i++){
          if(url.indexOf(list1[i]) != -1){
              break;
          }
      }
      for(; j < list2.length; j++){
          if(url == list2[j]){
              break;
          }
      }
      if(i == list1.length && j == list2.length){
          session.get(function(json){
              if(json && !json.nick){
                  $('body').find('.J_nick_dialog').show();
              }
          });
      }
  }
  $(function(){
      check();
  });
  
  function isMobile() {
      var regex_match = /(nokia|iphone|android|motorola|^mot-|softbank|foma|docomo|kddi|up.browser|up.link|htc|dopod|blazer|netfront|helio|hosin|huawei|novarra|CoolPad|webos|techfaith|palmsource|blackberry|alcatel|amoi|ktouch|nexian|samsung|^sam-|s[cg]h|^lge|ericsson|philips|sagem|wellcom|bunjalloo|maui|symbian|smartphone|midp|wap|phone|windows ce|iemobile|^spice|^bird|^zte-|longcos|pantech|gionee|^sie-|portalmmm|jigs browser|hiptop|^benq|haier|^lct|operas*mobi|opera*mini|320x320|240x320|176x220)/i;
      var u = navigator.userAgent;
      if (null == u) {
          return true;
      }
      var result = regex_match.exec(u);
  
      if (null == result) {
          return false;
      } else {
          return true;
      }
  }
  
  module.exports = function(selector){
      var $temp = $(temp);
      if(isMobile()){
          $temp.find('.nick-iframe').css('marginLeft', '-160px').find('#nickDialog').css('width', '320px');
      }
      session.get(function(data){
          if($('body').find('.J_nick_dialog').length){
              return;
          }
          if(data && !data.nick){
              if(selector){
                  $(selector).append($temp);
              }else{
                  $('body').append($temp);
              }
          }
          
      });
      
  }

});

;/*!components/maijia-top/src/menu-conf.js*/
define('components/maijia-top/src/menu-conf', function(require, exports, module) {

  module.exports = [
      {
          name:'会员功能',
          url:'//www.maijia.com/activity/user/vip/index.html?from=top'
      },
      {
          name:'购买记录',
          url:'//order.maijia.com/index.html#/list/?from=top'
      },
      {
          name:'个人设置',
          url:'//i.maijia.com/index.html?from=top'
      },
      
      {
          name:'我的红包',
          url:'//hongbao.maijia.com/index.html#/list/?from=top'
      }
  ]

});

;/*!components/maijia-top/src/notice.js*/
define('components/maijia-top/src/notice', function(require, exports, module) {

  var tplText = '<div class="J_notice" style="text-align: center;background: #FFFAEA;color:#e8364b;font-size: 14px;padding:5px;font-family: Helvetica,PingFang SC,\'Microsoft YaHei\',Arial,\'WenQuanYi Micro Hei\',tohoma,sans-serif;">{{text}}</div>';
  var tplImg = '<div style="width: 100%; background: url({{bgImg}})"><a href="{{link}}" target="_blank"><img src="{{img}}" style="max-width:1180px;margin: 0 auto; display: block;"/></a></div>';
  
  var $ = require('components/jquery/jquery');
  
  function showNotice(opt){
      var tpl = tplText;
      if(opt.image_optional){
          tpl = tplImg;
          tpl = tpl.replace(/\{\{img\}\}/,opt.image_optional).replace(/\{\{bgImg\}\}/,opt.image_bg_optional||'').replace(/\{\{link\}\}/,opt.url||'');
      }else{
          tpl = tpl.replace(/\{\{text\}\}/,opt.title||'').replace(/\{\{link\}\}/,opt.url||'');
      }
      $('body').prepend(tpl);
  }
  var previewStr='';
  if(location.href.indexOf('ocms_preview=1')!=-1){
      previewStr = '&ocms_preview=1';
  }
  $.ajax({
      url:'http://www.maijia.com/cs/operation/contents?typeCode=public_notice'+previewStr,
      // type:"jsonp",
      dataType:'jsonp',
      success:function(data){
          var pathname = window.location.pathname, hostname = window.location.hostname,
          noticeOpt;
          data.data.forEach(function(it){
              if(it._id=='all'){
                  noticeOpt = it;
              }else{
                   if(!noticeOpt){
                      if(it._id=='xueyuan'){
                          if(hostname=='xueyuan.maijia.com'){
                              noticeOpt = it;
                          }
                      }else if(it._id=='taobao'){
                          if((pathname.indexOf('/index.html')==0
                              ||pathname.indexOf('/industry')==0
                              ||pathname.indexOf('/tool')==0)
                                  &&hostname=='www.maijia.com'){
                              noticeOpt = it;
                          }
                      }else{
                          if(it._id=='/'){
                              if(pathname=='/'&&hostname=='www.maijia.com'){
                                  noticeOpt = it;
                              }
                          }else{
                              if(pathname.indexOf('/'+it._id)==0){
                                  noticeOpt = it;
                              }
                          }
                      }
                  }
              }
          });
          noticeOpt&&showNotice(noticeOpt);
      }
  })

});

;/*!components/maijia-top/src/index.js*/
define('components/maijia-top/src/index', function(require, exports, module) {

  var $ = require('components/jquery/jquery');
      session = require('components/maijia-session/index'),
      Template = require('components/art-template/template');
  
  if(location.pathname.indexOf('/wish')==0||location.pathname.indexOf('/ebay')==0||location.pathname.indexOf('/amazon')==0){
  
  }else{
  	$('body').css('-webkit-font-smoothing','antialiased');
  	$('body').css('-moz-osx-font-smoothing','grayscale');
  }
  require('components/maijia-top/src/nick-dialog')();
  function getSite(){
  	var url = location.href;
  	if(url.indexOf('//xueyuan.maijia.com')<8&&url.indexOf('//xueyuan.maijia.com')>-1){
  		return 'xueyuan';
  	}
  	if(url.indexOf('//www.maijia.com/news')<0&&url.indexOf('//www.maijia.com/news')>-1){
  		return 'news'
  	}
  	if(url.indexOf('//www.maijia.com/software')<8&&url.indexOf('//www.maijia.com/news')>-1){
  		return 'software'
  	}
  	return '';
  }
  
  var checkUserDropList = function(cb){
  	var dropMenu =  $('#J_c-maijia-top .J_user_drop'),
  		path = getSite(),
  		conf = require('components/maijia-top/src/menu-conf'),
  		i=0,item,k=0,subitem,html='';
  
  	for(;i<conf.length;i++){
  		item = conf[i];
  
  		if(item.type==path&&item.sublist){
  			if(i==0){
  				html+='<a class="link user_nav noborder current" rel="nofollow" target="_blank" href="'+item.url+'">'+item.name+'</a>';
  			}else{
  				html+='<a class="link user_nav current" rel="nofollow" target="_blank" href="'+item.url+'">'+item.name+'</a>';
  			}
  			k=0;
  			for(;k<item.sublist.length;k++){
  				subitem = item.sublist[k];
  				html+='<a class="link subuser_nav" rel="nofollow" target="_blank" href="'+subitem.url+'">'+subitem.name+'</a>';
  			}
  		}else{
  			if(i==0){
  				html+='<a class="link user_nav noborder" rel="nofollow" target="_blank" href="'+item.url+'">'+item.name+'</a>';
  			}else{
  				html+='<a class="link user_nav" rel="nofollow" target="_blank" href="'+item.url+'">'+item.name+'</a>';
  			}
  		}
  	}
  	dropMenu.append(html);
  	dropMenu[0].style.display = ''
  }
  var exPj = {
  	$el: null,
  	config:{
  		//1 活动中,0无活动
  		events:0
  	},
  	init: function(){
  		this.$el = $('#J_c-maijia-top');
  		this.render();
  		this._eventBind();
  		this._loadAndRenderNickAndMessage();
  		checkUserDropList();
  	},
  	/**
  	 * @method renderTo
  	 * @param {jquery/dom selector} selector
  	*/
  	renderTo: function(selector){
  		var LAYOUT = "<div class=\"c-maijia-top\" id=\"J_c-maijia-top\">\r\n\t<div style=\"width:1180px;margin:0 auto\">\r\n\t\t<span style=\"float:left\">您好，欢迎来到<a href=\"http://www.maijia.com/\" style=\"color:#ff8939\">卖家网</a>!</span>\r\n\t\t<span style=\"float:right\">\r\n\t\t\t<a rel=\"nofollow\" href=\"http://i.maijia.com/index.html\" style=\"margin-right:21px\">个人中心</a><a rel=\"nofollow\" href=\"javascript:;\" style=\"margin:0 21px 0 26px;\">网站导航</a>\r\n\t\t</span>\r\n\t\t<br style=\"clear:both\">\r\n\t</div>\r\n</div>\r\n";
  		$(selector).html(LAYOUT);
  		this.init();
  	},
  	render: function(){
          if(!!~window.location.href.indexOf('//www.taosj.com/')){
              this.domain = 'taosj';
              var HTML = Template.compile("<div>\r\n<div class=\"c-data-top\" id=\"J_c-data-top\">\r\n\t<div class=\"inner\">\r\n\t\t<div class=\"left clear-fix\">\r\n\t\t\t<span class=\"hello\">您好，欢迎来到<a href=\"http://www.{{domain}}.com/\"><em>淘数据!</em></a></span>\r\n            <span class=\"user fade-in-0 J_User\">\r\n\t\t\t</span>\r\n\t\t</div>\r\n\t\t<div class=\"right\">\r\n\t\t\t<ul class=\"clear-fix\">\r\n\t\t\t\t<li class=\"menu J_Message\">\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"menu\">\r\n\t\t\t\t\t<div class=\"menu-hd\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/industry/index.html\">行业数据</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"menu\">\r\n\t\t\t\t\t<div class=\"menu-hd\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/index.html#/shop/detail/?id=71644724\">店铺监控</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"menu\">\r\n\t\t\t\t\t<div class=\"menu-hd\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/index.html#/shop/detail/item_analysis/?type=hot&id=71644724\">宝贝监控</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"menu\">\r\n\t\t\t\t\t<div class=\"menu-hd\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/tool/ztc.htm#wordPrecise\">直通车选词</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"menu\">\r\n\t\t\t\t\t<div class=\"menu-hd\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/tool/tool.htm#/shop/diagnosis/\">店铺诊断</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"menu\">\r\n\t\t\t\t\t<div class=\"menu-hd\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/tool/tool.htm#/equities/\">宝贝排名</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n                <li class=\"menu\">\r\n                    <div class=\"menu-hd\">\r\n                        <a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/tool/tool.htm#/optimize_market/title/\">标题诊断</a>\r\n                    </div>\r\n                </li>\r\n                <li class=\"menu\">\r\n                    <div class=\"menu-hd\">\r\n                        <a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/tool/tool.htm#/reduce_weight/\">隐形降权</a>\r\n                    </div>\r\n                </li>\r\n\t\t\t\t<li class=\"menu\">\r\n\t\t\t\t\t<div class=\"menu-hd\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://i.maijia.com/index.html#/user/info/\">个人中心<span class=\"triangle\"></span></a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"menu-bd links J_user_drop\">\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.taosj.com/index.html#/user/index/?from=top\">已监控的店铺</a>\r\n\t\t\t\t\t\t<a target=\"_blank\" class=\"link\" rel=\"nofollow\" href=\"http://www.taosj.com/index.html#/user/index/?type=industry&from=top\">已监控的行业</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n</div>\r\n");
              var css = ".c-data-top{line-height:34px;font-size:12px;font-family:Helvetica,\"PingFang SC\",Simsun,Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\";background:#f5f5f5;color:#666;border-bottom:1px solid #eee}.c-data-top:after,.c-data-top .clear-fix:after{visibility:hidden;display:block;height:0;content:\"\";font-size:0;clear:both}.c-data-top .ui-button{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:inline-block;position:relative;font-size:18px;line-height:40px;height:40px;text-align:center;white-space:nowrap;vertical-align:middle;padding:0 20px;margin:0 1px;background-color:#FD8944;color:#fff;color:rgba(255,255,255,.84);border:0;background-image:none;cursor:pointer;text-transform:uppercase;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-touch-action:manipulation;touch-action:manipulation}.c-data-top .ui-button:hover{background-color:#f60;-webkit-box-shadow:0 1px 2px 0 rgba(0,0,0,.12);box-shadow:0 1px 2px 0 rgba(0,0,0,.12)}.c-data-top .ui-button-raised{box-shadow:0 1px 2px 0 rgba(0,0,0,.12);transition:box-shadow .28s cubic-bezier(0.4,0,.2,1)}.c-data-top .ui-button-flat{background:0 0;box-shadow:none;font-weight:500;color:#489bb7}.c-data-top .ui-button-flat:hover{background-color:rgba(0,150,136,.2)}.c-data-top .ui-button-fab{margin:0;padding:15px;font-size:26px;width:56px;height:56px;border-radius:100%}.c-data-top .ui-button-fab:before{display:inline-block;speak:none;text-decoration:inherit;content:\"*\"}.c-data-top .ui-button-disabled{pointer-events:none;cursor:not-allowed;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none;opacity:.65}.c-data-top a.ui-button{color:#fff}.c-data-top a.ui-button:hover{text-decoration:none;color:#fff}.c-data-top .ui-button-default{background-color:#fff;background-color:rgba(10,10,10,0);color:#333;color:rgba(0,0,0,.84)}.c-data-top .ui-button-default:hover{background-color:#fff;background-color:rgba(10,10,10,0)}.c-data-top .ui-button-small{font-size:14px;line-height:30px;height:30px;padding:0 15px}.c-data-top .ui-button-big{font-size:20px;line-height:50px;height:50px;padding:0 40px}.c-data-top .ui-button-yellow{background-color:#fec53e}.c-data-top .ui-button-yellow:hover{background-color:#fec53e}.c-data-top .ui-button-flat.ui-button-yellow{background:0 0;color:#fec53e}.c-data-top .ui-button-flat.ui-button-yellow:hover{background:0 0}.c-data-top .order{padding:0 5px;margin:8px 0;display:inline-block;height:18px;margin-left:10px;background:#FD8944;color:#fff;line-height:18px}.c-data-top .order:hover{color:#fff;text-decoration:none}.c-data-top a{text-decoration:none;color:#666}.c-data-top a:hover{text-decoration:underline;color:#FD8944}.c-data-top a,.c-data-top em{font-family:Helvetica,\"PingFang SC\",Simsun,Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\"}.c-data-top .menu{position:relative;z-index:1000;padding:0}.c-data-top .menu .menu-hd{box-sizing:border-box;height:34px;position:relative;z-index:1002;border-width:0 1px;border-style:solid;border-color:transparent;padding:0 9px}.c-data-top .menu .menu-bd{display:none;position:absolute;z-index:1001;left:0;top:100%;border:1px solid #f5f5f5;border-top:0;margin-top:1px;padding:3px 0;background:#fff;min-width:100%;box-sizing:border-box}.c-data-top .menu.menu-hover .menu-hd{border-color:#eee;background:#fff}.c-data-top .menu.menu-hover .menu-hd:after{content:'';width:100%;height:1px;position:absolute;left:0;bottom:-1px;background:#fff}.c-data-top .menu.menu-hover .menu-bd{display:block;-webkit-transform:translateZ(0);transform:translateZ(0)}.c-data-top .triangle{display:inline-block;width:8px;height:4px;margin:0 -2px 0 5px;vertical-align:2px;background:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAYAAACzzX7wAAAAAXNSR0IArs4c6QAAADtJREFUCB1jPHv2bMP////rGRkZG4yNjRsZgABJrJERTaAByGdE1gBWgKwIxEY2DcSHA5DRQFwPFwAyAK/AKLjDe3scAAAAAElFTkSuQmCC\") 0 0 no-repeat}.c-data-top .inner{width:1180px;margin:0 auto}.c-data-top .left{float:left;display:inline}.c-data-top .left .hello{float:left;display:inline}.c-data-top .left .hello em{font-style:normal;color:#FD8944;font-weight:400}.c-data-top .left .user{float:left;margin-left:15px}.c-data-top .left .user em{font-style:normal;color:#FD8944;font-weight:400}.c-data-top .left .user ul{padding:0;margin:0}.c-data-top .left .user li{float:left;padding:0 5px;list-style-type:none}.c-data-top .left .user li.menu{padding:0}.c-data-top .left .user .account-info{width:350px;padding-top:5px;min-height:117px;background:url(loading.gif) #fff center center no-repeat}.c-data-top .left .user .account-info table{border-collapse:collapse;border-spacing:0;background:#fff;width:100%;font-size:100%;font-family:inherit;font-weight:inherit;font-style:inherit}.c-data-top .left .user .account-info table td{padding:5px 10px;line-height:24px;color:#777;white-space:normal;border-top:1px solid #eee}.c-data-top .left .user .account-info table td p{padding:0;margin:0}.c-data-top .left .user .account-info table td em{font-style:normal;color:#FD8944}.c-data-top .left .user .account-info table td strong{font-weight:700;color:#FD8944}.c-data-top .left .user .account-info table tr:first-child td{border-top:0}.c-data-top .left .user .ui-button{color:#fff}.c-data-top .left .user .ui-button:hover{text-decoration:none}.c-data-top .right{float:right;display:inline}.c-data-top .right ul{padding:0;margin:0}.c-data-top .right li{float:left;padding:0 10px;list-style-type:none}.c-data-top .right li.menu{padding:0}.c-data-top .links a{display:inline-block;padding:0 6px;line-height:28px;height:28px;margin:1px 6px;min-width:6em;white-space:nowrap;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}.c-data-top .links a em{color:#FD8944;margin-left:5px;font-style:normal}.c-data-top .links a:hover{background:#FD8944;color:#fff;text-decoration:none}.c-data-top .links a:hover em{color:#fff}.c-data-top .J_Message{display:none}.c-data-top .message-icon{position:relative;display:inline-block;line-height:14px;padding:0 6px;background:#FD8944;color:#fff;margin-right:6px;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}.c-data-top .message-icon b{width:0;height:0;position:absolute;right:-3px;bottom:0;border-width:6px;border-color:transparent transparent #FD8944;border-style:dashed dashed solid;font-size:0}.c-data-top .message-icon.dark{background:0 0;color:inherit}.c-data-top .message-icon.dark b{border-color:transparent}.c-data-top .navigator .menu-hd a{padding-left:16px;background:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAYAAAA1WQxeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDExNTI4RTgzRjU1MTFFNjg1OUY4MEZBRjE0OEFEMTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDExNTI4RTkzRjU1MTFFNjg1OUY4MEZBRjE0OEFEMTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpEMTE1MjhFNjNGNTUxMUU2ODU5RjgwRkFGMTQ4QUQxNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpEMTE1MjhFNzNGNTUxMUU2ODU5RjgwRkFGMTQ4QUQxNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Prtb+d0AAABISURBVHjabI0BCgAgCANb+Kme2KtXGdmMBFHcbYK9saTC7HuyAsA3zuNamfl6jSpCEvhYni8WeCTIxAa+vz2CG2CIB5S0IcAAwKIc1Uqx7EMAAAAASUVORK5CYII=\") 0 center no-repeat}.c-data-top .navigator .menu-bd{left:auto;right:0;text-align:left;padding:0}.c-data-top .navigator .menu-bd .navigator-list{padding:20px 0;width:726px}.c-data-top .navigator .menu-bd .navigator-list .navigator-item{float:left;width:106px;padding-left:14px;border-left:1px solid #eee}.c-data-top .navigator .menu-bd .navigator-list .navigator-item:first-child{border-left:0}.c-data-top .navigator .menu-bd .navigator-list .navigator-item h3{margin:0 0 11px 2px;line-height:16px}.c-data-top .navigator .menu-bd .navigator-list .navigator-item h3 a{display:inline-block;font-family:Helvetica,\"PingFang SC\",\"Microsoft YaHei\",Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\";font-size:14px;line-height:16px;padding:0}.c-data-top .navigator .menu-bd .navigator-list .navigator-item li{float:none;line-height:28px;padding:1px 0}.c-data-top .navigator .menu-bd .navigator-list .navigator-item li a{display:inline-block;line-height:28px;padding:0 6px;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}.c-data-top .navigator .menu-bd .navigator-list .navigator-item li a:hover{text-decoration:none;background-color:#FD8944;color:#fff}.c-data-top .navigator .menu-bd .navigator-list .navigator-item li a img{vertical-align:middle;margin-left:3px;border:0}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-data h3 a{color:#FD8944}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-xueyuan h3 a{color:#48b292}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-news h3 a{color:#8d5858}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-job h3 a{color:#2a83a2}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-software h3 a{color:#188cf6}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-mall h3 a{color:#c60000}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-km h3 a{color:#FD8944}.c-data-top .navigator .menu-bd .navigator-list .navigator-item.navigator-item-bbs h3 a{color:#e4744d}";
          }else{
              this.domain = 'maijia';
              var HTML = Template.compile("<div class=\"c-maijia-top\" id=\"J_c-maijia-top\">\r\n    <div class=\"inner\">\r\n        <div class=\"left clear-fix\">\r\n            <span class=\"hello\">您好，欢迎来到<a href=\"http://www.{{domain}}.com/\"><em>卖家网！</em></a></span>\r\n            <span class=\"user fade-in-0 J_User\">\r\n\t\t\t</span>\r\n        </div>\r\n        <div class=\"right J_Right\">\r\n            <ul class=\"clear-fix\">\r\n                <li class=\"menu\">\r\n                    <div class=\"menu-hd menu-hd-no\">\r\n                        <a class=\"link\" rel=\"nofollow\" target=\"_blank\" href=\"http://www.maijia.com/activity/custom-data/index.html\">数据定制</a>\r\n                    </div>\r\n                </li>\r\n                <li class=\"menu\">\r\n                    <div class=\"menu-hd menu-hd-no\">\r\n                        <a class=\"link\" rel=\"nofollow\" href=\"javascript:void(0)\">手机客户端</a>\r\n                    </div>\r\n                    <div class=\"menu-bd app-code\">\r\n                        <div class=\"hbk\">\r\n                        <!--<div class=\"aw\"></div>-->\r\n                        <div class=\"ct code-ct\">\r\n                            <img src=\"//cdn.maijia.com/maijia-common/components/maijia-top/src/app-code.png\" alt=\"\">\r\n                        </div>\r\n                    </div>\r\n                    </div>\r\n                </li>\r\n\r\n                <li class=\"menu fade-in-0 J_Message\">\r\n                </li>\r\n\r\n                <li class=\"menu\">\r\n                    <div class=\"menu-hd menu-down\">\r\n                        <a class=\"link\" rel=\"nofollow\" href=\"http://www.{{domain}}.com/activity/user/vip/index.html\">\r\n                            个人中心\r\n                            <span class=\"iconfont icon-down\">&#xe601;</span>\r\n                        </a>\r\n\r\n                    </div>\r\n                    <div class=\"menu-bd links J_user_drop\" style=\"display: none;\">\r\n                    </div>\r\n                </li>\r\n\r\n                <li class=\"menu navigator \">\r\n                    <div class=\"menu-hd menu-down\">\r\n                        <a class=\"link\" rel=\"nofollow\" href=\"javascript:;\"><span class=\"iconfont icon-list\">&#xe6a6;</span>网站导航<span class=\"iconfont icon-down\">&#xe601;</span></a>\r\n                    </div>\r\n                    <div class=\"menu-bd\">\r\n                        <div class=\"clear-fix navigator-list\">\r\n                            <div class=\"navigator-item navigator-item-data\">\r\n                                <h3><a href=\"http://www.maijia.com/wish/?from=top\" target=\"_blank\">卖家数据</a></h3>\r\n                                <ul>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/index.html?from=top\" target=\"_blank\">淘数据</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/wish/?from=top\" target=\"_blank\">Wish数据</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/wish/plugin.html?from=top\" target=\"_blank\">Wish数据插件</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/ebay/?from=top\" target=\"_blank\">eBay数据</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/amazon/?from=top\" target=\"_blank\">Amazon工具</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/activity/custom-data/index.html?from=top\" target=\"_blank\">数据定制</a></li>\r\n                                </ul>\r\n                            </div>\r\n                            <div class=\"navigator-item navigator-item-xueyuan\">\r\n                                <h3><a href=\"http://xueyuan.maijia.com/?from=top\" target=\"_blank\">卖家学院</a></h3>\r\n                                <ul>\r\n                                    <li><a class=\"link\" href=\"http://xueyuan.maijia.com/search/37?from=top\" target=\"_blank\">免费好课</a></li>\r\n                                    <li><a class=\"link\" href=\"http://xueyuan.maijia.com/search?from=top\" target=\"_blank\">实操课程</a></li>\r\n                                    <li><a class=\"link\" href=\"http://xueyuan.maijia.com/offline/?from=top\" target=\"_blank\">线下培训</a></li>\r\n                                    <li><a class=\"link\" href=\"http://xueyuan.maijia.com/activity/shop/freediagnosis?source=2\" target=\"_blank\">免费诊断</a></li>\r\n                                    <li><a class=\"link\" href=\"http://xueyuan.maijia.com/applyLecturer/enter?from=top\" target=\"_blank\">讲师入驻</a></li>\r\n                                    <li><a class=\"link\" href=\"http://xueyuan.maijia.com/activity/xxsd?from=top\" target=\"_blank\">学院视点</a></li>\r\n                                </ul>\r\n                            </div>\r\n                            <div class=\"navigator-item navigator-item-news\">\r\n                                <h3><a href=\"http://www.maijia.com/news/?from=top\" target=\"_blank\">卖家资讯</a></h3>\r\n                                <ul>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/news/cate-dianshangganhuo?from=top\" target=\"_blank\">电商干货</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/news/cate-yejiexinwen?from=top\" target=\"_blank\">电商要闻</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/news/cate-dakashidian?from=top\" target=\"_blank\">淘宝规则</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/news/cate-hangyeshuju\" target=\"_blank\">数据分析</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/news/cate-ycjd?from=top\" target=\"_blank\">原创专栏</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/news/ecnav/?from=top\" target=\"_blank\">实用工具</a></li>\r\n                                </ul>\r\n                            </div>\r\n                            <div class=\"navigator-item navigator-item-software\">\r\n                                <h3><a href=\"http://www.maijia.com/software/?from=top\" target=\"_blank\">卖家服务</a></h3>\r\n                                <ul>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/software/search?tagNameBak=%E5%85%8D%E8%B4%B9%E8%AF%95%E7%94%A8&from=top\" target=\"_blank\">免费软件</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/software/search/1/20/1?from=top\" target=\"_blank\">代运营服务</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/software/searchTutorial?from=top\" target=\"_blank\">软件资料</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/software/softlocation?from=top\" target=\"_blank\">服务商入驻</a></li>\r\n                                    <!--<img src=\"./new.png\">-->\r\n                                </ul>\r\n                            </div>\r\n                            <div class=\"navigator-item navigator-item-bbs\">\r\n                                <h3><a href=\"http://www.maijia.com/bbs/\" target=\"_blank\">卖家社区</a></h3>\r\n                                <ul>\r\n                                    <li><a class=\"link\" href=\"http://bbs.maijia.com/forum-50-1.html?from=top\" target=\"_blank\">卖家问答</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/bbs/forum-68-1.html?from=top\" target=\"_blank\">淘宝/天猫专区</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/bbs/forum-56-1.html?from=top\" target=\"_blank\">Wish专区</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/bbs/forum-69-1.html?from=top\" target=\"_blank\">Amazon专区</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/bbs/forum-67-1.html?from=top\" target=\"_blank\">开店资源</a></li>\r\n                                    <li><a class=\"link\" href=\"http://www.maijia.com/bbs/forum-66-1.html?from=top\" target=\"_blank\">聊天分享</a></li>\r\n                                </ul>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n");
              var css = "html,body{min-width:1200px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_l01imn9jw9vsra4i.eot);src:url(//at.alicdn.com/t/font_l01imn9jw9vsra4i.eot?#iefix) format('embedded-opentype'),url(//at.alicdn.com/t/font_l01imn9jw9vsra4i.woff) format('woff'),url(//at.alicdn.com/t/font_l01imn9jw9vsra4i.ttf) format('truetype'),url(//at.alicdn.com/t/font_l01imn9jw9vsra4i.svg#iconfont) format('svg')}.iconfont{font-family:iconfont!important;font-size:16px;color:#ccc;line-height:16px;display:inline-block}.icon-list{color:#FD8944;position:relative;top:2px}.icon-down{position:relative;top:2px}.icon-down:before{display:none}.c-maijia-top{line-height:34px;font-size:12px;font-family:Helvetica,\"PingFang SC\",Simsun,Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\";background:#f5f5f5;color:#6c6c6c;border-bottom:1px solid #eee}.c-maijia-top:after,.c-maijia-top .clear-fix:after{visibility:hidden;display:block;height:0;content:\"\";font-size:0;clear:both}.c-maijia-top a{text-decoration:none;color:#6c6c6c}.c-maijia-top a:hover{text-decoration:none;color:#6c6c6c}.c-maijia-top a,.c-maijia-top em{font-family:Helvetica,\"PingFang SC\",Simsun,Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\"}.c-maijia-top .i-new,.c-maijia-top .i-hot{display:inline-block;width:12px;height:14px;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OTk4RUVDMThCNjgwMTFFNUFFN0I5OUIyMjc4OUQzMzEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTk4RUVDMTlCNjgwMTFFNUFFN0I5OUIyMjc4OUQzMzEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowNTQyNDg3RkI2N0YxMUU1QUU3Qjk5QjIyNzg5RDMzMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowNTQyNDg4MEI2N0YxMUU1QUU3Qjk5QjIyNzg5RDMzMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnufgDoAAAB7SURBVHjaYsw9q+HJwMAwF4glGfCD50CczESkYgaomrlMyIonGV3HUIUmJslEQAEGwNCQd04TryYmbIL4NDExkAhwasBlC14bQJrQASMw4p4RGQ8g8AJkQwqIQYTip7CY3oZmQyPIZixYBqQW3Q8gxQ3EhhJBxSAAEGAAjBYeoMZjRj0AAAAASUVORK5CYII=') 0 0 no-repeat;vertical-align:middle;margin-left:3px}.c-maijia-top .i-hot{background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAOCAYAAAAbvf3sAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OTk4RUVDMUNCNjgwMTFFNUFFN0I5OUIyMjc4OUQzMzEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OTk4RUVDMURCNjgwMTFFNUFFN0I5OUIyMjc4OUQzMzEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5OThFRUMxQUI2ODAxMUU1QUU3Qjk5QjIyNzg5RDMzMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5OThFRUMxQkI2ODAxMUU1QUU3Qjk5QjIyNzg5RDMzMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PldxZIoAAABqSURBVHjaYvzv4eHJwMAwF4glGfCD50CczAjU8IwIxXBNTCiKt2/HVIIqJsnEQCIgWQMLAScQocHTE68BtPcDqfHwAmRDCohBhOKnoJgGadiGZkMjyGYsWAakFt0PIMUNxHqaoGIQAAgwANZZGBpKOIzCAAAAAElFTkSuQmCC')}.c-maijia-top .fade-in-0{opacity:0}.c-maijia-top .fade-in-1{opacity:1;transition:opacity .25s ease-in-out;-moz-transition:opacity .25s ease-in-out;-webkit-transition:opacity .25s ease-in-out}.c-maijia-top .user-ifo2{margin-left:19px}.c-maijia-top .menu{position:relative;z-index:1000;padding:0}.c-maijia-top .menu:hover .triangle{background:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAYAAACzzX7wAAAAAXNSR0IArs4c6QAAAD9JREFUCB1NjAEKACAIA2f0Ix+YPdA3mYsMhQnuNoE27m6p1SxIHYQRcaGImKpussFVkCC1M/g/zQ6rlR5eCAf5divtSo5ugQAAAABJRU5ErkJggg==\") 0 0 no-repeat}.c-maijia-top .menu .menu-hd{box-sizing:border-box;height:34px;position:relative;z-index:1002;border-width:0 1px;border-style:solid;border-color:transparent;padding:0 14px}.c-maijia-top .menu .menu-hd.menu-down{padding:0 6px}.c-maijia-top .menu .menu-hd:hover .icon-down{transform:rotate(180deg);transition:transform 300ms}.c-maijia-top .menu .menu-bd{display:none;position:absolute;z-index:1001;left:0;top:33px;border:1px solid #f5f5f5;border-top:0;margin-top:1px;padding:3px 0;background:#fff;min-width:100%;box-sizing:border-box}.c-maijia-top .menu .menu-bd.app-code{background:transparent;padding:0;border:0}.c-maijia-top .menu .menu-bd.app-code .aw{position:absolute;top:-5px;left:55px;height:0;width:0;border-color:transparent transparent #fff;border-style:solid;border-width:5px}.c-maijia-top .menu .menu-bd.app-code .hbk{height:125px;width:120px;left:-20px;position:relative}.c-maijia-top .menu .menu-bd.app-code .code-ct{position:absolute;border-radius:4px}.c-maijia-top .menu .menu-bd.app-code .code-ct img{width:100%;height:100%}.c-maijia-top .menu.menu-hover .menu-hd{border-color:#eee;background:#fff}.c-maijia-top .menu.menu-hover .menu-hd:after{content:'';width:100%;height:1px;position:absolute;left:0;bottom:-1px;background:#fff}.c-maijia-top .menu.menu-hover .menu-hd.menu-hd-no{border-color:transparent;background:transparent}.c-maijia-top .menu.menu-hover .menu-hd.menu-hd-no:after{height:0}.c-maijia-top .menu.menu-hover .menu-bd{display:block;-webkit-transform:translateZ(0);transform:translateZ(0)}.c-maijia-top .inner{max-width:1180px;margin:0 auto}.c-maijia-top .left{float:left;display:inline}.c-maijia-top .left .hello{float:left;display:inline}.c-maijia-top .left .hello em{font-style:normal;color:#FD8944;font-weight:400}.c-maijia-top .left .user{float:left;margin-left:11px}.c-maijia-top .left .user em{font-style:normal;color:#FD8944;font-weight:400}.c-maijia-top .left .user ul{padding:0;margin:0}.c-maijia-top .left .user li{float:left;padding:0 5px;list-style-type:none}.c-maijia-top .left .user li.menu{padding:0}.c-maijia-top .right{float:right;display:inline}.c-maijia-top .right ul{padding:0;margin:0}.c-maijia-top .right li{float:left;padding:0 10px;list-style-type:none}.c-maijia-top .right li.menu{padding:0}.c-maijia-top .links a{display:inline-block;padding:0 6px;line-height:28px;height:28px;margin:1px 6px;white-space:nowrap;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}.c-maijia-top .links a em{color:#FD8944;margin-left:5px;font-style:normal}.c-maijia-top .links a:hover{background-color:#FD8944;color:#fff;text-decoration:none}.c-maijia-top .links a:hover em{color:#fff}.c-maijia-top .links a.subuser_nav{margin-left:15px}.c-maijia-top .links a.user_nav{font-size:12px}.c-maijia-top .links a.user_nav.current{background:#fff url(//cdn.maijia.com/maijia-common/components/maijia-top/src/open.png) no-repeat left center}.c-maijia-top .links a.user_nav.current:hover{background-color:#FD8944;color:#fff;text-decoration:none}.c-maijia-top .links a.user_nav.noborder{border:0}.c-maijia-top .message-icon{position:relative;display:inline-block;line-height:14px;padding:0 6px;background:#FD8944;color:#fff;margin-right:6px;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px}.c-maijia-top .message-icon b{width:0;height:0;position:absolute;right:-3px;bottom:0;border-width:6px;border-color:transparent transparent #FD8944;border-style:dashed dashed solid;font-size:0}.c-maijia-top .message-icon.dark{background:0 0;color:inherit}.c-maijia-top .message-icon.dark b{border-color:transparent}.c-maijia-top .navigator .menu-bd{left:auto;right:0;text-align:left;padding:0}.c-maijia-top .navigator .menu-bd .navigator-list{padding:20px 0;width:610px}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item{float:left;width:106px;padding-left:14px}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item:first-child{border-left:0}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item h3{margin:0 0 11px 2px;line-height:16px}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item h3 a{display:inline-block;font-family:Helvetica,\"PingFang SC\",\"Microsoft YaHei\",Arial,\"WenQuanYi Micro Hei\",\"tohoma,sans-serif\";font-size:14px;line-height:16px;padding:0}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item li{float:none;line-height:28px;padding:1px 0}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item li a{display:inline-block;padding:0 6px;font-size:12px;color:#6C6C6C;line-height:30px;border-radius:3px}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item li a:hover{text-decoration:none;background:#FD8944;color:#fff}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item li a img{vertical-align:middle;margin-left:3px;border:0}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item h3 a{font-size:16px;color:#4C4C4C}.c-maijia-top .navigator .menu-bd .navigator-list .navigator-item h3 a:hover{text-decoration:none}";
          }
  		require.loadCss({content: css});
  		this.$el.html($(HTML({domain:this.domain})).html());
  		var  _this = this;
  		setTimeout(function(){
  			_this.$el.find('.J_Right').addClass('fade-in-1')
  		}, 100)
  	},
  	_eventBind: function(){
  		// chrome :hover top 35px内有问题. 改用js
  		this.$el.on('mouseenter', '.menu', function(e){
  			var target = e.currentTarget;
  			var handler = $(target).data('handler');
  			if(handler){
  				clearTimeout(handler);
  			}
  			$(e.currentTarget).addClass('menu-hover');
  		});
  		this.$el.on('mouseleave', '.menu', function(e){
  			var target = e.currentTarget;
  			$(target).data('handler', setTimeout(function(){
  				$(target).removeClass('menu-hover');
  			}, 10));
  		});
  
  		//session event
  		var _this = this;
  		session.on('add', function(){
  			_this._loadAndRenderNickAndMessage();
  		});
  		session.on('update', function(){
  			_this._loadAndRenderNickAndMessage();
  		});
  	},
  	_loadAndRenderNickAndMessage: function(){
  		var _this = this;
  		session.get(function(data){
  			var nick = data ? (data.nick||data.mobile) : null;
  			_this.updateNick(nick);
  			_this._loadAdnRenderMessage(nick);
  			_this = null;
  		});
  
  	},
  	updateNick: function(nick){
  		var href = window.location.href;
  		var redirectURL = encodeURIComponent(href);
  		var NICK_TEMP = '<a href="http://i.maijia.com/index.html#/user/info/" style="margin:0 5px">{nick}</a><a href="http://login.'+this.domain+'.com/user/logout?redirectURL={redirectURL}" style="margin:0 5px 0 14px">退出</a>';
  		var UNLOGIN_TEMP = '<a href="http://login.'+this.domain+'.com/?redirectURL={redirectURL}" style="margin:0 5px"><em>登录</em></a><a href="http://login.'+this.domain+'.com/register.htm?redirectURL={redirectURL}&from={form}" style="margin:0 5px 0 14px">免费注册</a>'
  		var html;
  		if(nick){
  			html = NICK_TEMP.replace('{nick}',nick).replace('{redirectURL}',redirectURL);
  		}else{
  			html = UNLOGIN_TEMP.replace(/{redirectURL}/g,redirectURL).replace('{form}',window.location.host.split('.')[0]);
  		}
  		this.$el.find('.J_User').html(html).addClass('fade-in-1');
  	},
  	_loadAdnRenderMessage: function(nick){
  		if(!nick){
  			data = {
  					totalInnerSite: 0, totalSystem: 0
  			};
  			//暂时用cookie, 和其它站点一致
  			if(!document.cookie.match(/\b__nick=1\b/)){
  				data.totalInnerSite = 1;
  			}
  			/*
  			if(window.localStorage && window.localStorage.getItem){
  				var date = window.localStorage.getItem('messageTime') || '';
  				if(!date || date.match(/^\d+$/) && (new Date().getTime() - date > 86400000)){
  					data.totalInnerSite = 1;
  				}
  			}
  			*/
  			this.updateMessage(data);
  			return;
  		}
  		var _this = this;
  		$.ajax({
  			url: '//i.maijia.com/restapi/message/preview/figure',
  			dataType: 'jsonp'
  		}).then(function(json){
  			if(json.result != 1){
  				_this.updateMessage({totalInnerSite: 0, totalSystem: 0});
  				return;
  			}
  
  			_this.updateMessage(json.data);
  			_this = null;
  		}, function(err){
  			//throw err;
  		});
  	},
  	updateMessage: function(data){
  		var NO_MESSAGE_TEMP = "<div class=\"menu-hd\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?from=top\">\r\n\t消息<span class=\"iconfont icon-down\">&#xe601;</span>\r\n\t</a>\r\n</div>\r\n<div class=\"menu-bd links\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=1from=top&pageNo=1&pageSize=13\">站内消息<em>{totalInnerSite}</em></a>\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=0&from=top&pageNo=1&pageSize=13\">系统消息<em>{totalSystem}</em></a>\r\n</div>\r\n";
  		var MESSAGE_TEMP = "<div class=\"menu-hd\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?from=top\">\r\n\t<span class=\"message-icon\"><b></b>{total}</span>\r\n\t<span>消息</span><span class=\"iconfont icon-down\">&#xe601;</span>\r\n\t</a>\r\n</div>\r\n<div class=\"menu-bd links\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=1&from=top&pageNo=1&pageSize=13\">站内消息<em>{totalInnerSite}</em></a>\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=0&from=top&pageNo=1&pageSize=13\">系统消息<em>{totalSystem}</em></a>\r\n</div>\r\n";
  		var total = data.totalInnerSite+data.totalSystem;
  		if(total>99){
  			total = "99+";
  		}
  		if(total==0){
  			this.$el.find('.J_Message').html(NO_MESSAGE_TEMP.replace('{total}', total).replace('{totalInnerSite}', data.totalInnerSite).replace('{totalSystem}',data.totalSystem)).addClass('fade-in-1');
  		}else{
  			this.$el.find('.J_Message').html(MESSAGE_TEMP.replace('{total}', total).replace('{totalInnerSite}', data.totalInnerSite).replace('{totalSystem}',data.totalSystem)).addClass('fade-in-1');
  		}
  
  	},
  	show: function(){
  		this.$el.show();
  	},
  	hide: function(){
  		this.$el.hide();
  	},
  	refresh: function(){
  		session.refresh();
  		// this.cleanUserInfo();
  	},
  	refreshMessage: function(){
  		this._loadAdnRenderMessage(true);
  	}
  }
  
  try{
  	require('components/maijia-top/src/notice');
  }catch(e){
  
  }
  
  // if(new Date().getTime()>new Date('2017/06/16').getTime()&&new Date().getTime()<new Date('2017/06/21').getTime()){
  // 	exPj.config = {
  // 		events:1
  // 	}
  // 	var _618 = document.cookie.indexOf('mj_618=1')!=-1;
  // 	function append618(){
  // 		var html = __inline('./618.tpl');
  // 		$('body').append(html);
  // 		$('.J_mj_618').on('click',function(){
  // 			$('.J_mj_618_con').remove();
  // 			// localStorage.setItem('maijia::618',new Date().getTime());
  // 			document.cookie = 'mj_618=1;domain=maijia.com;expire='+new Date(new Date().getTime()+18*60*60*1000).toGMTString();
  // 		});
  // 	}
  
  // 	if(!_618){
  // 		append618();
  // 	}else{
  // 		// if(new Date(+_618).getDate()!=new Date().getDate()){
  // 		// 	append618();
  // 		// }
  // 	}
  // }
  
  
  if(new Date().getTime()>new Date('2017/06/15').getTime()&&new Date().getTime()<new Date('2017/06/21').getTime()){
  	document.domain = "maijia.com";
  	if('localStorage' in window){
  
  		var _618 = localStorage.getItem('maijia::618');
  		function append618(){
  			var html = "<div class=\"J_mj_618_con\" style=\"position:fixed;top:0;left:0;height:100%;width:100%;z-index:999999;\">\r\n    <div class=\"back\" style=\"position:absolute;top:0;left:0;height:100%;width:100%;background:#000;opacity: 0.5;filter:alpha(50);\"></div>\r\n    <a href=\"http://www.maijia.com/bbs/thread-75447-1-1.html\" target=\"_blank\" class=\"J_mj_618\">\r\n        <img src=\"//cdn.maijia.com/maijia-common/components/maijia-top/src/618.png\" alt=\"\" style=\"cursor:pointer;width:413px;height:368px;position:absolute;top:45%;left:50%;margin-top:-184px;margin-left:-207px;\">\r\n    </a>\r\n    <img class=\"J_mj_618\" src=\"//cdn.maijia.com/maijia-common/components/maijia-top/src/close.png\" alt=\"\" style=\"cursor:pointer;position:absolute;top:45%;left:50%;margin-top:-170px;margin-left:251px;\">\r\n</div>";
  			$('body').append(html);
  			$('.J_mj_618').on('click',function(){
  				$('.J_mj_618_con').remove();
  				localStorage.setItem('maijia::618',new Date().getTime());
  			});
  			exPj.config = {
  				events:1
  			}
  		}
  
  		if(!_618){
  			append618();
  		}else{
  			if(new Date(+_618).getDate()!=new Date().getDate()){
  				append618();
  			}
  		}
  	}
  }
  
  module.exports = exPj;
  

});

;/*!components/maijia-top/src/top.js*/
define('components/maijia-top/src/top', function(require, exports, module) {

  var $ = require('components/jquery/jquery');
  var session = require('components/maijia-session/index');
  var UNLOGIN_TEMP = "<ul class=\"clear-fix\">\r\n\t<li>\r\n\t\t<a href=\"http://login.maijia.com/?redirectURL={redirectURL}\"><em>登录</em></a>\r\n\t</li>\r\n\t<li>\r\n\t\t<a class=\"user-ifo2\" href=\"http://login.maijia.com/register.htm?redirectURL={redirectURL}&from={form}\">免费注册</a>\r\n\t</li>\r\n</ul>";
  var USER_TEMP = "<ul class=\"clear-fix\">\r\n\t<li class=\"J_accout-info-menu\">\r\n\t\t<div class=\"menu-hd\">\r\n\t\t\t<a href=\"http://i.maijia.com/index.html#/user/info/\">\r\n\t\t\t\t<span>{nick}</span>\r\n\t\t\t</a>\r\n\t\t</div>\r\n\t</li>\r\n\t<li>\r\n\t\t<a class=\"user-ifo2 menu-hd J_Logout\" href=\"http://login.maijia.com/user/logout?redirectURL={redirectURL}\">退出</a>\r\n\t</li>\r\n</ul>";
  var MESSAGE_TEMP = "<div class=\"menu-hd\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?from=top\">\r\n\t<span class=\"message-icon\"><b></b>{total}</span>\r\n\t<span>消息</span><span class=\"iconfont icon-down\">&#xe601;</span>\r\n\t</a>\r\n</div>\r\n<div class=\"menu-bd links\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=1&from=top&pageNo=1&pageSize=13\">站内消息<em>{totalInnerSite}</em></a>\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=0&from=top&pageNo=1&pageSize=13\">系统消息<em>{totalSystem}</em></a>\r\n</div>\r\n";
  var NO_MESSAGE_TEMP = "<div class=\"menu-hd\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?from=top\">\r\n\t消息<span class=\"iconfont icon-down\">&#xe601;</span>\r\n\t</a>\r\n</div>\r\n<div class=\"menu-bd links\">\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=1from=top&pageNo=1&pageSize=13\">站内消息<em>{totalInnerSite}</em></a>\r\n\t<a class=\"link\" href=\"http://i.maijia.com/index.html#/user/message/?msgType=0&from=top&pageNo=1&pageSize=13\">系统消息<em>{totalSystem}</em></a>\r\n</div>\r\n";
  var domain;
  if(!!~window.location.href.indexOf('//www.taosj.com/')){
      domain = 'taosj';
  }else{
      domain = 'maijia';
  }
  
  require('components/maijia-top/src/nick-dialog')();
  
  if(location.pathname.indexOf('/wish')==0||location.pathname.indexOf('/ebay')==0||location.pathname.indexOf('/amazon')==0){
  
  }else{
  	$('body').css('-webkit-font-smoothing','antialiased');
  	$('body').css('-moz-osx-font-smoothing','grayscale');
  }
  
  var formateDate = function(timestamp){
  	var date = new Date(timestamp), 
  		year = date.getFullYear(), 
  		month = (date.getMonth() + 1), 
  		day = date.getDate(),
  		fill = function(val) {
  			return (val < 10 ? '0' : '') + val;
  		};
  		month = fill(month);	
  		day = fill(day);
  	return [year,month,day].join('-');
  };
  
  var checkUserDropList = function(cb){
  	$.ajax({
  		url:'//www.'+domain+'.com/user/level/info',
  		dataType:'jsonp',
  		success:function(json){
  			if(json.result==1){
  				if(json.data.level=='senior'||json.data.level=='luxury'||json.data.level=='primary'){
  					$('#J_c-maijia-top .J_user_drop')[0].style.display = '';
  				}
  			}
  		},
  		error:function(){
  
  		}
  	})
  }
  
  module.exports = {
  	/* for .vm*/
  	init: function(temp){ 
  		this.$el = $('#J_c-maijia-top');
  		this._eventBind();
  		this._loadAndRenderNickAndMessage();
  		checkUserDropList();
  	},
  	/* for js */
  	renderTo: function(selector){
  		if(selector){
  			$(this.temp).appendTo(selector);
  		}else{
  			$('#J_c-maijia-top').html($(this.temp).html());
  		}
  		this.init();
  	},
  	setTemplate: function(temp){
  		this.temp = temp;
  	},
  	_eventBind: function(){
  		// chrome :hover top 35px内有问题. 改用js
  		this.$el.on('mouseenter', '.menu', function(e){
  			var target = e.currentTarget;
  			var handler = $(target).data('handler');
  			if(handler){
  				clearTimeout(handler);
  			}
  			$(e.currentTarget).addClass('menu-hover');
  		});
  		this.$el.on('mouseleave', '.menu', function(e){
  			var target = e.currentTarget;
  			$(target).data('handler', setTimeout(function(){
  				$(target).removeClass('menu-hover');
  			}, 10));
  		});
  		//user info
  		var _this = this;
  		// this.$el.on('mouseenter', '.J_accout-info-menu', function(e){
  		// 	var target = e.currentTarget;
  		// 	if($(target).find('.J_account-info').attr('data-loaded') != 1){
  		// 		_this._loadAndRenderUserInfo();
  		// 		//1分钟后，如果移上去， 重新加载
  		// 		setTimeout(function(){
  		// 			$(target).find('.J_account-info').attr('data-loaded','0');
  		// 		}, 60000);
  				
  		// 	}
  		// });
  
  		//session event
  		session.on('add', function(){
  			_this._loadAndRenderNickAndMessage();
  		});
  		session.on('update', function(){
  			_this._loadAndRenderNickAndMessage();
  		});
  		
  	},
  	_loadAndRenderNickAndMessage: function(){ 
  		var _this = this;
  		session.get(function(data){
  			var nick = data ? (data.nick||data.mobile) : null;
  			_this.updateNick(nick);
  			_this._loadAdnRenderMessage(nick);
  			_this = null;
  		});
  		
  	},
  	updateNick: function(nick){ 
  		var href = window.location.href;
  		var redirectURL = encodeURIComponent(href);
  		var html;
  		if(nick){
  			html = USER_TEMP.replace('{nick}',nick).replace('{redirectURL}',redirectURL);
  		}else{
  			html = UNLOGIN_TEMP.replace(/{redirectURL}/g,redirectURL).replace('{form}',window.location.host.split('.')[0]);
  		}
  		this.$el.find('.J_User').html(html).fadeIn();
  	},
  	_loadAndRenderUserInfo: function(){
  		var _this = this;
  		$.ajax({
  			url: '//i.'+domain+'.com/restapi/user/info',
  			dataType: 'jsonp'
  		}).then(function(json){
  			var nick = null;
  			if(json.result != 1){
  				window.location.href = '//login.'+domain+'.com/?redirectURL=' + encodeURIComponent(window.location.href);
  				return;
  			}
  			// _this._updateUserInfo(json.data);
  			_this = null;
  		}, function(err){
  			//throw err;
  		});
  	},
  	_updateUserInfo: function(data){
  		var startTime = '', endTime = '';
  		var html = '<table>';
  		var TEMP = '<tr>'+
  						'<td>'+
  							'<p>定购监控版本：<em>{versionName}</em></p>'+
  							'<p>到期时间：<em>{startTime} - {endTime}</em></p>'+
  						'</td>'+
  						'<td>'+
  							'<a href="http://www.maijia.com/index.html#/user/recharge/" class="ui-button ui-button-small">{buttonName}</a>'+
  						'</td>'+
  					'</tr>';
  		if(data.isSeniorLevel == 1){
  			startTime = formateDate(data.seniorLevelStartTime);
  			endTime   = formateDate(data.seniorLevelEndTime);
  			html += TEMP.replace('{versionName}','高级版').replace('{startTime}',startTime).replace('{endTime}',endTime).replace('{buttonName}','续费升级');
  		}
  		if(data.isPrimaryLevel == 1){
  			startTime = formateDate(data.primaryLevelStartTime);
  			endTime   = formateDate(data.primaryLevelEndTime);
  			html += TEMP.replace('{versionName}','标准版').replace('{startTime}',startTime).replace('{endTime}',endTime).replace('{buttonName}','续费升级');
  		}
  		if(data.level === 'normal'){
  			html += TEMP.replace('{versionName}','未定购').replace('{startTime}',startTime).replace('{endTime}',endTime).replace('{buttonName}','立即购买');
  		}
  
  		var accountHtml = '<tr>'+
  							'<td>'+
  								'<p>短信报警剩余：<strong>'+ data.account.remainMessage +'</strong> 条</p>'+
  								'<p>邮件报警剩余：<strong>'+ data.account.remainEmail +'</strong> 封</p>'+
  							'</td>'+
  							'<td>'+
  								'<a href="http://www.maijia.com/index.html#/user/warnconfig/" class="ui-button ui-button-small">立即购买</a>'+
  							'</td>'+
  						'</tr>';
  		html += accountHtml;
  		html += '</table>';
  		// this.$el.find('.J_account-info').html(html).attr('data-loaded','1');
  	},
  	cleanUserInfo: function(){
  		this.$el.find('.J_account-info').attr('data-loaded',0);
  	},
  	_loadAdnRenderMessage: function(nick){
  		if(!nick){
  			data = {
  					totalInnerSite: 0, totalSystem: 0
  			};
  			//暂时用cookie, 和其它站点一致
  			if(!document.cookie.match(/\b__nick=1\b/)){
  				data.totalInnerSite = 1;
  			}
  			
  			this.updateMessage(data);
  			return;
  		}
  		var _this = this;
  		$.ajax({
  			url: '//i.'+domain+'.com/restapi/message/preview/figure',
  			dataType: 'jsonp'
  		}).then(function(json){
  			if(json.result != 1){
  				_this.updateMessage({totalInnerSite: 0, totalSystem: 0});
  				return;
  			}
  			
  			_this.updateMessage(json.data);
  			_this = null;
  		}, function(err){
  			//throw err;
  		});
  	},
  	updateMessage: function(data){
  		var total = data.totalInnerSite+data.totalSystem;
  		if(total>99){
  			total = "99+";
  		}
  		if(total==0){
  			this.$el.find('.J_Message').html(NO_MESSAGE_TEMP.replace('{total}', total).replace('{totalInnerSite}', data.totalInnerSite).replace('{totalSystem}',data.totalSystem)).fadeIn();
  		}else{
  			this.$el.find('.J_Message').html(MESSAGE_TEMP.replace('{total}', total).replace('{totalInnerSite}', data.totalInnerSite).replace('{totalSystem}',data.totalSystem)).fadeIn();
  		}
  		
  	},
  	show: function(){
  		this.$el.show();
  	},
  	hide: function(){
  		this.$el.hide();
  	},
  	refresh: function(){
  		session.refresh();
  		// this.cleanUserInfo();
  	},
  	refreshMessage: function(){
  		this._loadAdnRenderMessage(true);
  	}
  };

});

;/*!components/tatami/tatami.js*/
define('components/tatami/tatami', function(require, exports, module) {

  /**
   * @depend Tatami.events, Tatami.util
   * @class pages
   * @author Jerrod
   */
  (function(rc) {
  
  	if (!rc) {
  		rc = window.Tatami = {};
  	}
  
  	rc.pages = {
  
  		// 路由里配置得虚拟目录结构
  		_mainPath: ['root', 'app', 'classification'],
  
  		// 当前的 url
  		_curUrl: '',
  		// 当前的 hashs 对象
  		_curHashs: {},
  		// 上一次的 url
  		_prevUrl: '',
  		// 上一次的 hashs 对象
  		_prevHashs: {},
  
  
          /**
           * 设置当前的url
           * @private
           */
  		_setCurUrl: function(url) {
  			if (url) {
  				this._curUrl && this._setPrevUrl(this._curUrl);
  				this._curUrl = url;
  			}
  		},
  
          /**
           * 获得当前的url
           * @private
           */
  		_getCurUrl: function() {
  			return this._curUrl;
  		},
  
  
          /**
           * 设置当前的hashs
           * @private
           */
  		_setCurHashs: function(hashs) {
  			if (hashs) {
  				this._curHashs && this._setPrevHashs(this._curHashs);
  				this._curHashs = hashs;
  			}
  		},
  
          /**
           *
           * 获得当前的url
           * @private
           */
  		_getCurHashs: function() {
  			return this._curHashs;
  		},
  
  
          /**
           *
           * 设置上一个的url
           * @private
           */
  		_setPrevUrl: function(url) {
  			if (url) {
  				this._prevUrl = url;
  			}
  		},
  
          /**
           *
           * 获得上一个的url
           * @private
           */
  		_getPrevUrl: function() {
  			return this._prevUrl;
  		},
  
  
          /**
           * 设置上一个的hashs
           * @private
           */
  		_setPrevHashs: function(hashs) {
  			if (hashs) {
  				this._prevHashs = hashs;
  			}
  		},
  
          /**
           *
           * 获得上一个的url
           * @private
           */
  		_getPrevHashs: function() {
  			return this._prevHashs;
  		},
  
          /**
           *
           * @private
           * 历史数据
           */
  		_histories: [],
  
  		/**
  		 *  根据分割符号从url 里切除相应的内容，没有则为空
           * @private
  		 * @param{String}symbol		需要分割的符号
  		 * @param{String}url		传入的url 地址
  		 */
  		_getFilterUrlBySymbol: function(symbol, url) {
  			var ind = url.indexOf(symbol || '#');
  			return ind === -1 ? '' : url.slice(ind, url.length);
  		},
  
  
          /**
           * 获得当前的location的 fullpath
           * @private
           */
  		_getLocationFullPath: function() {
  			return location.protocol + '//' + location.hostname + ((location.port === 80 || location.port === '') ? '' : ':' + location.port) + location.pathname;
  		},
  
  		/**
  		 * 可以将字符串按照 & 的格式分割
  		 * @param{String}str		需要转化的字符串
  		 * @param{Object}obj		[可选] 需要挂载上的对象
  		 * @param{Boolean} isKeepOrigin [可选] 是否保持原有的状态
       * @private
  		 */
  		_queryParser: function(str, obj, isKeepOrigin) {
  			if (!str) {return obj || {};}
  			var re = obj || {}, i = 0, arrQuery = str.split('&'), ni = arrQuery.length, it, key, val;
  			for (; i < ni; i++) {
  				it = arrQuery[i].split('=');
  				if (it.length === 0) {
  					continue;
  				}
  				key = it[0];
  				val = it[1] ? isKeepOrigin ? it[1] : decodeURIComponent(it[1]) : '';
  				if (!re[key]) {
  					re[key] = val;
  					continue;
  				}
  				re[key] += ',' + val;
  			}
  			return re;
  		},
  
  		/**
  		 *  通过传入url 获得一个经过解析的querySting 对象
  		 * @param {String} url url 地址
  		 */
  		getQueries: function(url) {
  			var strQuery = this._getFilterUrlBySymbol('?', url);
  			if (!strQuery) {
  				return {};
  			}
  			// 这个部分获得的应该是？ 后 ＃ 前的内容
  			strQuery = strQuery.slice(1, strQuery.indexOf('#') !== -1 ? strQuery.indexOf('#') : strQuery.length);
  			return this._queryParser(strQuery);
  		},
  
  		/**
  		 *
  		 * 将一段string 解析成对象
  		 * @param {String} str		需要解析的字符串
  		 */
  		getQueriesObject: function(str) {
  			return typeof str === 'string' ? this._queryParser(str) : {};
  		},
  
  
  		// 存放转化后的路由数据
  		_routeMapping: {},
  		
  		// 存在原始的路由数据
  		_routeOrigin: {},
  
  		/**
  		 *
   		 *  返回该节点名称下的路由里的映射数据
           * @private
   		 * @param {String} routeName 该节点的名称
  		 */
  		_getRouteNode: function(routeName) {
  			return this._routeMapping[routeName || '_default'];
  		},
  
  		/**
  		 *
  		 *  返回一个hash 的host path，如 /root/
           * @private
  		 * @param {Object} hashs		 一个hashs对象
  		 * @param {Boolean} isConvert	 是否需要覆盖
  		 * @param {Boolean} isFillHD	 是否补全前，后的‘／’
  		 */
  		_getHashHostPath: function(hashs, isConvert, isFillHD) {
  			var mainPath = this._mainPath, i = 0, ni = mainPath.length, hash = [], it;
  			for (; i < ni; i++) {
  				it = mainPath[i];
  				if (hashs[it]) {
  					hash.push(hashs[it]);
  				}
  			}
  			hash = hash.join('.');
  			var node = this._getRouteNode(hash);
  			if (!isConvert) {
  				return node ? node.name : hash;
  			}
  			var converts = (node.name || hash).replace(/\./g, '/');
  			if (isFillHD) {
  				return '/' + converts + '/';
  			}
  			return converts;
  		},
  
  
  		/**
  		 *  返回一个hashs对象
  		 *
           * @private
  		 * @param {String} url 		url 字段
  		 */
  		_getHashs: function(url) {
  			var aHash = url.replace(/^#/, ''), obj = {},
  				aFolder, sSearch, folders, i, ni, j, mainPath = this._mainPath, itName;
  			// 我们的虚拟目录结构为 /root/app/classification/?a=x&b=y&c=z 最多三层虚拟目录，后续为不同多尾字段
  			if (/^\/(\w+)(\/(\w+)){0,2}(\/\?(\w+=[^&]*|\w+)|\/$)/.test(aHash)) {
  				aFolder = aHash.slice(0, aHash.indexOf('?'));
  				sSearch = /\?/.test(aHash) ? aHash.slice(aHash.indexOf('?') + 1, aHash.length) : '';
  				folders = aFolder.split('/');
  				for (i = 0, ni = folders.length, j = 0; i < ni; i++) {
  					if (!folders[i] || folders[i] === '') {
  						continue;
  					}
  					itName = mainPath[j++];
  					obj[itName] = folders[i];
  				}
  				if (sSearch) {
  					obj = this._queryParser(sSearch, obj);
  				}
  			} else {
  				obj.root = '';
  			}
  			return obj;
  		},
  
  		/**
  		 *
  		 *  根据module判断是否页面发生了改变
           * @private
  		 * @param {Object} curHashs			当前的hashs对象
  		 * @param {Object} prevHashs		上个的hashs对象
  		 */
  		_isPagechange: function(curHashs, prevHashs) {
  			if (!curHashs || !prevHashs) {
  				return false;
  			}
  			// 其实只需要判断 3 层, root, app, classification
  			return curHashs.root !== prevHashs.root || curHashs.app !== prevHashs.app || curHashs.classification !== prevHashs.classification;
  		},
  
  		/**
  		 *
  		 *  监听window hashchange 事件，然后更新下面的url变化
           * @private
  		 * @param {String} url			hashchange 时获得的url
  		 */
  		_hashchange: function(url) {
  			var prevUrl = this._getCurUrl();
  			if (prevUrl === url) {
  				return;
  			}
  			var hash = this._getFilterUrlBySymbol('#', url);
  			this._doPagechangeAct(hash, false, url);
  		},
  
  		/**
  		 *
  		 * 通过匹配去获得一个变化了的mdul name
  		 * @param {Object} prevHashs			之前的hashs
  		 * @param {Object} curHashs				当前的hashs
  		 */
  		_getDisabledMdul: function(prevHashs, curHashs) {
  			var i = 0, marr = this._mainPath, ni = marr.length, it, arr = [];
  			for (; i < ni; i++) {
  				it = marr[i];
  				if (prevHashs[it] !== undefined) {
  					arr.push(prevHashs[it]);
  				}
  				if (prevHashs[it] !== curHashs[it]) {
  					if (prevHashs[it] === undefined) {
  						// 如果prev 当前已经就没有了，说明当前的不需要隐藏掉
  						return false;
  					}
  					return arr.join('.');
  				}
  			}
  			return false;
  		},
  
  		/**
  		 *
  		 * 根据node 里会有得默认节点参数，获得一个新得hashs对象（因为有些hashs如{root: 'index'} 实际应该还有一层 {root: 'index', app: 'list'}
  		 * @param {Object} hashs		原始hashs
  		 * @param {Object} node			当前的node 对象
  		 */
  		_getHashsIfHasDefault: function(hashs, node) {
  			var i = 0, nodeArr;
  			// 匹配长度
  			rc.util.map(hashs, function() {i++;}, this);
  			nodeArr = node.name.split('.');
  			// 存在有这样的需求，由于有默认的default_index，所以hashs当前的包裹起始并不明确，我们需要让他明确起来
  			if (i !== nodeArr.length) {
  				rc.util.map(nodeArr, function(it, idx) {
  					hashs[this._mainPath[idx]] = it;
  				}, this);
  			}
  			return hashs;
  		},
  
  		/**
  		 *
  		 *  当页面发生改变时，我们来处理
           * @private
  		 * @param {String} hashs		hash 字符串
  		 * @param {Boolean} isInit   	是否初次执行
  		 * @param {String} url   		访问地址
  		 */
  		_doPagechangeAct: function(hash, isInit, url) {
  			var hashs = this._getHashs(hash);
  			// hash === '' || !hashs.root
  			if (!hash || !hashs.root) {
  				//200 - 'hash 为空或者不存在'
  				rc.pub('ERROR.PAGES', {result: 200});
  				isInit ? this._jumpToDefault() : this.goback();
  				return;
  			}
  
  			this._histories.push({
  				url: url,
  				hashs: hashs,
  				time: new Date()
  			});
  			this._setCurUrl(url);
  			this._setCurHashs(hashs);
  
  			// pages 只需要告诉module 哪些内容发生变化就可以了，其他的由module 自己去处理
  			var routeKey = this._getNodeNameByHashs(hashs), curMdul, node = this._getRouteNode(routeKey);
  
  			// 用 routeKey 和我们初始化后的路由配置对比
  			if (!node) {
  				// 不存在我们也返回默认页去
  				//201 - 'route module 在配置里不存在'
  				rc.pub('ERROR.PAGES', {result: 201});
  				this.goback();
  				return;
  			}
  			curMdul = node.name;
  
  			rc.pub('PAGES.HASHCHANGE', hashs);
  
  			var prevHashs = this._getPrevHashs(),
  				prevRoot = prevHashs.root,
  				prevKey = this._getNodeNameByHashs(prevHashs), nPrevKey;
  
  			this.setTitle(node.value.title);
  
  			hashs = this._getHashsIfHasDefault(hashs, node);
  			if (isInit) {
  				this._setCurHashs(hashs);
  				rc.pub('TATAMI.FEATUREREADY', {key: 'PAGES', act: 'PAGES.HASHCHANGE', value: hashs});
  				rc.pub('TATAMI.FEATUREREADY', {key: 'PAGES', act: 'PAGES.PAGECHANGE', value: hashs});
  				rc.pub('TATAMI.FEATUREREADY', {key: 'PAGES', act: 'MODULES.ROOTLOAD', value:  {
                      prevRoot: prevRoot, // 需要被销毁的mdul
                      curRoot: hashs.root, // 需要被加载的mdul
                      curMdul: curMdul, // 需要被更新的mdul
                      prevMdul: prevKey, // 上一个需要被隐藏的mdul
                      url: url, // 发送过去的url
                      hashs: hashs // 需要
                  }});
                  rc.pub('TATAMI.FEATUREREADY', {key: 'PAGES', act: 'PAGES.ISROOTPAGE', value: this._isRootPath(hashs)});
  
              } else {
  				// root 发生里转变，会需要destroy 之前的模块，load 新模块
  				if (prevRoot !== hashs.root) {
  					rc.pub('PAGES.PAGECHANGE', hashs);
  					rc.pub('MODULES.ROOTLOAD', {
  						prevRoot: prevRoot, // 需要被销毁的mdul
  						curRoot: hashs.root, // 需要被加载的mdul
  						curMdul: curMdul, // 需要被更新的mdul
  						prevMdul: prevKey, // 上一个需要被隐藏的mdul
  						url: url, // 发送过去的url
  						hashs: hashs // 需要
  					});
  				} else {
  					// 如果模块发生变化了，则pub一个变化事件出来
  					if (this._isPagechange(hashs, prevHashs)) {
  						nPrevKey = this._getDisabledMdul(prevHashs, hashs);
  						rc.pub('PAGES.PAGECHANGE', hashs);
  					}
  					rc.pub('MODULES.SWITCHMDUL', {
  						prevMdul: prevKey,
  						nPrevKey: nPrevKey,
  						curMdul: curMdul,
  						hashs: hashs,
  						url: url
  					});
  				}
  			}
  
  			// 广播当前的path 是否是跟节点下的
  			rc.pub('PAGES.ISROOTPAGE', this._isRootPath(hashs));
  		},
  
  		/**
  		 *  根据类似 a.b.c 来解析成 #/a/b/c/
           * @private
  		 * @param {String} nodeName		nodeName 字符串
  		 */
  		_getPathByNodeName: function(nodeName) {
  			return '#/' + nodeName.replace(/\./g, '/') + '/';
  		},
  
  		/**
  		 *  根据类似 {root:a,app:b,classitication:c} 解析成 a.b.c
           * @private
  		 * @param {Object} hashs		hash 的对象
  		 */
  		_getNodeNameByHashs: function(hashs) {
  			if (!hashs || !hashs.root) {
  				return '';
  			}
  			var key = hashs.root;
  			if (hashs.app) {
  				key += '.' + hashs.app;
  				if (hashs.classification) {
  					key += '.' + hashs.classification;
  				}
  			}
  			return key;
  		},
  
          /**
           *
           * 跳到我们的默认页
           * @private
           */
  		_jumpToDefault: function() {
  			var dNode = this._getRouteNode();
  			if (!dNode) {
  				return;
  			}
  			var path = this._getPathByNodeName(dNode.name);
  			this.goPage(path, true);
  		},
  
  		/**
  		 *  根据hashs 来判断是否是root path
           * @private
  		 * @param {Object} hashs		hash 的对象
  		 */
  		_isRootPath: function(hashs) {
  			var rm = this._routeOrigin.cp_list;
  			if (hashs.app) {
  				var appDefault = rm[hashs.root].default_index;
  				if (appDefault !== hashs.app) {
  					return false;
  				}
  				if (!hashs.classification) {
  					return true;
  				}
  				if (hashs.classification && !rm[hashs.root].app_list[hashs.app].classification_list) {
  					return false;
  				}
  				if (hashs.classification !== rm[hashs.root].app_list[hashs.app].default_index) {
  					return false;
  				}
  				return true;
  			} else {
  				return true;
  			}
  		},
  
  		/**
  		 * @param {Object | String} a		如果 a 是一个 hashs 对象，则我们去获得对象过滤后得到的新地址，否则 a 表示地址
  		 * @param {Boolean} b		表示是否不需要encode，默认encode
  		 * @param {Boolean} c		表示否是否清空之前的queryString
  		 */
  		pagesModify: function(a, b, c, d) {
  			// 如果 a 是一个对象，则我们去获得对象过滤后得到的新地址
  			var newUrl;
  			if (typeof a === 'object') {
  				newUrl = this._getNewPathByHashsChange(a, b, c);
  				this.goPage(newUrl);
  				return;
  			}
  
  		},
  
  		/**
  		 *  获得一个只有root，app，classifition 的对象
           * @private
  		 * @param {Object} hashs	传入一个对象
  		 */
  		_getRootHashs: function(hashs) {
  			var mainPath = this._mainPath, i = 0, ni = mainPath.length, it, obj = {};
  			for (;i < ni; i++) {
  				it = mainPath[i];
  				if (hashs[it]) {
  					obj[it] = hashs[it];
  				}
  			}
  			return obj;
  		},
  
  		/**
  		 *  获得一个通过modify 改造后的新地址
           * @private
  		 * @param {Object} modified		需要修改的内容
  		 * @param {Boolean} isNotDecode 是否不做decode处理
  		 * @param {Boolean} isClear		是否需要清空之前的 queryString（指在hash后的部分）
  		 */
  		_getNewPathByHashsChange: function(modified, isNotDecode, isClear) {
  			if (!modified || typeof modified !== 'object') {
  				return;
  			}
  			var curHashs = this._getCurHashs(), // 当前的root，app，classification
  				rootHashs = this._getRootHashs(curHashs),
  				curQuery = isClear ? {} : this.getHashQueryObject(null, true) || {}, // 当前的所有搜索内容 (不含root，app，classification), 如果全清空，则完全为空
  				getValue = !isNotDecode ? function(val) {
  					return encodeURIComponent(val);
  				} : function(val) {
  					return val;
  				},
  				mainPathStr = this._mainPath.join('.');
  			var i, urlArr = [], it, j, rootPath = '#/';
  
  			for (i in modified) {
  				it = modified[i];
  				if (RegExp('\\b' + i + '\\b').test(mainPathStr)) {
  					if (it === undefined || it === '') {
  						delete rootHashs[i];
  					} else {
  						rootHashs[i] = it;
  					}
  					continue;
  				}
  
  				if (curQuery[i]) {
  					if (it === undefined || it === '') {
  						delete curQuery[i];
  					} else {
  						curQuery[i] = getValue(it);
  					}
  					continue;
  				}
  				curQuery[i] = getValue(it);
  			}
  			for (i in rootHashs) {
  				rootPath += rootHashs[i] + '/';
  			}
  			for (i in curQuery) {
  				urlArr.push(i + '=' + curQuery[i]);
  			}
  			if (urlArr.length) {
  				rootPath += '?' + urlArr.join('&');
  			}
  			return rootPath;
  		},
  
  		/**
  		 * @param{String} title 需要设置的title 名
  		 */
  		setTitle: function(title) {
  			(top.document || document).title = title;
  		},
  
  		/**
  		 * 获得在当前的历史纪录信息 (url || hashs)
  		 * @param{String|Number} target			想获得的内容，可以是string可以是数字
  		 * @param{String} type						获得内容的格式
  		 */
  		getHistory: function(target, type) {
  			// 上一页
  			var ni;
  			// type 默认为hashs
  			if (!type) {
  				type = 'hashs';
  			}
  			if (target === 'prev') {
  				return this[type === 'url' ? '_getPrevUrl' : '_getPrevHashs']();
  			} else if (target === 'cur') {
  				return this[type === 'url' ? '_getCurUrl' : '_getCurHashs']();
  			} else if (/^-?\d+$/.test(target)) {
  				ni = this._histories.length;
  				if (!ni) {
  					return false;
  				}
  				// 一般是 －1， 0 表示当前
  				if (target > 0) {
  					return false;
  				} else if (target === 0) {
  					return this._histories[0][type === 'url' ? 'url' : 'hashs'];
  				}
  				if (this._histories[ni + (+ target)]) {
  					return this._histories[ni + (+ target)][type === 'url' ? 'url' : 'hashs'];
  				}
  				return false;
  			}
  			return false;
  		},
  
  		/**
  		 *
  		 * 将数据格式转化成一个以&拼接的URL格式
  		 * @param {Object} data		需要插入的查询内容，如果是多维将压缩成一维
  		 * @param {Boolean} notEncode 是否会需要编码，默认编码
  		 */
  		dataToQuerystr: function(data, notEncode) {
  			var i, it, query = data || {}, str = [],
  				funcFilter = !!notEncode ?  function(it) {
  					// 第二层必须被编码
  					return typeof it === 'object' ? encodeURIComponent(rc.util.jsonString(it)) : it;
  				} : function(it) {
  					return encodeURIComponent(typeof it === 'object' ? (rc.util.jsonString(it)) : it);
  				};
  			for (i in query) {
  				it = query[i];
  				str.push(i + '=' + funcFilter(it));
  			}
  			return str.join('&');
  		},
  
  		/**
  		 *
  		 * 将需要拼接的查询内容添加到url 后面去
  		 * @param {String} url			需要拼接的url
  		 * @param {Object|String} query		需要插入的查询内容，如果是多维将压缩成一维, 支持字符串与对象
  		 * @param {Boolean} notEncode 	是否会需要编码，默认编码
  		 */
  		dataJoinUrl: function(url, query, notEncode) {
  			var a0, a1, b0, b1, str = typeof query === 'object' ? this.dataToQuerystr(query, notEncode) : (query || '');
  			a0 = url.indexOf('?'); //第一个？的位置
  			a1 = url.lastIndexOf('?'); //最后一个？的位置
  			b0 = url.indexOf('#'); //第一个＃的位置
  			b1 = url.lastIndexOf('#'); //最后一个＃的位置
  			if (a0 === -1 && b0 === -1) {
  				// 既没 ＃，又没 ？
  				url += '?' + str;
  			} else if (a0 !== -1 && b0 === -1) {
  				// 有？ 没＃
  				url += '&' + str;
  			} else if (a0 === -1 && b0 !== -1) {
  				// 有＃ 没？
  				url += '?' + str;
  			} else if (a0 !== -1 && b0 !== -1) {
  				// 有？有＃
  				if (a0 === a1 && b0 === b1) {
  					// 一个？一个＃
  					if (a0 < b0) {
  						url += '?' + str;
  					} else {
  						url += '&' + str;
  					}
  				} else {
  					// ？一个，多个＃
  					// 多个？一个＃
  					// 多个 ？多个＃
  					if (b1 > a1) {
  						url += '?' + str;
  					} else {
  						url += '&' + str;
  					}
  				}
  			}
  			return url;
  		},
  
  		/**
  		 *
  		 *  页面跳转（200）
  		 * @param {String} url		url 地址
  		 * @param {Object} query	带有搜索的内容的转化(当只有2个参数时， 可以用于表示isReplace 或者本身)
  		 * @param {Boolean} isReplace	是否替换地址
  		 */
  		goPage: function(url, query, isReplace) {
  			if (!url || url === undefined || url === '') {
  				return;
  			}
  			url = typeof query === 'object' ? this.dataJoinUrl(url, query) : url;
  			// 只有2个参数时，第二个参数可以表示isReplace的意思
  			if (isReplace || query === true) {
  				location.replace(url);
  				return;
  			}
  			location.href = url;
  		},
  
  		/**
  		 *  刷新当前页，启用此方式的时候其实并不会触发url 跳转，而是直接让module 重新处理
  		 */
  		reflash: function() {
  			var curMdul,
  				curHashs = this._getCurHashs(),
  				curUrl = this._getCurUrl();
  
  			if (!curUrl || !curHashs.root) {
  				return;
  			}
  			curMdul = this._getNodeNameByHashs(curHashs);
  			// 先销毁当前的，然后在加载当前的
  			rc.pub('MODULES.DESTROY', {mdulName: curHashs.root, hashs: curHashs});
  			rc.pub('MODULES.LOAD', {mdulName: curHashs.root, hashs: curHashs});
  			rc.pub('MODULES.UPDATE', {mdulName: curMdul, hashs: curHashs, url: curUrl});
  		},
  
  		/**
  		 * @param{Number} backStep 需要回跳的步数
  		 * @param{Boolean} isReplaceStatus 是否取代当前的状态
  		 */
  		goback: function(backStep, isReplaceStatus) {
  			var len = this._histories.length;
  			if (backStep < len) {
  				this._histories = this._histories.slice(len - backStep, len);
  				history.back && history.back(backStep || 1);
  			} else if (this._histories.length) {
  				this._histories = [this._histories.shift()];
  				history.back();
  			}
  		},
  
  		/**
  		 *  从location 或者 某个url 里解析出 hashkey
  		 * @param {String}key		需要去从url 上获得的hash key
  		 * @param {String}url		可选，从某个url 里获得
  		 */
  		getHashKey: function(key, url) {
  			url = url || this._getCurUrl();
  			var strQuery = this._getFilterUrlBySymbol('#', url);
  			if (!strQuery) {
  				// 不存在
  				return undefined;
  			}
  			var obj = this._getHashs(strQuery);
  			return obj[key] || undefined;
  		},
  
  		/**
  		 *  从location 或者 某个url 里解析出 querykey
  		 * @param {String}key		需要去从url 上获得的query key
  		 * @param {String}url		可选，从某个url 里获得
  		 */
  		getHashQueryKey: function(key, url) {
  			url = url || this._getCurUrl();
  			var queryObj = this.getHashQueryObject(url);
  			if (!queryObj) {
  				return undefined;
  			}
  			return queryObj[key] || undefined;
  		},
  
  		/**
  		 *  从location 或者 某个url 里解析出 query object
  		 * @param {String} url		可选，从某个url 里获得
  		 * @param {Boolean} isKeepOrigin 可选, 是否需要编码
  		 */
  		getHashQueryObject: function(url, isKeepOrigin) {
  			url = url || this._getCurUrl();
  			var strQuery = this._getFilterUrlBySymbol('#', url);
  			strQuery = this._getFilterUrlBySymbol('?', strQuery);
  			if (!strQuery) {
  				return false;
  			}
  			return this._queryParser(strQuery.substr(1), {}, isKeepOrigin);
  		},
  
  		/**
  		 *  获得这边的由解析路由得到的配置表
           * @private
  		 * @param {Object} route 必选的路由配置
  		 */
  		_getRouteConf: function(route) {
  			var obj = {},
  				getList = function(curconf){
  					return curconf.list || curconf.cp_list || curconf.app_list || curconf.classification_list;
  				},
  			fn = function(name, conf) {
  				var list = getList(conf), p, o;
  				if (!list) {
  					// list不存在， 结束
  					obj[name] = {
  						name : name,
  						value : conf
  					};
  				} else {
  					// 递归list
  					for (p in list) {
  						fn(name + '.' + p, list[p]);
  					}
  					// 如果default_index存在，说明当前path要指向default_index
  					if (conf.default_index) {
  						obj[name] = obj[name + '.' + conf.default_index];
  					} else {
  						// 不存在default_index，说明是个独立的module, 复制除了list的值
  						o = {};
  						for (p in conf) {
  							if (conf[p] !== list) {
  								o[p] = conf[p];
  							}
  						}
  						obj[name] = {
  							name : name,
  							value : o
  						};
  					}
  				}
  			};
  			// conf首次肯定有list, 放在外面， 是为了不用拼接name.
  			var list = getList(route), p;
  			for (p in list) {
  				fn(p, list[p]);
  			}
  			obj["_default"] = obj[route.default_index];
  			return obj;
  		},
  
  		/**
  		 *  框架加载完成之后的任务执行队列
           * @private
  		 * @param{Object} order		执行队列
  		 */
  		_afterInit: function(order) {
  			order.act && rc.pub(order.act, order.value);
  		},
  
  
  		/**
  		 *
   		 * 初始化
   		 * @param {Object} conf 必选的路由配置
   		 * @param {String} conf.route 表示路由配置表
   		 * @param {String} conf.url	  [可选]默认的当前地址
  		 */
  		init: function(conf) {
  			rc.sub('TATAMI.FEATURESTART.PAGES', this._afterInit, this, true);
  			if (conf && conf.isStaticShow) {
  				return;
  			}
  			rc.sub('EVENTS.HASHCHANGE', this._hashchange, this);
  			rc.sub('PAGES.GOBACK', this.goback, this);
  
  			if (!conf || !conf.route) { return; }
  			var url = conf.url || location.href,
  				hash = this._getFilterUrlBySymbol('#', url);
  			this._routeMapping = this._getRouteConf(conf.route);
  			this._routeOrigin = rc.util.deepClone(conf.route);
  			this._doPagechangeAct(hash, true, url);
  		}
  	};
  
  	/**
  	 *
  	 * 提供给module 和 control 使用的关于pages 的操作部分
  	 */
  	rc.pages.pagesInterface = function() {
  		var self = this;
  		return {
  			/**
  			 *  module 将内建pageschange 方法以减少对于pages 功能件的调用
  			 * @param {Object} urlObject			传递的需要改变的urlPath
  			 * @param {Boolean} isNotDecode			是否需要encode
  			 * @param {Boolean} isClear				是否需要清空之前的 queryString（指在hash后的部分）
  			 */
  			pagesModify: function(urlObject, isNotDecode, isClear) {
  				return self.pagesModify(urlObject, isNotDecode, isClear);
  			},
  
  			/**
  			 *  从location 或者 某个url 里解析出 hashkey
  			 * @param {String}key		需要去从url 上获得的hash key
  			 * @param {String}url		可选，从某个url 里获得
  			 */
  			getHashKey: function(key, url) {
  				return self.getHashKey(key, url);
  			},
  
  			/**
  			 *  从location 或者 某个url 里解析出 querykey
  			 * @param {String}key		需要去从url 上获得的query key
  			 * @param {String}url		可选，从某个url 里获得
  			 */
  			getHashQueryKey: function(key, url) {
  				return self.getHashQueryKey();
  			},
  
  			/**
  			 *  从location 或者 某个url 里解析出 query object
  			 * @param {String}url		可选，从某个url 里获得
  			 */
  			getHashQueryObject: function(url) {
  				return self.getHashQueryObject(url);
  			},
  
  			/**
  			 * @param{Number} backStep 需要回跳的步数
  			 * @param{Boolean} isReplaceStatus 是否取代当前的状态
  			 */
  			goback: function(backStep, isReplaceStatus) {
  				return self.goback(backStep, isReplaceStatus);
  			},
  
  			/**
  			 *  刷新当前页，启用此方式的时候其实并不会触发url 跳转，而是直接让module 重新处理
  			 */
  			reflash: function() {
  				return self.reflash();
  			},
  
  			/**
  			 *
  			 *  页面跳转（200）
  			 * @param {String} url		url 地址
  			 * @param {Object} query	传入需要跳转的参数，当只有2个参数时，可以表示isReplace
  			 * @param {Boolean} isReplace	是否替换地址
  			 */
  			goPage: function(url, query, isReplace) {
  				return self.goPage(url, isReplace);
  			},
  
  			/**
  			 * @param{String|Number} target			想获得的内容，可以是string可以是数字
  			 * @param{String} type						获得内容的格式
  			 * 获得在当前的历史纪录信息 (url || hashs)
  			 */
  			getHistory: function(target, type) {
  				return self.getHistory(target, type);
  			}
  		};
  	};
  })(window.Tatami);
  ;
  /**
   * @class util
   * require Tatami.events
   */
  ;(function(rc) {
  	if (!rc) {
  		rc = window.Tatami = {};
  	}
  	// 工具集合
  	rc.util = {
  		
  		/**
  		 * @param{Object} conf 配置表 
  		 */
  		init: function(conf) {
  			if (!conf || !conf.plugins || !conf.plugins.notis) {
  				return;
  			}
  			var notis = conf.plugins.notis;
  			//消息的派送
  			notis.showLoading && rc.sub('NOTI.SHOWLOADING', notis.showLoading, this);
  			notis.showWarnning && rc.sub('NOTI.SHOWWARNNING', notis.showWarnning, this);
  			notis.showSuccess && rc.sub('NOTI.SHOWSUCCESS', notis.showSuccess, this);
  			notis.showFail && rc.sub('NOTI.SHOWFAIL', notis.showFail, this);
  			notis.clearShow && rc.sub('NOTI.CLEARSHOW', notis.clearShow, this);
  		},
  		
  		/**
  		 *  json.stingify 转化
  		 * @param {Object}  data 需要转化为string 的object 或者 json
  		 */
  		jsonString: function(data) {
  			if (typeof data !== 'object') {
  				return false;
  			}
  			if (JSON && JSON.stringify) {
  				return JSON.stringify(data);
  			}
  			return this._clone(data, true);
  		},
  		
  		/**
  		 *  json.parse 转化
  		 * @param {String}  str 需要转化为data 的string
  		 */
  		jsonParse: function(str) {
  			if (typeof str !== 'string') {
  				return false;
  			}
  			var data;
  			try {
  				data = JSON.parse(str);
  			} catch(e) {
  				try {
  					data = eval('(' + str + ')');
  				} catch(e) {}
  			}
  			return data || undefined;
  		},
  		
  		/**
  		 * 
   		 *  利用递归返回一个深度克隆的对象
   		 * @param {Object} data 需要被clone 的元素
  		 */
  		deepClone: function(data) {
  			var _data;
  			switch(typeof data) {
  				case 'string':
  					_data = data + '';
  					break;
  				case 'number':
  					_data = + data;
  					break;
  				case 'boolean':
  					_data = !!data;
  					break;
  				default:	
  				case 'object':
  					_data = this._clone(data);
  					break;	
  			}
  			return _data;
  		},
  		
  		/**
  		 * 
   		 *  递归克隆
           * @private
   		 * @param {Object} data 
   		 * @param {Boolean} isFormatData		是否需要格式化
  		 */
  		_clone: function(data, isFormatData) {
  			var isArray = data instanceof Array,
  				o = isArray ? [] : {},
  				i, ni, it, itType;
  			if (isArray) {
  				for (i = 0, ni = data.length; i < ni; i++) {
  					it = data[i];
  					itType = typeof it;
  					o.push(itType === 'object' ? 
  						this._clone(it, isFormatData) : it);
  				}
  			} else if (data === null) {
  				o = null;
  			} else {
  				for (i in data) {
  					it = data[i];
  					itType = typeof it;
  					o[isFormatData ? '"' + i + '"' : i] = itType === 'object' ? 
  						this._clone(it, isFormatData) : it;
  				}
  			}
  			return o;
  		},
  		
  		date: {
  			_date_cur_date: new Date(),
  			_date_reg_all: /^[12][0-9]{3}(-|\/)(0?[0-9]|1[0-2])(-|\/)(0?[1-9]|[1-2][0-9]|3[0-1]).(0?[0-9]|1[0-9]|2[0-3]):(0?[0-9]|[1-5][0-9]):(0?[0-9]|[1-5][0-9])$/,
  			_date_reg_year_month: /^[12][0-9]{3}(-|\/)(0?[0-9]|1[0-2])$/,
  			_date_reg_year_month_date: /^[12][0-9]{3}(-|\/)(0?[0-9]|1[0-2])(-|\/)(0?[1-9]|[1-2][0-9]|3[0-1])$/,
  			_date_reg_year_month_date_hour: /^[12][0-9]{3}(-|\/)(0?[0-9]|1[0-2])(-|\/)(0?[1-9]|[1-2][0-9]|3[0-1]).(0?[0-9]|1[0-9]|2[0-3])$/,
  			_date_reg_year_month_date_hour_minute: /^[12][0-9]{3}(-|\/)(0?[0-9]|1[0-2])(-|\/)(0?[1-9]|[1-2][0-9]|3[0-1]).(0?[0-9]|1[0-9]|2[0-3]):(0?[0-9]|[1-5][0-9])$/,
  			_date_reg_time: /^(0?[0-9]|1[0-9]|2[0-3]):(0?[0-9]|[1-5][0-9]):(0?[0-9]|[1-5][0-9])$/,
  			
  			/***
  			 * @param {Object|Number|String} date
  			 * @param {Object} format
  			 */
  			getdate: function(date, format) {
  				var now = this.tojsdate(date), 
  					year = now.getFullYear(), 
  					month = (now.getMonth() + 1), 
  					day = now.getDate(), 
  					hour = now.getHours(), 
  					minute = now.getMinutes(),
  					second = now.getSeconds(),
  					result, fill = function(val) {
  						return (val < 10 ? '0' : '') + val;
  					};
  				month = fill(month);	
  				day = fill(day);
  				hour = fill(hour);
  				minute = fill(minute);
  				second = fill(second);
  				
  				switch(format) {
  					case 'YY-MM':
  						result = year + '-' + month;
  						break;
  					case 'MM-DD':
  						result = month + '-' + day;
  						break;	
  					case 'YY-MM-DD': 
  						result = year + '-' + month + '-' + day;
  						break;
  					case 'YY-MM-DD HH:MM:SS':
  						result = year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
  						break;	
  					case 'YY-MM-DD HH:MM':
  						result = year + '-' + month + '-' + day + ' ' + hour + ':' + minute;
  						break;
  					case 'YY/MM/DD HH:MM':
  						result = year + '/' + month + '/' + day + ' ' + hour + ':' + minute;
  						break;
  					case 'HH:MM':
  						result = hour + ':' + minute;
  						break;
  					case 'HH:MM:SS':
  						result = hour + ':' + minute + ':' + second;
  						break;
  					default:
  						result = year + '/' + month + '/' + day + ' ' + hour + ':' + minute + ':' + second;	
  				}
  				return result;
  			},
  			setcurdate: function(val) {
  				this._date_cur_date = new Date(this.format_date(val));
  			},
  			//以后所有的时间都从这块来, 这块的时间将会配合时间矫正来处理.
  			getcurdate: function() {
  				return new Date(this._date_cur_date);
  			},
  			//转化成为js 的时间
  			tojsdate: function(date) {
  				if (!this.is_date(date)) {
  					return this.getcurdate();
  				}
  				if (typeof date === 'string') {
  					if (/^\d{11,}$/.test(date)) {
  						return  new Date(+date);
  					}
  					date = date.replace(/-/g, '\/');
  					if (this._date_reg_year_month.test(date)) {
  						date += '/01';
  					}
  				}
  				return new Date(date);
  			},
  			/**
  			 * 
  			 * Number+	y|mo|d|h|m|s 分别表示年/月/日/小时/分/秒.  如果没带后缀, 则默认为天.
  			 * @param {Object|Number|String} oldDate
  			 * @param {String|Number} changeDate
  			 */
  			getdiffdate: function(oldDate, changeDate, format) { 
  				var curDate = this.tojsdate(oldDate);
  				if (/^(-?\d+)y$/.test(changeDate)) {
  					curDate.setFullYear(curDate.getFullYear() + (+ RegExp.$1));
  				} else if (/^(-?\d+)mo$/.test(changeDate) && RegExp.$1 != 0) {
  					// 缓存当前的天
  					var _cache_day = curDate.getDate();
  					
  					// 重置到月初. 如果当前的 getDate() 大于目标月的最大日期就悲剧了
  					curDate.setDate(1);
  					
  					// 设置月份
  					curDate.setMonth(curDate.getMonth() + (+ RegExp.$1));
  					curDate.setDate(_cache_day);
  					
  					if (curDate.getDate() != _cache_day) {
  						// 上个月的最后一天
  						curDate.setDate(0);
  					}
  					
  				} else if (/^(-?\d+)d$/.test(changeDate)) {
  					curDate.setDate(curDate.getDate() + (+ RegExp.$1));
  				} else if (/^(-?\d+)h$/.test(changeDate)) {
  					curDate.setHours(curDate.getHours() + (+ RegExp.$1));
  				} else if (/^(-?\d+)m$/.test(changeDate)) {
  					curDate.setMinutes(curDate.getMinutes() + (+ RegExp.$1));
  				} else if (/^(-?\d+)s$/.test(changeDate)) {
  					curDate.setSeconds(curDate.getSeconds() + (+ RegExp.$1));
  				}
  				return this.getdate(curDate, format);
  			},
  			format_date: function(date) {
  				if (!date || !this.is_date(date)) {
  					return false;
  				}
  				var reg = this._date_reg_time;
  				if (reg.test(date)) {
  					return date.replace(/-/g, '\/');
  				} else {
  					return this.getdate(date);
  				}
  			},
  			is_date: function(date) {
  				if (!date || date === null) {
  					return false;
  				}
  				var newdate;
  				if (typeof date === 'string') {
  					if (/^\d{11,}$/.test(date)) {
  						newdate = new Date(+date);
  						return newdate != 'Invalid Date';
  					}
  					return this._date_reg_all.test(date) ||
  								this._date_reg_year_month.test(date) ||
  								this._date_reg_year_month_date.test(date) ||
  								this._date_reg_year_month_date_hour.test(date) ||
  								this._date_reg_year_month_date_hour_minute.test(date);
  				}
  				newdate = new Date(date);
  				return newdate != 'Invalid Date';
  			},
  		},
  		/**
  		 * 模板字符串过滤
  		 *  
  		 * @param{String} str		需要过滤的字符串
  		 */
  		htmlFilter: function(str) {
  			return typeof str === 'string' ? str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') : str;
  		},
  		/**
  		 * 模板字符串过滤
  		 * @param{Object} object		需要循环的对象,<IE9不支持对象，只支持数组
  		 * @param{Function} iteratee迭代器
  		 * @param{Object} context	  上下文环境
  		 */
  		map: function(object, iteratee, context) {
  			var obj = rc.util.deepClone(object),
  				keys = !(typeof obj.length == 'number') && rc.util.keys(obj),
  				length = (keys || obj).length,
  				index, 
  				currentKey;
  			for (index = 0; index < length; index++) {
  				currentKey = keys ? keys[index] : index;
  				obj[currentKey] = iteratee ? context ?
  					iteratee.call(context, obj[currentKey], currentKey, obj) : iteratee(obj[currentKey], currentKey, obj) : obj[currentKey];
  			}
  			return obj;
  		},
  
          keys: function(obj)  {
              if (typeof obj !== 'object') return [];
              if (Object.keys) return Object.keys(obj);
              var keys = [];
              for (var key in obj) {
                  if (obj.hasOwnProperty(key)) {
                      keys.push(key);
                  }
              }
              return keys;
          }
  	};
  })(window.Tatami);
  ;
  /**
   * @depend Tatami.util, Tatami.events
   * @class events
   * @author Jerrod
   */
  (function(rc) {
  	
  	if (!rc) {
  		window.Tatami = rc = {};
  	}
  	if (!rc.events) {
  		rc.events = {};
  	}
  	
  	
  	
  	rc.events = {
  		_isCanClick: true,
  		
  		setClickStatus: function(val) {
  			return this._isCanClick = val;
  		},
  		getClickStatus: function() {
  			return this._isCanClick;
  		},
  		
  		
  		// 以dom 节点对应的数据的集合点, 在数组中便利才能够识别
  		_dataDomEvtHandlerNode: [],
  		
  		__domEvtChangeReg: /^select|input$/i,
  		__domEvtChangeBind: function(nodeObj, evtName) {
  			var isMatchTag, reg = this.__domEvtChangeReg, prevVal, curElm, that = this;
  			var changeVal = function(e) {
  				curElm = e.srcElement;
  				if (!reg.test(curElm.nodeName)) {
  					return;
  				}
  				if (prevVal === undefined) {
  					prevVal = curElm.value;
  				} else if (prevVal !== curElm.value) {
  					prevVal = curElm.value;
  					that.__domEvtListApply(evtName, nodeObj, [].slice.apply(arguments));
  				}
  			};
  			nodeObj.funcs[evtName + '-onclick'] = nodeObj.funcs[evtName + '-onfocusout'] = nodeObj.funcs[evtName + '-onbeforeactiveate'] = changeVal;
  			nodeObj.elm.attachEvent('onclick', nodeObj.funcs[evtName + '-onclick']);
  			nodeObj.elm.attachEvent('onfocusout', nodeObj.funcs[evtName + '-onfocusout']);
  			nodeObj.elm.attachEvent('onbeforeactiveate', nodeObj.funcs[evtName + '-onbeforeactiveate']);
  		},
  		
  		__domEvtChangeUnBind: function(nodeObj, evtName) {
  			nodeObj.elm.detachEvent('onclick', nodeObj.funcs[evtName + '-onclick']);
  			delete nodeObj.funcs[evtName + '-onclick'];
  			nodeObj.elm.detachEvent('onfocusout', nodeObj.funcs[evtName + '-onfocusout']);
  			delete nodeObj.funcs[evtName + '-onfocusout'];
  			nodeObj.elm.detachEvent('onbeforeactiveate', nodeObj.funcs[evtName + '-onbeforeactiveate']);
  			delete nodeObj.funcs[evtName + '-onbeforeactiveate'];
  		},
  		
  		/**
           * @private
  		 * @param{String} evtName		事件名称
  		 * @param{Object} nodeObj 		该节点的所有属性
  		 * @param nodeObj.elm  		元素
  		 * @param nodeObj.evts		事件集合
  		 */
  		_domEvtBind: document.addEventListener ? function(evtName, nodeObj, capture) {
  				var that = this;
  				nodeObj.funcs[evtName] = function() {
  					that.__domEvtListApply(evtName, nodeObj, [].slice.apply(arguments));
  				};
  				nodeObj.elm.addEventListener(evtName, nodeObj.funcs[evtName], capture);
  			} : function(evtName, nodeObj, capture) {
  				var that = this, evtname = evtName;
  				if (evtname === 'change' && !this.__domEvtChangeReg.test(nodeObj.elm.nodeName)) {
  					this.__domEvtChangeBind(nodeObj, evtName);
  					return;
  				}
  				nodeObj.funcs[evtName] = function() {
  					that.__domEvtListApply(evtName, nodeObj, [].slice.apply(arguments));
  				};
  				if (capture) {
  					evtname = this._speicalInterfaceEvtList[evtName];
  				}
  				nodeObj.elm.attachEvent('on' + evtname, nodeObj.funcs[evtName]);
  			},
  			
  		/**
  		 *  对于特殊的事件，我们采用直接绑定的方式来处理
           * @private
  		 * @param{String} evtName		事件名称
  		 * @param{Object} nodeObj 		该节点的所有属性
  		 * @param nodeObj.elm: 		元素
  		 * @param nodeObj.evts:		事件集合
  		 * 
  		 */
  		_domEvtBind_Speical: function(evtName, nodeObj) {
  			var that = this;
  			nodeObj.funcs[evtName] = function() {
  				that.__domEvtListApply(evtName, nodeObj, [].slice.apply(arguments));
  			};
  			nodeObj.elm['on' + evtName] = nodeObj.funcs[evtName];
  		},	
  		
  		/**
           * @private
  		 * @param{String} evtName		事件名称
  		 * @param{Object} nodeObj 		该节点的所有属性
  		 * @param{Array} args			传递过来的上一个 events
  		 */	
  		__domEvtListApply: function(evtName, nodeObj, args) {
  			if (!nodeObj.evts[evtName] || !nodeObj.evts[evtName].length) {
  				return;
  			}
  			var i = 0, arr = nodeObj.evts[evtName], ni = arr.length, fn, elm = nodeObj.elm;
  			for (; i < ni; i++) {
  				fn = arr[i];
  				fn.apply(elm, args);
  			}
  		},
  		
  		/**
           * @private
  		 * @param{Object} nodeObj 		该节点的所有属性
  		 * @param{String} evtName		事件名称
  		 */
  		_domEvtUnbind: document.addEventListener ? function(nodeObj, evtName) {
  			nodeObj.elm.removeEventListener(evtName, nodeObj.funcs[evtName]);
  			delete nodeObj.funcs[evtName];
  		} : function(nodeObj, evtName) {
  			if (evtName === 'change' && !this.__domEvtChangeReg.test(nodeObj.elm.nodeName)) {
  				this.__domEvtChangeUnBind(nodeObj, evtName);
  				return;
  			}
  			nodeObj.elm.detachEvent(evtName, nodeObj.funcs[evtName]);
  			delete nodeObj.funcs[evtName];
  		},
  		
  		/**
  		 *  特殊事件的解绑
           * @private
  		 * @param{Object} nodeObj 		该节点的所有属性
  		 * @param{String} evtName		事件名称
  		 */
  		_domEvtUnBind_Speical: function(nodeObj, evtName) {
  			nodeObj.elm['on' + evtName] = null;
  			delete nodeObj.funcs[evtName];
  		},
  		
  		// 一些特殊的事件，个性化的事件，我们也需要兼顾
  		_speicalPluginEvtList: /^ifClicked|ifChanged/,
  		
  		// 接口事件, 接口事件需要启动捕获
  		_speicalInterfaceEvtList: {
  			focus: 'focusin',
  			blur: 'focusout',
  			load: 'load',
  			change: 'change',
  			submit: 'submit',
  			scroll: 'scroll'
  		},
  		
          /**
           *
           * @private
           */
  		_getEvtType: function(type) {
  			if (this._speicalPluginEvtList.test(type)) {
  				// 这个是说我们需要完全使用 on ＋ 某事件来代理的
  				return 'p0';
  			} else if (this._speicalInterfaceEvtList[type] != undefined) {
  				// 这个是接口事件，需要捕获的
  				return 'p1';
  			}
  			// 这个是常规事件
  			return 'p2';
  		},
  		
  		/**
  		 * @param elm 		需要绑定的元素(HtmlElement)
  		 * @param{String} evtName		事件名称
  		 * @param{Function} handler		事件句柄
  		 */
  		domEvtBind: function(elm, evtName, handler) {
  			if (!elm || !evtName || !handler) { return; }
  			// evtName 可以是多事件组合, 中间用空格间隔, 如 click mouseover mouseout
  			var evtnames = evtName.split(' ');
  			if (evtnames.length > 1) {
  				rc.util.map(evtnames, function(it) {
  					this.domEvtBind(elm, it, handler);
  				}, this);
  				return;
  			}
  			var i = 0, arr = this._dataDomEvtHandlerNode, ni = arr.length;
  			var finder, node, newNode;
  			for (; i < ni; i++) {
  				node = arr[i];
  				if (node.elm === elm) {
  					finder = node;
  					break;
  				}
  			}
  			var _dtype = this._getEvtType(evtName);
  			// 如果找到，则继续添加判断
  			if (finder) {
  				if (!finder.evts[evtName]) {
  					finder.evts[evtName] = [];
  					this[_dtype === 'p0' ? '_domEvtBind_Speical' : '_domEvtBind'](evtName, finder, _dtype === 'p1');
  				}
  				finder.evts[evtName].push(handler);
  			} else {
  				newNode = {
  					elm: elm,
  					evts: {},
  					funcs: {},
  				};
  				newNode.evts[evtName] = [handler];
  				this[_dtype === 'p0' ? '_domEvtBind_Speical' : '_domEvtBind'](evtName, newNode, _dtype === 'p1');
  				this._dataDomEvtHandlerNode.push(newNode);
  				
  			}
  		},
  		
  		/**
  		 * @param dom 		需要绑定的元素(HtmlElement)
  		 * @param{String} evtName		事件名称
  		 * @param{Function} handler		事件句柄
  		 */
  		domEvtUnbind: function(elm, evtName, handler) {
  			if (!elm || !evtName || !handler) { return; }
  			// evtName 可以是多事件组合, 中间用空格间隔, 如 click mouseover mouseout
  			var evtnames = evtName.split(' ');
  			if (evtnames.length > 1) {
  				rc.util.map(evtnames, function(it) {
  					this.domEvtUnbind(elm, it, handler);
  				}, this);
  				return;
  			}
  			var i = 0, arr = this._dataDomEvtHandlerNode, ni = arr.length;
  			var finder, node, newNode;
  			for (; i < ni; i++) {
  				node = arr[i];
  				if (node.elm === elm) {
  					finder = node;
  					break;
  				}
  			}
  			if (!finder || !finder.evts[evtName] || !finder.evts[evtName].length) {
  				return;
  			}
  			var fn;
  			for (i = 0, arr = finder.evts[evtName], ni = arr.length; i < ni; i++) {
  				fn = arr[i];
  				if (fn == handler) {
  					// FIXME, 原则上我们不允许塞进同样的一个handler执行请求，因为那样无法识别，所以将全部删除同类操作
  					arr.splice(i, 1);
  				}
  			}
  			var _dtype;
  			if (!arr.length) {
  				// 当里面没有操作当时候，我们则去掉整个该事件，以减少事件链的长度
  				delete finder.evts[evtName];
  				_dtype = this._getEvtType(evtName);
  				this[_dtype === 'p0' ? '_domEvtUnBind_Speical' : '_domEvtUnbind'](finder, evtName);
  			}
  		},
  		
  		
  		/**
  		 *  once 是sub 事件的特例
  		 * @param{String} name 			该事件的名称
  		 * @param{Function} callback	该事件的句柄回调
  		 * @param{Object} context		该事件的上下文
  		 * 
  		 */
  		once: function(name, callback, context) {
  			return this.sub(name, callback, context, true);
  		},
  		
  		/**
           * @private
  		 * event 有多方用途: 
  		 * 1. event 主要用于处理与我们的需求与 jqm 冲突的事件级的处理方式, 主要是click 事件;
  		 * 2. 事件的订阅和派送, 建立pub/sub 机制
  		 */
  		_list: {},
  		
  		// 内部系统级用的事件队列－减少大队列的时间
  		_sysList: {},
  		
  		/**
           * @private
  		 * @param {String} name		输入名字判断是否属于系统内部的
  		 */
  		_checkIsSysKey: function(name) {
  			return /^(ERROR|MODULES|EVENTS|PAGES|TATAMI|CONTROLS|SERVER|VIEWS)\./.test(name);
  		},
  
          /**
           * @param {String} name
           * @param callback 相应订阅时的事件
           * @param context  当前上下文
           * @param isOnce   是否只运行一次的事件
           *
           */
  		sub: function(name, callback, context, isOnce) {
  			var isSysKey = this._checkIsSysKey(name),
  				list = this[isSysKey ? '_sysList' : '_list'], it = list[name];
  			if (!it) {
  				it = this[isSysKey ? '_sysList' : '_list'][name] = [];
  			}
  			it.push({
  					isOnce: !!isOnce,
  					func: context ? function() {
  							callback.apply(context, arguments);
  						} : callback,
  					// FIXME 增加了一个原始的引用用于之后做判断	
  					orignFunc: callback
  				}
  			);
  			return this;
  		},
  		/**
  		 * 派发事件
  		 * @param {String} name - 字符串
  		 */
  		pub: function(name, params) {
  			var isSysKey = this._checkIsSysKey(name),
  				list = this[isSysKey ? '_sysList' : '_list'], i, j, nj, it;
  			//var _params = Array.prototype.splice.call(arguments, 1);
  			var _params = [].slice.call(arguments, 1);
  			
  			for (i in list) {
  				if (name === i) {
  					it = list[i];
  					for (j = 0, nj = it.length; j < nj; j++) {
  						it[j] && it[j].func && it[j].func.apply(null, _params);
  						// FIXME 由于一些内容已经被删除导致了该文件不存在，所以需要判断一次
  						if (it[j] && it[j].isOnce) {
  							// 如果是once，则使用完一次后，移除
  							this.removeSub(name, it[j].func);
  						}
  					}
  				}
  			}
  			return this;
  		},
  		
  		/**
  		 * 移除派发事件
  		 * @param {String} name
  		 * @param {Function} callback
  		 */
  		removeSub: function(name, callback) {
  			var isSysKey = this._checkIsSysKey(name),
  				list = this[isSysKey ? '_sysList' : '_list'], i, j, nj, it;
  			for (i in list) {
  				if (name === i) {
  					it = list[i];
  					if (!callback) {
  						list[i] = [];
  						return this;
  					}
  					for (j = 0, nj = it.length; j < nj; j++) {
  						if (!it[j]) {
  							continue;
  						}
  						if (it[j].orignFunc === callback) {
  							it.splice(j, 1);
  						}
  					}
  					if (!it.length) {
  						delete list[i];
  					}
  				}
  			}
  			return this;
  		},
  		
  		//是否允许进一步的点击.
  		clickable: function(callback, context) {
  			var that = this;
  			return function() {
  				if (!that.getClickStatus()) {
  					return false;
  				}
  				var arg = arguments;
  				if (context !== undefined) {
  					arg = [].slice.call(arguments);
  					arg = [context].concat(arg);
  				}
  				return callback ? callback.apply(this, arg) : false;
  			};
  		},
  		
  		/**
  		 * 
  		 * @param {Object} callback
  		 * @param {Object} context
  		 * 代理，其实就是对于clickable的简化
  		 */
  		proxy: function(callback, context) {
  			return function() {
  				var args = arguments;
  				callback.apply(context || this, args);
  			};
  		},
  		
  		// window resize 事件的句柄
  		__domEvtWinResizeHandler: null,
  		
          /**
           * @private
           *
           * 派发window.resize 事件,
           */
  		_pubDomEvtWinResize: function() {
  			clearTimeout(this.__domEvtWinResizeHandler); //老版本的浏览器下, resize 会2次的问题. 此操作为拖拽停止时, 才会处理相应.
  			this.__domEvtWinResizeHandler = setTimeout(function() {
  				rc.pub('EVENTS.WINRESIZE', true);
  			}, 1);
  		},
  		
  		//派发click 事件
  		_domEvtDocClick: function(e) {
  			this.pub('EVENTS.DOCCLICK', {
  				e: e,
  				target: e.target || e.srcElement
  			});
  		},
  		
  		// 派发 hashchange 事件
  		_pubDomEvtHashchange: function() {
  			this.pub('EVENTS.HASHCHANGE', location.href);
  		},
  		
  		// 派发 sessionstorage change 事件
  		_pubDomEvtWinSession: function() {
  			this.pub('EVENTS.SESSIONCHANGE', [].slice.call(arguments));
  		},
  		
  		// 派发 localstorage change 事件
  		_pubDomEvtWinStorage: function() {
  			this.pub('EVENTS.STORAGECHANGE', [].slice.call(arguments));
  		},
  		
  		// 派发 js error
  		_pubDomEvtJsError: function() {
  			this.pub('ERROR.JSERROR', [].slice.call(arguments));
  		},
  		
  		
  		init: function() {
  			this.domEvtBind(window, 'resize', this.proxy(this._pubDomEvtWinResize, this));
  			this.domEvtBind(window, 'hashchange', this.proxy(this._pubDomEvtHashchange, this));
  			this.domEvtBind(document.body, 'click', this.proxy(this._domEvtDocClick, this));
  			this.domEvtBind(window, 'session', this.proxy(this._pubDomEvtWinSession, this));
  			this.domEvtBind(window, 'storage', this.proxy(this._pubDomEvtWinStorage, this));
  			this.domEvtBind(window, 'error', this.proxy(this._pubDomEvtJsError, this));
  		}
  	};
  	
  	rc.sub = function(name, callback, context) {
  		return this.events.sub(name, callback, context);
  	};
  	rc.pub = function(name, params) {
  		return this.events.pub.apply(this.events, arguments);
  	};
  	rc.removeSub = function(name, callback) {
  		return this.events.removeSub(name, callback);
  	};
  })(window.Tatami);
  ;
  /**
   * @depend Tatami.events, Tatami.util
   * @class request
   * @author Jerrod
   *
   */
  (function(rc, $) {
  	var resultRule = {
  			1: 'success',
  			2: '参数异常',
  			3: '服务端运行异常',
  			4: '服务端内部错误',
  			5: '服务端内部调用失败',
  			6: '淘宝服务调用失败',
  			7: '调用内部程序失败',
  			8: '用户没有权限'
  		};
  	if (!rc) {
  		rc = window.Tatami = {};
  	}
  
  
  	var regScriptTxt = /^(?:text|application)\/javascript/i, // 验证script 内容 (从mime 里来)
  		regXmlType = /^(?:text|application)\/xml/i, // 验证 xml 的内容 (从mime 里来)
  		ckJsonType = 'application/json', // 验证是否 json (从mime 里来)
  		ckHtmlType = 'text/html',
  		ckCssType = 'text/css',
  		ckPlainType = 'text/plain'; // 验证是否 html (从mime 里来)
  
  	/**
  	 * 判断mime 的类型
  	 * @param {String} mime		来自于header 里 'content-type' 的类型
  	 */
  	function getMimeType(mime) {
  		return mime === ckHtmlType ? 'html' :
  						mime === ckJsonType ? 'json' :
  							mime === ckCssType ? 'css' :
  								 mime === ckPlainType ? 'plain' :
  									regScriptTxt.test(mime) ? 'script' :
  										regXmlType.test(mime) ? 'xml' : 'text';
  	}
  	// 几种基本的请求类型集合
  	var requireContentType = {
  		script: 'text/javascript, application/javascript',
  		json: ckJsonType,
  		xml: 'application/xml, text/xml',
  		html: ckHtmlType,
  		text: ckPlainType
  	};
  
  	/**
  	 *
  	 * 单独封装的ajax，它支持和jq类似的处理逻辑，但是更简化
  	 * 目前暂时支持xhr1，另外需要支持到jsonp
  	 * @param {Object} settings			设置选项
  	 * @param {Object} settings.accepts			内容类型发送请求头（Content-Type）
  	 * @param {Boolean} settings.async			是否异步，默认true
  	 * @param {Function} settings.beforeSend	发送前的操作
  	 * @param {Boolean} settings.cache			是否会需要添加随机字串在后面从而不缓存，默认true
  	 * @param {Function} settings.complete		结束之后的调用，在success || error 后面
  	 * @param {Boolean|String} settings.contentType		(default: 'application/x-www-form-urlencoded; charset=UTF-8')
  	 * @param {Boolean} settings.crossDomain	是否需要跨域，默认false
  	 * @param {Object|String} settings.data		需要发送过去的内容，可以是对象也可以是字符串, 数字, 数组 等
  	 * @param {String} settings.dataType		需要返回的内容 (xml, json, script, or html)，我们默认不指定则为string
  	 * @param {Function} settings.fail			失败之后的执行操作
  	 * @param {Object} settings.headers			header 里的内容设置
  	 * @param {String} settings.jsonp			在一个JSONP请求中重写回调函数的名字。这个值用来替代在"callback=?"这种GET或POST请求中URL参数里的"callback"部分
  	 * @param {String} settings.jsonpCallback	为jsonp 指定一个特定的返回执行操作
  	 * @param {String} settings.method			发送方式，默认“get” （get，default）
  	 * @param {Function} settings.success		成功之后的回调（data，status，xhr）
  	 * @param {Function} settings.receiving		接受中的回调（data，status，xhr）
  	 * @param {Number} settings.timeout			超时时间
  	 * @param {String} settings.type			等同 method
  	 * @param {String} settings.url				需要发送的地址，默认相对当前地址
  	 *
  	 */
  	function ajax(settings) {
  		if (settings.dataType === 'jsonp' || settings.jsonp || settings.jsonpCallback) {
  			return funcJsonp(settings);
  		}
  		var xhr = getXhr(),
  			isGet = /get/i.test(settings.method) || /get/i.test(settings.type) || (!settings.method && !settings.type),
  			isAsync = settings.async !== false, url = settings.url, handler, isBreak;
  
  		var preHeaders = {}, mime;
  
  		// 如果有需要传递 mime 的类型
  		if (mime = requireContentType[settings.dataType]) {
  			// FIXME 暂时不想要支持重写 overrideMimeType. 因为他会构成两次请求
  			preHeaders['Accept'] = mime;
  			mime = mime.split(',')[0]; // 如果遇到多选的条件, 则我们只需要第一个就可以了.
  			// 重写需要传递的mime, xhr2 开始支持, 可以自定义前后端所需要格式
  			xhr.overrideMimeType && xhr.overrideMimeType(mime);
  		}
  
  		// 如果有设置接受的类型
  		preHeaders['Content-Type'] = settings.contentType || 'application/x-www-form-urlencoded';
  
  		// 如果有设置头信息
  		settings.headers && rc.util.map(settings.headers, function(it, key) {
  			preHeaders[key] = it;
  		}, this);
  		var dataType = settings.dataType;
  		xhr.onreadystatechange = function() {
  			var trunk, rState = xhr.readyState, isError;
  			if (isBreak) { return;}
  			if (rState >= 3) {
  				// >=3 就已经开始接收数据了
  				if (!dataType) {
  					dataType = getMimeType(xhr.getResponseHeader('content-type'));
  				}
  				try {
  					switch(dataType) {
  						case 'script':
  							eval(xhr.responseText);
  							break;
  						case 'xml':
  							trunk = xhr.responseXML;
  							break;
  						case 'json':
  							trunk = rc.util.jsonParse(xhr.responseText);
  							break;
  						default:
  							trunk = xhr.responseText;
  							break;
  					}
  				} catch(e) {
  					isError = true;
  					settings.fail && settings.fail(xhr, e);
  				}
  				clearTimeout(handler);
  				if (isError) { return; }
  				if (rState === 3) {
  					settings.receiving && settings.receiving(xhr, trunk);
  				} else if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {
  					// 成功 || 被跳转了 || 失败, 都应该走到这个流程里来
  					settings.success && settings.success(trunk, xhr);
  					settings.complete && settings.complete(xhr, trunk);
  				} else {
  					settings.fail && settings.fail(xhr, trunk);
  					settings.complete && settings.complete(xhr, trunk);
  				}
  			}
  		};
  		if (isGet && settings.data) {
  			url = rc.pages.dataJoinUrl(url, settings.data);
  		}
  		xhr.open(isGet ? 'get' : 'post', url, isAsync);
  		// 设置全部请求的头
  		rc.util.map(preHeaders, function(it, key) {
  			xhr.setRequestHeader(key, it);
  		}, this);
  
  		if (typeof settings.timeout === 'number') {
  			handler = setTimeout(function() {
  				xhr.onreadystatechange = null;
  				isBreak = true;
  				xhr.abort();
  				settings.fail && settings.fail(xhr, settings);
  				settings.complete && settings.complete(xhr, settings);
  			}, settings.timeout);
  		}
  		var sData = settings.data, tpSData = typeof sData;
  		xhr.send(isGet || sData === undefined ? null : 
  			/^number|string$/i.test(tpSData) ? sData : 
  				/^array$/i.test(tpSData) ? sData.join(',') : (rc.pages.dataToQuerystr(sData) || null));
  		// 如果在beforeSend 里直接就阻止了, 我们就不往下进行了.
  		if (settings.beforeSend && settings.beforeSend(xhr, settings) === false) {
  			xhr.abort();
  			return xhr;
  		};
  		return xhr;
  	}
  
  	// 暴露接口用于测试
  	window.Ajax = ajax;
  
  	/**
  	 *
  	 * 通过创建script 标签并且加载解析其内容完成跨域的请求操作
  	 * @param {Object} settings			设置选项
  	 * @param {Function} settings.beforeSend	发送前的操作
  	 * @param {Boolean} settings.cache			是否会需要添加随机字串在后面从而不缓存，默认true
  	 * @param {Function} settings.complete		结束之后的调用，在success || error 后面
  	 * @param {Object|String} settings.data		需要发送过去的内容，可以是对象也可以是字符串
  	 * @param {Function} settings.fail			失败之后的执行操作
  	 * @param {Object} settings.headers			header 里的内容设置
  	 * @param {Function} settings.success		成功之后的回调（data，status，xhr）
  	 * @param {Number} settings.timeout			超时时间
  	 * @param {String} settings.url				需要发送的地址，默认相对当前地址
  	 * @param {String} settings.jsonp			在一个JSONP请求中重写回调函数的名字。这个值用来替代在"callback=?"这种GET或POST请求中URL参数里的"callback"部分
  	 * @param {String} settings.jsonpCallback	为jsonp 指定一个特定的返回执行操作
  	 *
  	 */
  	function funcJsonp(settings) {
  		var script = document.createElement('script'), header = document.getElementsByTagName('header')[0] || document.documentElement,
  			url = settings.url, sdata = funcJsonp.getPresendData(settings.data),
  			curTime = +new Date(),
  			onLoadedKey, isNeedLoadedFunc, isBreak, handler;
  
  		onLoadedKey = 'jsonpcall_' + curTime + '_' + Math.floor(Math.random() * 1000);
  		sdata = funcJsonp.filterKeyCallback(settings.jsonp, settings.jsonpCallback, onLoadedKey, sdata, function(_isNeedLoadedFunc) {
  			isNeedLoadedFunc = _isNeedLoadedFunc;
  		});
  		// 不缓存
  		if (settings.cache === false) {
  			sdata._ = curTime;
  		}
  		if (typeof settings.timeout === 'number') {
  			handler = setTimeout(function() {
  				isBreak = true;
  				settings.fail && settings.fail(script, settings);
  				settings.complete && settings.complete(script, settings);
  			}, settings.timeout);
  		}
  		var receiveData;
  		// 如果是用的我们自己的已经存在的函数
  		if (isNeedLoadedFunc) {
  			window[onLoadedKey] = function(data) {
  				clearTimeout(handler);
  				receiveData = data;
  				settings.success && settings.success(data, script, settings);
  				settings.complete && settings.complete(script, settings);
  				delete window[onLoadedKey];
  			};
  		}
  		// 如果在beforeSend 里直接就阻止了, 我们就不往下进行了.
  		if (settings.beforeSend && settings.beforeSend(script) === false) {
  			return script;
  		};
  		url = rc.pages.dataJoinUrl(url, sdata);
  		script.src = url;
  		script.crossorigin = 'crossorigin';
  		script.type = 'text/javascript';
  		// 加载完成的时候window[onLoadedKey]那段代码自然会执行，所以不需要去额外处理了。
  		script.onerror = function() {
  			if (isBreak) { return;}
  			isBreak = true;
  			clearTimeout(handler);
  			settings.fail && settings.fail(script, {});
  			settings.complete && settings.complete(script);
  		};
  		header.appendChild(script);
  		return script;
  		//settings.beforeSend
  	}
  
  	/**
  	 * funcJsonp 的私有方法，用于获得一个预备发送的数据
  	 * @param {Object} data 需要去转化的数据
  	 */
  	funcJsonp.getPresendData = function(data) {
  		if (typeof data === 'object') {
  			return data;
  		} else if (typeof data === 'string') {
  			return rc.pages.getQueriesObject(data);
  		} else {
  			return {};
  		}
  	};
  
  	/**
  	 * funcJsonp 的私有方法，用于过滤掉callback 的key 或者索引的value
  	 * @param {String} jsonp			在执行函数里对应的执行方法的key，如 xx= 代替了 callback=
  	 * @param {String} jsonpCallback	在执行函数里对应的执行方法的方法名, 如 xx=dd
  	 * @param {String} onLoadedKey	在执行函数里对应的执行方法的方法名, 如 xx=dd
  	 * @param {Object} sdata			当前已经存在的数据集合
  	 * @param {Function} checkNeedLoadedFunc	回调判断是否需要使用系统自己的函数名
  	 */
  	funcJsonp.filterKeyCallback = function(jsonp, jsonpCallback, onLoadedKey, sdata, checkNeedLoadedFunc) {
  		if (jsonp) {
  			if (sdata.callback) {
  				if (jsonpCallback) {
  					sdata[jsonp] = jsonpCallback;
  				}
  				delete sdata.callback;
  			} else {
  				sdata[jsonp] = jsonpCallback || onLoadedKey;
  				checkNeedLoadedFunc && checkNeedLoadedFunc(sdata[jsonp] === onLoadedKey);
  			}
  		} else {
  			if (sdata.callback && jsonpCallback) {
  				sdata.callback = jsonpCallback;
  			} else {
  				sdata.callback = jsonpCallback || onLoadedKey;
  				checkNeedLoadedFunc && checkNeedLoadedFunc(sdata.callback === onLoadedKey);
  			}
  		}
  		return sdata;
  	};
  
  	/**
  	 * 获得一个 xhr 对象
  	 * @return {Object} xhr				返回一个xhr 对象
  	 */
  	function getXhr() {
  		var xhr, xhrList, i, ni;
  		try {
  			xhr = new XMLHttpRequest();
  		} catch(e) {
  			xhrList = ["Msxml3.XMLHTTP", "Msxml2.XMLHTTP", "Microsoft.XMLHTTP"];
  			for (i = 0,ni = xhrList.length; i < ni; i++) {
  				try {
  					xhr = new ActiveXObject(xhrList[i]);
  				} catch(e) {continue;}
  			}
  		}
  		return xhr;
  	}
  
  	//SERVER_CALL 将单一化功能，可以订阅派送
  
  
  	// 封装 ajax 的数据传递
  	/**
  	 *  ajax 呼起服务器内容的方法
  	 * @param {Object} data			需要传递的数据
  	 * @param {String} requestAddr	请求地址
  	 * @param {String} dataType		json/xml/txt
  	 * @param {String} method			方法,get/post
  	 * @param {Function} callback	成功回调
  	 * @param {Function} fail		失败回调
  	 * @param {Object} headers		头信息
  	 * @param {Boolean} isSync		是否同步
  	 * @param {Number} timeout		过期时间
  	 */
  	function ajaxCall(data, requestAddr, dataType, method, callback, fail, headers, isSync, timeout) {
  		if (!data || !requestAddr) {
  			return;
  		}
  		var isComplete, params = {
  				dataType: dataType || 'json',
  				type: method || 'get',
  				success: function(sd) {
  					var _d;
  					if (params.dataType == 'json') {
  						if (typeof sd === 'object') {
  							_d = sd;
  						} else {
  							_d = rc.util.jsonParse(sd);
  						}
  
  						// ajax 里我们只接受我们自己的格式
  						if (!_d) {
  							conf.isSuccess = false;
  							conf.result = 'format error';
  							conf.endTime = new Date();
  							fail && fail(_d, conf);
  							isComplete = true;
  							return;
  						}
  						// 100 表示我们的成功
  						if (/^1(\d{2})?$/.test(_d.result)) {
  							callback && callback(_d);
  						} else {
  							conf.isSuccess = false;
  							conf.result = 'api result not 100';
  							conf.endTime = new Date();
  							fail && fail(_d, conf);
  						}
  						isComplete = true;
  						return;
  					}
  					// 字符串 或者 xml
  					_d = sd;
  					if (!_d) {
  						conf.isSuccess = false;
  						conf.result = 'no content';
  						conf.endTime = new Date();
  						fail && fail(_d, conf);
  						isComplete = true;
  						return;
  					}
  					callback && callback(_d);
  				},
  				fail: function(xhr) {
  					//_d.readyState === 0, 表示我们abort 掉的
  					try{
  						xhr.status  //abort掉的时候 xhr.status ie8下报错（未指明错误）
  					}catch(e){
  						isComplete = true;
  						return;
  					}
  					if (!xhr.readyState || !xhr.status) {
  						isComplete = true;
  						return;
  					}
  					conf.isSuccess = false;
  					conf.result = 'ajax error';
  					conf.endTime = new Date();
  					isComplete = true;
  					fail && fail(xhr, conf);
  				},
  				complete: function(xhr) {
  					// 已经完成过的，我们不在做处理了
  					if (isComplete || !xhr.readyState) {
  						return;
  					}
  					var sd;
  					if (params.type == 'json') {
  						sd = rc.util.jsonParse(xhr.responseText);
  					} else {
  						sd = xhr.responseText;
  					}
  					conf.isSuccess = false;
  					conf.result = 'not match any code';
  					conf.endTime = new Date();
  					fail && fail(xhr, conf);
  				},
  				async: !isSync
  		}, conf = {
  			requestAddr: requestAddr,
  			requestData: data,
  			method: params.type,
  			dataType: params.dataType,
  			startTime: new Date()
  		};
  		if (params.type === 'get') {
  			params.url = rc.pages.dataJoinUrl(requestAddr, data || '');
  		} else {
  			params.url = requestAddr;
  			params.data = data;
  		}
  		if (headers && typeof headers === 'object') {
  			params.headers = headers;
  		}
  		return ajax(params);
  	}
  
  	/**
  	 *  ajax 呼起服务器内容的方法
  	 * @param {Object} data			需要传递的数据
  	 * @param {String} requestAddr	请求地址
  	 * @param {Function} callback	成功回调
  	 * @param {Function} fail		失败回调
  	 * @param {Number} timeout		过期时间
  	 */
  	function jsonpCall(data, requestAddr, callback, fail, timeout) {
  		var params = {
  			dataType: 'jsonp',
  			success: function(data) {
  				callback && callback(data);
  			},
  			error: function(xhr) {
  				// 默认如果存在，则有可能timeout
  				fail && fail(xhr, {
  					isSuccess: false,
  					result: 'timeout',
  					requestAddr: requestAddr,
  					requestData: data
  				});
  			}
  		};
  		if (data.callback) {
  			params.callback = data.callback;
  			delete data.callback;
  		}
  		if (data.jsonpCallback) {
  			params.jsonpCallback = data.jsonpCallback;
  			delete data.callback;
  		}
  		if (timeout) {
  			params.timeout = timeout;
  		}
  		params.data = data;
  		return ajax(params);
  	}
  
  	/**
  	 * @param {Object} data			需要传递的数据
  	 * @param {String} requestAddr	请求地址
  	 * @param {String} method		方法,get/post
  	 * @param {Function} callback	成功回调
  	 * @param {Number} timeout		过期时间
  	 *
  	 */
  	function formSend(data, requestAddr, method, callback, timeout) {
  		if (!data || !requestAddr) {
  			return;
  		}
  		var ifr = document.createElement('iframe'), ifrDoc, handler, isEnd, conf;
  		ifr.style.cssText = 'display: none;';
  		document.body.appendChild(ifr);
  		ifrDoc = ifr.contentDocument;
  		ifr.onload = function() {
  			isEnd = true;
  			conf.endTime = new Date();
  			conf.isSuccess = true;
  			conf.result = 'postEnd';
  			callback && callback(conf);
  			document.body.removeChild(ifr);
  			ifr = null;
  		};
  		if (timeout) {
  			handler = setTimeout(function() {
  				if (isEnd) {return;}
  				conf.endTime = new Date();
  				conf.isSuccess = false;
  				conf.result = 'timeout';
  				callback && callback(conf);
  				document.body.removeChild(ifr);
  				ifr = null;
  			}, timeout);
  		}
  		var form = document.createElement('form'), texA, i;
  		form.method = method || 'post';
  		form.action = requestAddr;
  		for (i in data) {
  			// 使用 textarea 可以获得更完善的内容
  			texA = document.createElement('textarea');
  			texA.name = i;
  			texA.value = data[i];
  			form.appendChild(texA);
  		}
  		ifrDoc.body.appendChild(form);
  		form.submit();
  		conf = {
  			requestAddr: requestAddr,
  			requestData: data,
  			method: method,
  			startTime: new Date()
  		};
  	}
  
  	/**
  	 * 通过img 来发起的get 请求
  	 * @param {Object} data			需要传递的数据
  	 * @param {String} requestAddr	请求地址
  	 * @param {Function} callback	成功回调
  	 * @param {Number} timeout		过期时间
  	 *
  	 */
  	function httpGetByImg(data, requestAddr, callback, timeout) {
  		if (!data || !requestAddr) {
  			return;
  		}
  		var img = new Image(), i, sArr = [], src, handler, isEnd, conf;
  		for (i in data) {
  			sArr.push(i + '=' + data[i]);
  		}
  		src = requestAddr + (sArr.length ? (/\?/.test(requestAddr) ? '&' : '?') + sArr.join('&') : '');
  		if (timeout) {
  			handler = setTimeout(function() {
  				if (isEnd) {return;}
  				conf.endTime = new Date();
  				conf.isSuccess = false;
  				conf.result = 'timeout';
  				callback && callback(conf);
  				img = null;
  			}, timeout);
  		}
  		conf = {
  			requestAddr: requestAddr,
  			requestData: data,
  			method: 'get',
  			startTime: new Date()
  		};
  		img.onload = function() {
  			isEnd = true;
  			conf.endTime = new Date();
  			conf.isSuccess = true;
  			conf.result = 'postEnd';
  			callback && callback(conf);
  			img = null;
  		};
  		img.onerror = function() {
  			isEnd = true;
  			conf.endTime = new Date();
  			conf.isSuccess = false;
  			conf.result = 'load image error';
  			callback && callback(conf);
  			img = null;
  		};
  		img.src = src;
  	}
  
  	var request = {
  		_apiList: {},
  		_reqList: {},
  
  		// 来自于其他第三方的访问模式
  		_plugins: {},
  		// 过期时间
  		_sysTimeout: 20,
  
  		/**
  		 *  获得response 返回的key
           * @private
  		 * @param {Object} conf			来自于请求的参数
  		 */
  		_getResponsePubKey: function(conf) {
  			var pubKey = 'SERVER.REQUEST_RESPONSE';
  			switch(conf.comefrom) {
  				case 'MODULES': pubKey += '.MODULES'; break;
  				case 'CONTROLS': pubKey += '.CONTROLS'; break;
  				default:
  				case 'OTHERS': pubKey += '.OTHERS'; break;
  			}
  			return pubKey;
  		},
  
  		/**
  		 *  在请求成功之后, 发起一个请求, 或者直接执行他的成功事件
           * @private
  		 * @param {Object} conf			来自于请求的参数
  		 * @param {Object} api			api 的属性
  		 */
  		_getApiSuccess: function(conf, api) {
  			var that = this;
  			return function(data) {
  				// 完成之后删除操作
  				delete that._reqList[conf.reqKey];
  				// 如果是直接处理返回值
  				if (conf.isForceResponse) {
  					conf.success && conf.success.call(conf.context || rc.request, data);
  					return;
  				}
  				conf.response = data;
  				conf.status = 'success';
  				rc.pub(that._getResponsePubKey(conf), conf);
  			};
  		},
  
  		/**
  		 *  在请求失败之后, 发起一个请求, 或者直接执行他的失败事件
           * @private
  		 * @param {Object} conf			来自于请求的参数
  		 * @param {Object} api			api 的属性
  		 */
  		_getApiError: function(conf, api) {
  			var that = this;
  			return function(originObject, errorConf) {
  				// 派发给全局的错误接受器
  				rc.pub('ERROR.REQUEST_API', {
  					originObject: originObject,
  					errorConf: errorConf
  				});
  				// 完成之后删除操作
  				delete that._reqList[conf.reqKey];
  				if (conf.isForceResponse) {
  					conf.error && conf.error.call(conf.context || rc.request, errorConf, originObject);
  					return;
  				}
  				conf.response = originObject;
  				conf.errorConf = errorConf;
  				conf.status = 'fail';
  				rc.pub(that._getResponsePubKey(conf), conf);
  			};
  		},
  
  		/**
  		 *  获得具体的呼起api 的方法操作
           * @private
  		 * @param {Object} conf												来自于请求的参数
  		 * @param {String} conf.api,											api 名字
           * @param {String} conf.mdulName								模块名字
           * @param {String} conf.reqKey reqKey							由模块名, api，与时间戳构成的一个临时唯一值
           * @param {String} conf.act											'request', 请求动作
  		 * @param {Object} conf.params			  						发出的请求
  		 * @param {Boolean} conf.formDatabase						是否来自于本地的缓存
  		 * @param {Object} conf.props										请求的基本参数
  		 */
  		_getApiMethod: function(conf) {
  			var apiObject = this.getAPIParams(conf);
  			if (!apiObject) {
  				// 只能够从我们的既定api 列表里去做查询
  				// 可能会需要做处理回退回去, 不然会仍然保留在队列中
  				return;
  			}
  			// 内部api 调用
  			var callback, params = conf.params || {}, i;
  			// 合并我们所需要提交的参数
  			if (apiObject.params !== undefined) {
  				for (i in apiObject.params) {
  					// 如果已经存在了数据，以后面的数据为主
  					if (params[i] === undefined) {
  						params[i] = apiObject.params[i];
  					}
  				}
  			}
  			if (apiObject.server === 'rc') {
  				if (apiObject.dataType === 'jsonp') {
  					this._reqList[conf.reqKey] = jsonpCall(params, apiObject.url, this._getApiSuccess(conf, apiObject), this._getApiError(conf, apiObject), apiObject.timeout || this._sysTimeout);
  				} else {
  					//ajax
  					this._reqList[conf.reqKey] = ajaxCall(params, apiObject.url, apiObject.dataType, apiObject.method, this._getApiSuccess(conf, apiObject), this._getApiError(conf, apiObject), apiObject.headers || this._headers, apiObject.isSync, apiObject.timeout || this._sysTimeout);
  				}
  			} else if (this._plugins[apiObject.server]){
  				this._reqList[conf.reqKey] = this._plugins[apiObject.server](apiObject.cmd, params, apiObject.method, this._getApiSuccess(conf, apiObject), this._getApiError(conf, apiObject));
  			}
  		},
  
  		/**
           * @private
  		 * @param {Object} conf			  来自于请求的参数
  		 * @param {String} conf.api,											api 名字
           * @param {String} conf.mdulName								模块名字
           * @param {String} conf.reqKey reqKey							由模块名, api，与时间戳构成的一个临时唯一值
           * @param {String} conf.act											'request', 请求动作
  		 * @param {Object} conf.params			  						发出的请求
  		 * @param {Boolean} conf.formDatabase						是否来自于本地的缓存
  		 * @param {Object} conf.props										请求的基本参数
  		 */
  		_requestAPI: function(conf) {
  			var reqCall;
  			switch(conf.act) {
  				case 'request':
  					// 检查是否需要从本地获取数据或者其他操作
  					this._getApiMethod(conf);
  					break;
  				case 'abort':
  					// 我们主动abort 掉了请求
  					reqCall = this._reqList[conf.reqKey];
  					if (reqCall) {
  						reqCall.abort && reqCall.abort();
  						delete this._reqList[conf.reqKey];
  					}
  					break;
  			}
  		},
  
  		/**
  		 *  通过api 的名字去获得API 的基本的属性结构
  		 * @param {String} apiName		api 的名字
  		 */
  		getAPIParams: function(apiName) {
  			return this._apiList[apiName] || null;
  		},
  
  		/**
  		 * 	 直接发起某种请求
           * @private
  		 *
  		 * @param {Object} conf		请求的短传递
  		 * @param conf.method
  		 * @param conf.data
  		 * @param {String}          conf.dataType     jsonp, img, form, ajax, plugin
  		 * @param {String}          conf.requestAddr
  		 * @param {Function}        conf.callback     [jsonp, img, form 专有]
  		 * @param {String}          conf.success      [ajax, plugin 所有]
  		 * @param {Object}          conf.error        [ajax, plugin 所有]
  		 * @param {Number}          conf.timeout
  		 * @param {String}          conf.server       [plugin 所有]
  		 */
  		_requestReq: function(conf) {
  			switch(conf.dataType) {
  				case 'jsonp':
  					jsonpCall(conf.data, conf.requestAddr, conf.callback, conf.callback, conf.timeout);
  					break;
  				case 'img':
  					httpGetByImg(conf.data, conf.requestAddr, conf.callback, conf.timeout);
  					break;
  				case 'form':
  					formSend(conf.data, conf.requestAddr, conf.method, conf.callback, conf.timeout);
  					break;
  				case 'json':
  					ajaxCall(conf.data, conf.requestAddr, conf.dataType, conf.method, conf.success || conf.callback, conf.error || conf.callback, conf.headers || this._headers, conf.isSync, conf.timeout || this._sysTimeout);
  					break;
  				case 'plugin':
  					this._plugins && this._plugins[conf.server] && this._plugins[conf.server](conf.cmd, params, conf.method, conf.success || conf.callback, conf.error || conf.callback);
  					break;
  			}
  		},
  
  		/**
  		 *  框架加载完成之后的任务执行队列
           * @private
  		 * @param {Array} orders		执行队列
  		 */
  		_afterInit: function(orders) {
  			var i = 0, ni = orders.length, it;
  			for (; i < ni; i++) {
  				it = orders[i];
  				if (it.key !== 'SERVER') {
  					continue;
  				}
  				rc.pub(orders[i].act, orders[i].value || null);
  			}
  		},
  
  		/**
  		 *
  		 *  强制直接呼起 api call
  		 * @param {Object} conf		传递的数据
  		 * @param {Object} context	传递的数据
  		 */
  		forceAPICall: function(conf, success, fail, context) {
  			var params = rc.util.deepClone(conf);
  			params.success = success;
  			params.error = fail;
  			// 产生一个随机的参数
  			params.reqKey = 'forceRequest::' + conf.api + '::' + (+new Date()) + '::' + Math.floor(Math.random() * 100);;
  			params.act = 'request';
  			params.context = context;
  			params.isForceResponse = true;
  			this._getApiMethod(params);
  		},
  
  		/**
  		 *
  		 * 	 不通过事件派发而直接发起某个请求
  		 * @param {Object}conf		请求的短传递
  		 * @param {String} conf.method
  		 * @param {Object} conf.data
  		 * @param {String} conf.dataType		jsonp, img, form, ajax, plugin
  		 * @param {String} conf.requestAddr
  		 * @param {Function} conf.callback [jsonp, img, form 专有]
  		 * @param {Function} conf.callback.success [ajax, plugin 所有]
  		 * @param {Funcion} conf.callback.error [ajax, plugin 所有]
  		 * @param {Number} conf.timeout
  		 * @param {String} conf.server [plugin 所有]
  		 */
  		forceCall: function(conf, success, fail) {
  			var params = rc.util.deepClone(conf);
  			params.success = success;
  			params.error = fail;
  			params.callback = success;
  			this._requestReq(params);
  		},
  
  		/**
  		 * @param {Object} conf			初始化serverCall 时的配置方法
  		 * @param {Object} conf.plugins		
  		 * @param {Number} conf.timeout		
  		 * @param {Object} conf.apiList		
  		 * @param {Object} conf.headers		 默认的头文件
  		 */
  		init: function(conf) {
  			// 后续所有的其他接口呼起方式，都通过plugin 来做调用
  			var plugins;
  			if (conf && conf.plugins) {
  				plugins = conf.plugins;
  				if (plugins.request) {
  					this._plugins = plugins.request;
  				}
  				if (plugins.reqHeaders) {
  					this._headers = plugins.reqHeaders;
  				}
  			}
  			if (conf && conf.timeout) {
  				this._sysTimeout = conf.timeout;
  			}
  			this._apiList = conf && conf.apiList ? conf.apiList : {};
  			// 一次调用, 初始化
  			rc.sub('TATAMI.FEATURESTART', this._afterInit, this, true);
  			rc.sub('SERVER.REQUEST_SEND', this._requestAPI, this);
  			rc.sub('SERVER.REQUEST_REQ', this._requestReq, this);
  		}
  	};
  
  	rc.request = request;
  })(window.Tatami, window.jQuery);
  ;
  /**
   * @depend Tatami.events, Tatami.util, Tatami.pages
   * @class
   * @author Jerrod
   */
  (function(rc) {
  	
  	if (!rc) {
  		window.Tatami = rc = {};
  	}
  	
  	/**
       * @class modules.Module
  	 * @param {Object} config
  	 * @param {String} name					 模块名称, 必须存在且唯一
  	 * @param {String} depend   			 [可选] 模块依赖的父模块, 如为空则表示他是祖模块
  	 * @param {String} type  				 [可选] 模块的类别, 暂时有 basic 可选. basic 表示该模块是整个业务的基本的模块, 一开始就存在并且不会被销毁
  	 *  									 normal 		普通类别，为空则为普通类别
  	 *  									 sub			子类别，某个模块下的子模块
  	 *  									 basic		静态模块
  	 * @param {String} viewName       		 [可选] view 件的名字
  	 * @param {Function} init       		 [可选] 初始化模块. 所有的模块在加载的时候就会被初始化. 特别对于basic 来说, 他是唯一会被启用的入口
  	 * @param {Function} activation 		 [可选] 第一次初始化时执行的相应的操作，（如果type＝＝basic，则其实他和init 方法类似，他会在init方法之后执行），否则，会在那个模块的第一次update之前执行
  	 * @param {Function} disabled 			 [可选] 模块被隐藏(未销毁)时出发的函数, (销毁时也会调用该函数先), 与之相对的是 update
  	 * @param {Function} update   			 [可选] 模块被触发时发出的函数(包括模块自身的更改)
  	 * @param {Function} destroy  			 [可选] 模块被销毁时调用的函数
  	 * @param {Function} wakeup				 [可选] 模块从disabled状态再次update时的第一次的动作
  	 * @param {Object} events     			 [可选] 模块订阅的事件集合. 该订阅的事件, 会在模块销毁时解绑.
  	 * @param {Object} methodsMap 			 [可选] 所有的可操作方法集合都会放到这个里面来
  	 * @param {Object} dataMap    			 [可选] 所有的可获得的数据集合都会放到这个里面来
  	 * @param {Object} statusMap  			 [可选] 所有的可获得的状态集合都会放到这个里面来
  	 * @param {Object} ctrlsMap   			 [可选] 所有的放置组件模块的列表
  	 * @param {Boolean} hasDepence			 [可选] 是否对于上一级有依赖
       *
  	 * ============= 以下为新增的部分
       * @param {Object} reqList  			 [暂忽略] [请求的api的列表, 由key 和 value ('api 名字') 来对应], 这样的用意是, 后续会限制模块对于不同api的调用权限.
  	 * 操作内容
  	 * @param {Function} isMdulActive   	 [可选] 替代 is_mdul_active 用的函数, 方法源一致, 但是会和新的init, ready 等区分使用, 状态识别更多. 
  	 * @param {Function} isMdulInited   	 [可选] 该模块是否被初始化
  	 * @param {Function} isMdulActivate 	 [可选] 重要，区别 isMdulActive 和 init，该判断表示该模块第一次正式的被初始化（因为basic和normal模块的初始化进程是不一样的） 
  	 * @param {Object} view       			 [可选] 与该模块绑定的view 的实例.
       * @param {Function} request 			 [可选] 通过	request 去调用api, 这个里面将会去做容错 和 是否需要判定模块是否激活等处理.
  	 * @param {Function} pages				 [可选] 引入pages 的可选操作类别，减少用户去pages里查寻api以及api变化之后出现的问题
  	 * @param {Function} getMethods			 [可选] 获得私有方法
  	 * @param {Function} getMdulData		 [可选] 获得私有对象
  	 * @param {Function} setMdulData		 [可选] 设置私有对象
  	 * @param {Function} getStatus			 [可选] 获得私有状态
  	 * @param {Function} setStatus			 [可选] 设置私有状态
  	 * @param {Function} getCtrl			 [可选] 获得ctrl 组件
  	 * 			
  	 */
  	function Module(config) {
  		// 预留cofing 做备份
  		this.config = config;
  		
  		this.name = config.name;
  		this.depend = config.depend || '';
  		this.type = config.type || '';
  		this.hasDepence = !!config.hasDepence;
  		
  		// 视图模块正式成为可使用区域
  		this.viewName = config.viewName || '';
  		
  		// view 下的模块
  		this._vid = 'view.' + this.name;
  		
  		// 初始化时可执行的操作
  		this._isInit = false;
  		
  		// 是否处于初始化启动状态
  		this._isActivate = false;
  		
  		// 模块是否处于被激活状态
  		this._isMdulActive = false;
  		
  		// 来自config 里的初始化函数
  		this.init = config.init || function() {};
  		// 来自config 的初始化之后的相应操作
  		this.activation = config.activation || function() {};
  		// 来自config 里的更新函数 (被激活并且被响应时)
  		this.update = config.update || function() {};
  		// 来自config 里的销毁函数
  		this.destroy = config.destroy || function() {};
  		// 来自config 里的被disabled 时触发的函数
  		this.disabled = config.disabled || function() {};
  		// 从disabled状态再次被唤醒时的操作
  		this.wakeup = config.wakeup || function() {};
  		
  		
  		// methods 的列表
  		this.methodsMap = config.methodsMap || {};
  		// dataMap 的列表
  		this.dataMap = config.dataMap || {};
  		// 备份之前的data
  		this._dataMap = {};
  		// status 的列表
  		this.statusMap = config.statusMap || {};
  		// 备份到之前的status
  		this._statusMap = {};
  		// ctrls 的列表
  		this.ctrlsMap = config.ctrlsMap || {};
  		// 用于收集来自与 controls 的组件
  		this._ctrlsMap = {};
  		
  		// 模块的事件集合
  		this.events = config.events || {};
  		
  		// 单体view 的引用
  		this.view = null;
  		
  		// 发送的请求列表
  		this._requestList = {};
  		this._requestIndex = 0;
  
          // 实例化logs
          this.logs = new rc.logs.Logs({
              name: this.name      
          });
  	}
  	
  	Module.prototype = {
  		
  		/**
  		 *  获得本地的缓存数据
  		 * @param{String}key		键值
  		 * @param{String}type		类别 session/storage，默认storage
  		 * @return {Object | Boolean}				返回请求的对象
  		 */
  		getLocalData: function(key, type) {
  			return rc.localcache.get(key, type);
  		},
  		
  		/**
  		 *  设置本地的缓存数据
  		 * @param{String}key		键值
  		 * @param{Object}value		值
  		 * @param{String}type		类别 session/storage，默认storage
  		 * @return {Object | Boolean}	返回设置之后的对象
  		 */
  		setLocalData: function(key, value, type) {
  			return rc.localcache.set(key, value, type);
  		},
  		
  		// 在页面初始化之前完成view的调用，如果有的情况下
  		/**
           * 在展示业务承载页面之前先将页面渲染完成
           * @private
  		 * @param {Object} hashs 当前的解析自url的hash对象
  		 */
  		_beforeActivation: function(hashs) {
  			// 前提需要是提供view 的name，用于做传递
  			var data = hashs || {};
  			if (this.viewName) {
  				data.mdulName = this.name;
  				this.view = rc.views.get(this.viewName);
  				this.view.render(data, this.viewName);
  			}
  		},
  		
  		/**
           * 在完成页面的承载之后执行的其他操作
           * @private
  		 * @param {Object} hashs 当前的解析自url的hash对象
  		 */
  		_afterActivation: function(hashs) {
  			rc.pub(this.name + '.MDUL_ACTIVED', true);
  		},
  		
  		/**
  		 *  module 模块的第一初始化操作，他会在update， init里都得到响应
  		 * @param {Object} hashs			当前的解析自url的hash对象
  		 */
  		funcInit: function(hashs) {
  			if (this._isActivate) {
  				return;
  			}
  			// 针对 basic 的初始化情况，一次性会将所有的初始化操作都执行完成。
  			if (this.type === 'basic') {
  				this._isInit = true;
  				this.init(hashs);
  				this._beforeActivation(hashs);
  				this._subEventsAct(true);
  				this._ctrlsBindAct(true);
  				this._restoreMdul(true);
  				this._afterActivation(hashs);
  				this._isActivate = true;
  				this._isMdulActive = true;
  				this.activation(hashs);
  				this.wakeup(hashs);
  				return;
  			}
  			// 针对普通都情况，执行两步操作，第一步，完成init操作。
  			if (!this._isInit) {
  				this._isInit = true;
  				this.init(hashs);
  				this._subEventsAct(true);
  				this._ctrlsBindAct(true);
  				this._restoreMdul(true);
  				return;
  			}
  			// 第二步，当他被update时，再次触发该操作
  			if (!this._isActivate) {
  				this._beforeActivation(hashs);
  				this._afterActivation(hashs);
  				this._isActivate = true;
  				this.activation(hashs);
  			}
  		},
  		
  		/**
  		 *  我们会在destroy 的时候给重置之前所有的选项, 私有操作不理会
           * @private
  		 * @param {Boolean} isBind			是否重新计算需要处理的数据对象
  		 */
  		_restoreMdul: function(isBind) {
  			var i, reg = /^\P\:/;
  			if (isBind) {
  				for (i in this.dataMap) {
  					if (!reg.test(i)) {
  						this._dataMap[i] = rc.util.deepClone(this.dataMap[i]);
  					}
  				}
  				for (i in this.statusMap) {
  					if (!reg.test(i)) {
  						this._statusMap[i] = !!this.statusMap[i];
  					}
  				}
  				return;
  			}
  			// 如果是destroy，则还原非私有的所有对象
  			for (i in this._dataMap) {
  				this.dataMap[i] = rc.util.deepClone(this._dataMap[i]);
  			}
  			for (i in this._statusMap) {
  				this.statusMap[i] = !!this._statusMap[i];
  			}
  		},
  		
  		/**
  		 *  监听/移除 本模块的sub 队列
           * @private
  		 * @param {Boolean} isBind			是否绑定全局监听事件
  		 */
  		_subEventsAct: function(isBind) {
  			var events = this.events, i;
  			if (!events) {
  				return;
  			}
  			var mdulName = this.name, key, act = isBind ? 'sub' : 'removeSub';
  			for (i in events) {
  				// >>xxxx 表示缩写，再绑定的时候会自动的将前面的内容替换成该模块名
  				key = /^\>\>/.test(i) ? mdulName + i.replace(/^\>\>/, '.') : i;
  				rc[act](key, events[i], this);
  			}
  			rc[act]('MODULES.RESPONSE_RECEIVER.' + this.name, this.response, this);
  		},
  		
  		/**
  		 *  初始化组件, 对于非ctrl 的不做处理，因为不知道是否下次还会用得到
           * @private
  		 * @param {Boolean} isBind			是否绑定组件监听
  		 */
  		_ctrlsBindAct: function(isBind) {
  			var i, ctrls = this.ctrlsMap, 
  				_ctrls = this._ctrlsMap, rcc = rc.controls;
  			if (isBind) {
  				for (i in ctrls) {
  					if (typeof ctrls[i] === 'string') {
  						this._ctrlsMap[i] = rcc.get(ctrls[i], this.name);
  					}
  				}
  			} else {
  				for (i in _ctrls) {
  					_ctrls[i].funcDestroy && _ctrls[i].funcDestroy();
  					delete _ctrls[i];
  				}
  				this._ctrlsMap = {};
  			}
  			
  		},
  		
  		
  		/**
  		 * 模块是否被激活
  		 * @return {Boolean} isMdulActive		状态
  		 */
  		isMdulActive: function() {
  			return this._isMdulActive;
  		},
  		
  		/**
  		 * 该模块是否被初始化
  		 * @return {Boolean} isInited				状态
  		 */
  		isMdulInited: function() {
  			return this._isInit;
  		},
  		
  		/**
  		 * 重要，区别 isMdulActive 和 init，该判断表示该模块第一次正式的被初始化（因为basic和normal模块的初始化进程是不一样的）
  		 * @return {Boolean} isActivate				状态
  		 */
  		isMdulActivate: function() {
  			return this._isActivate;
  		},
  		
  		
  		/**
           * getMethod 方法的兄弟篇，修改了必须要组装成数组才能够传递的方式
  		 * @param {String} name  所要选择的返回参数名
  		 * @return {Function} func	获得一个方法
  		 */
  		getMethod: function(name) {
  			var args = [].slice.call(arguments, 1);
  			return this._getFuncFromMap('methodsMap', name, args);
  		},
  		
  		/**
  		 *  获得mdul的数据对象里的值
  		 * @param {String} name  mdul对象里的类名
  		 * @return {Object} data	获得mdul里的对象
  		 */
  		getMdulData: function(name) {
  			return this._getMdulProp('dataMap', name);
  		},
  		
  		/**
  		 *  设置mdul的数据对象里的值，并且返回
  		 * @param {String} name   mdul对象里的类名
  		 * @param {String} key	  mdul对象里的key值
  		 * @param {Object} value  mdul对象里的值
  		 * @return {Boolean} isSuccess			是否设置成功
  		 */
  		setMdulData: function(name, key, value) {
  			var args = arguments, oldData;
  			if (args.length === 2) {
  				return this._setMdulProp('dataMap', name, args[1]);
  			} else if (args.length === 3) {
  				oldData = this.getMdulData(name);
  				if (typeof oldData === 'object' && oldData[key]) {
  					oldData[key] = value;
  					return this._setMdulProp('dataMap', name, oldData);
  				}
  				return false;
  			}
  			return false;
  		},
  		
  		/**
  		 *  获得mdul的状态对象里的值
  		 * @param {String} name  mdul对象里的类名
  		 * @return {Boolean} isTrue		获得状态
  		 */
  		getStatus: function(name) {
  			return this._getMdulProp('statusMap', name);
  		},
  		
  		/**
  		 *  设置mdul的状态对象里的值，并且返回
  		 * @param {String} name   mdul对象里的类名
  		 * @param {Object} value  mdul对象里的值
  		 * @return {Boolean} isDone	是否设置成功
  		 */
  		setStatus: function(name, value) {
  			return this._setMdulProp('statusMap', name, value);
  		},
  		
  		/**
  		 *  获得mdul 对象里相应的name 下的值.
           * @private
  		 * @param {String} type  所选择的类别
  		 * @param {String} name  所要选择的返回参数名
  		 * @return {Object | Number | String} obj		获得当前的属性值
  		 */
  		_getMdulProp: function(type, name) {
  			if (!this[type] || this[type][name] === undefined) {
  				return false;
  			}
  			return this[type][name];
  		},
  		
  		/**
  		 *  mdul 对象里相应的name 下的值，并且返回
           * @private
  		 * @param {String} type  所选择的类别
  		 * @param {String} name  所要选择的返回参数名
  		 * @param {Object | Boolean} value		所需要设置的值
  		 * @return {Boolean} isDone	是否设置成功
  		 */
  		_setMdulProp: function(type, name, value) {
  			if (value === undefined || !this[type] || this[type][name] === undefined || (type === 'statusMap' && typeof value !== 'boolean')) {
  				return false;
  			}
  			this[type][name] = value;
  			return true;
  		},
  		
  		/**
  		 *  返回该ctrl 实例
  		 * @param {String} name  所要ctrl名
  		 * 			[String] method 需要传递的control 的方法名
  		 * 			[Arugments] args 会传递过去的参数
  		 * @return {Function | Boolean} obj			获得当前ctrl
  		 */
  		getCtrl: function(name, method, args) {
  			var args2;
  			if (arguments.length === 1) {
  				return this._ctrlsMap[name] || this.ctrlsMap[name];
  			} else if (arguments.length >= 2) {
  				// this._ctrlsMap[name]
  				if (this._ctrlsMap[name]) {
  					args2 = [].slice.call(arguments, 1);
  					return this._ctrlsMap[name].getMethod.apply(this._ctrlsMap[name], args2);
  				}
  				return this.ctrlsMap[name][method] ? 
  					this.ctrlsMap[name][method].apply(this.ctrlsMap[name], [].slice.call(arguments, 2)) : false;
  			}
  			return false;
  		},
  		
  		/**
  		 *  传入一个 args, 然后返回一个值.
           * @private
  		 * @param {String} type  所选择的类别
  		 * @param {String} name  所要选择的返回参数名
  		 * @param {Array} args		所需要返回的args 的数组
  		 * @return {Function | Boolean} obj			从mapping 里获得方法或者null
  		 */
  		_getFuncFromMap: function(type, name, args) {
  			var map = this[type];
  			if (!map) {
  				return;
  			}
  			var fn = map[name];
  			if (!fn) {
  				return;
  			}
  			return fn.apply(this, args);
  		},
  		
  		
  		/**
  		 * 
  		 *  当接收到模块状态发生改变时，触发该事件
  		 * @param {Object} hashs			当前的解析自url的hash对象
  		 * @param {Boolean} isUpdatedBySelf		当被激活之后的回调，是否是由于自己引起
  		 * @param {Function} next						当存在依赖关系时, 必须要执行 next 操作才能够前往下一步
  		 */
  		funcUpdate: function(hashs, isUpdatedBySelf, next) {
  			this.funcInit(hashs);
  			if (!this._isMdulActive) {
  				this.wakeup(hashs, isUpdatedBySelf);
  			}
  			this._isMdulActive = true;
  			this.update(hashs, isUpdatedBySelf, next);
  			this.type !== 'sub' && this.displayView(true);
  			rc.pub(this.name + '.MDUL_ACTIVED', true);
  		},
  		
  		/**
  		 * 引入pages 的暴露接口功能可以让用户减少对于外部的引用，返回一个方法集合, 具体的方法类别请查找pages.pagesInterface
  		 */
  		pages: rc.pages.pagesInterface(),
  		
  		
  		// 当模块被禁用时触发
  		/**
  		 *  当有很多模块一起被禁止时，可以根据此确定是由于谁引起的禁止动作
  		 * @param{Boolean} isDisabledBySelf		是否是自己引起的禁止
  		 */
  		funcDisabled: function(hashs, isDisabledBySelf) {
  			this._isMdulActive = false;
  			this.disabled(!!isDisabledBySelf);
  			// sub 模块不会被做隐藏处理，因为他会跟进父级的隐藏
  			this.type !== 'sub' && this.displayView(false);
  			rc.pub(this.name + '.MDUL_ACTIVED', false);
  		},
  		
  		// 当模块被销毁时触发
  		/**
  		 *  当有很多模块一起被销毁时，可以根据此确定是由于谁引起的销毁动作
  		 * @param{Boolean} isDestroiedBySelf		是否是自己引起的销毁
  		 */
  		funcDestroy: function(hashs, isDestroiedBySelf) {
  			// 先执行 disabled 操作
  			this.funcDisabled(!!isDestroiedBySelf);
  			this.abortAllRequest();
  			this.view && this.view.funcDestroy && this.view.funcDestroy();
  			this.view = null;
  			this._subEventsAct(false);
  			this._ctrlsBindAct(false);
  			this._restoreMdul(false);
  			this._isInit = false;
  			this._isActivate = false;
  			this.destroy(!!isDestroiedBySelf);
  		},
  		
  		/**
  		 * 更新视图的操作
  		 * 该操作的实参为可选值。
  		 *  module 将通过这个方法去更新视图
  		 * @param {String} methodName				视图的方法名
  		 * @param {Array} args								该方法的实参
  		 */
  		updateView: function(methodName, args) {
  			if (!arguments.length || !this.view) {
  				return;
  			}
  			this.view.update.apply(this.view, [].slice.call(arguments));
  		},
  		
  		/**
  		 * 
  		 *  控制所属该module的view 模块的显示隐藏
  		 * @param {Boolean} isShow			是否显示view 的父级
  		 */
  		displayView: function(isShow) {
  			if (!this.view || !this.view.show || !this.view.hide) {
  				return;
  			}
  			this.view[isShow ? 'show' : 'hide']();
  		},
  		
  		/**
  		 * 
  		 * 成功/失败 后都回调都上下文，都将指向module 本身，方便里面的this 调用。
  		 * 通过module 发起一个请求。
  		 * @param {Object} options			需要请求的api的参数
  		 * @param {String} options.api							api 的名字
  		 * @param {Object} options.params							[可选] api 的属性
  		 * @param {String} options.loadingText						[可选] 如果存在, 则也会显示loading tip 并且带有内容
  		 * @param {String} options.successText						[可选] 如果存在, 则也会显示success tip 并且带有内容
  		 * @param {String} options.errorText							[可选] 如果存在, 则也会显示error tip 并且带有内容
  		 * @param {Boolean} options.isHideLoading					[可选] 是否显示loading tip，默认 false
  		 * @param {Boolean} options.isHideSuccess					[可选] 是否显示success tip，默认 false
  		 * @param {Boolean} options.isHideError					[可选] 是否显示error tip，默认 false
  		 * @param {Boolean} options.isWholeTime					[可选] 是否必须在module active状态执行，默认 false
  		 * @param {Boolean} options.isKeepAlone					[可选] 是否选的api name唯一性（即类似page切换，同api会自动的abort掉上一次掉请求，而只关注本次），默认false
  		 * 		
  		 * @param {Function} success		请求成功后的回调
  		 * @param {Function} fail			请求失败后的回调
  		 * 
  		 */
  		request: function(options, success, fail) {
  			if (!this._isInit) {return;}
  			// 每次发起请求，都会以时间戳＋apiname＋modulname 构成一个唯一值。
  			var i, reqList = this._requestList,
  				mdulName = this.name,
  				api = options.api;
  			
  			var reqAPI = reqList[api], reqKey = mdulName + '::' + api + '::' + (+new Date()) + '::' + (this._requestIndex ++);
  			
  			// 请求队列是接收到，就会删除的。
  			if (!reqAPI) {
  				reqAPI = reqList[api] = {
  					isKeepAlone: !!options.isKeepAlone,
  					isWholeTime: !!options.isWholeTime,
  					reqList: {} // 该api 下访问的所有请求都会在这里体现
  				};
  				
  				reqAPI.reqList[reqKey] = {
  					isHideLoading: options.isHideLoading,
  					isHideSuccess: options.isHideSuccess,
  					isHideError: options.isHideError,
  					loadingText: options.loadingText,
  					successText: options.successText,
  					errorText: options.errorText,
  					success: success,
  					fail: fail
  				};
  				// 如果该api请求是独占的，则我们预留一个接口字段用于获取该api的引用
  				if (reqAPI.isKeepAlone) {
  					reqAPI.aloneAPI = reqKey;
  				}
  			} else {
  				// 如果该api是独占的，第一件事情就是需要将上一次的请求abort掉, 并且修改特性
  				if (reqAPI.aloneAPI) {
  					// 发送请求干掉上一次的
  					rc.pub('MODULES.REQUEST_SEND', {
  						api: api,
  						mdulName: mdulName,
  						reqKey: reqAPI.aloneAPI,
  						act: 'abort'
  					});
  					// 更新 reqKey
  					reqAPI.aloneAPI = reqKey;
  					reqAPI.reqList = {};
  				}
  				reqAPI.reqList[reqKey] = {
  					isHideLoading: options.isHideLoading,
  					isHideSuccess: options.isHideSuccess,
  					isHideError: options.isHideError,
  					loadingText: options.loadingText,
  					successText: options.successText,
  					errorText: options.errorText,
  					success: success,
  					fail: fail
  				};
  			}
  			// 弹出遮罩层
  			if (!reqAPI.reqList[reqKey].isHideLoading || reqAPI.reqList[reqKey].loadingText) {
  				rc.pub('NOTI.SHOWLOADING', reqAPI.reqList[reqKey].loadingText || '');
  			}
  			rc.pub('MODULES.REQUEST_SEND', {
  				api: api,
  				mdulName: mdulName,
  				reqKey: reqKey,
  				act: 'request',
  				params: options.params
  			});
  		},
  		
  		
  		// 当我们destroy 该模块的时候，应该将所有该模块还在发起当请求也给abort 掉。
  		abortAllRequest: function() {
  			var i, reqList = this._requestList, j, it,
  				mdulName = this.name;
  			for (i in reqList) {
  				// 如果是全占的, 不删除
  				if (!reqList[i] || reqList[i].isWholeTime) {
  					continue;
  				}
  				for (j in reqList[i].reqList) {
  					rc.pub('MODULES.REQUEST_SEND', {
  						api: i,
  						mdulName: mdulName,
  						reqKey: j,
  						act: 'abort'
  					});
  					delete reqList[i].reqList[j];
  				}
  				delete reqList[i];
  			}
  		},
  		
  		/**
  		 *  通过module 管理器直接操作的			
  		 * @param {Object} params			返回响应的操作
  		 * @param {String} params.api					请求的api 的名字
  		 * @param {String} params.reqKey				由模块名, api，与时间戳构成的一个临时唯一值
  		 * @param {String} params.ctrlName			模块名
  		 * @param {String} params.status				状态，有success, fail
  		 * @param {Object} params.response			返回的结果
  		 */
  		response: function(params) {
  			// 阻止掉下面不会被触发的事件
  			if (!this._requestList[params.api]) {
  				return false;
  			}
  			var reqList = this._requestList,
  				reqApi = reqList[params.api],
  				reqOne = reqApi.reqList[params.reqKey],
  				isWholeTime = reqApi.isWholeTime,
  				that = this, i, ni = 0,
  				funcComplete = isWholeTime ? function(func) {
  						func && func.apply(that, [].slice.call(arguments, 1));
  					} : function(func) {
  						if (that.isMdulActive()) {
  							func && func.apply(that, [].slice.call(arguments, 1));
  						}
  					};
  			switch(params.status) {
  				case 'success':
  					if(!reqOne.isHideLoading){
  						rc.pub('NOTI.CLEARSHOW');
  					}
  					if (!reqOne.isHideSuccess || reqOne.successText) {
  						rc.pub('NOTI.SHOWSUCCESS', reqOne.successText || '');
  					}
  					funcComplete(reqOne.success, params.response);
  					break;
  				case 'fail':
  					if(!reqOne.isHideLoading){
  						rc.pub('NOTI.CLEARSHOW');
  					}
  					if (!reqOne.isHideError || reqOne.errorText) {
  						rc.pub('NOTI.SHOWFAIL', reqOne.errorText || params);
  					}
  					funcComplete(reqOne.fail, params.response, params);
  					break;	
  			}
  			// 得到请求回馈后，删除之前的请求链
  			delete reqApi.reqList[params.reqKey];
  			for (i in reqApi.reqList) {
  				ni++;
  			}
  			if (!ni) {
  				// 如果整条都空了，则删除整条api的请求
  				delete reqList[params.api];
  			}
  		},
  	};
  	
      /**
       *
       * @class modules
       */
  	rc.modules = {
  		
  		// 模块本地存储的区域
  		_mdulList: {},
  		// 异步加载模块 Map表
  		_asyncMdulMap:{},
  		// 来自于module模块发出的请求
  		_requestList: {},
  		
  		/**
  		 * 
  		 *  定义模块，并且返回一个模块。
  		 * @param {Object} conf		模块的配置
  		 */
  		define: function(conf) {
  			if (this._mdulList[conf.name]) {
  				return false;
  			}
  			return this._mdulList[conf.name] = new Module(conf);
  		},
  		
  		/**
  		 * 
  		 *  加载一个模块
  		 * 	注：当加载的是父模块/祖模块时，他所属的下面的子模块也会被加载
  		 * @param {Object} params			通过事件派发过来的属性集合
  		 * @return {Object} instance			获得一个module 的实例
  		 */
  		loadMdul: function(params) {
  			params = params || {};
  			return this._loadMdul(params.mdulName, params.hashs, params.callback);
  		},
  		
  		/**
  		 * 
  		 *  加载一个模块
  		 * 	注：当加载的是父模块/祖模块时，他所属的下面的子模块也会被加载
           * @private
  		 * @param {String} mdulName			模块名
  		 * @param {Object} hashs			当前路径解析成的hash对象
  		 * @param {Function} callback		加载完成后执行的回调
  		 * @param {Boolean} isSingleLoad	是否单体加载 
  		 */
  		_loadMdul: function(mdulName, hashs, callback, isSingleLoad) {
  			// 没有则立马执行回调
  			if (!mdulName) {
  				// 201 模块加载失败
  				rc.pub('ERROR.MODULES', {result: 201});
  				return;
  			}
  			var i, mlist = this._mdulList, o, arr = [];
  			
  			// 如果是单个模块单独加载
  			if (isSingleLoad) {
  				for (i in mlist) {
  					o = mlist[i];
  					if (o.name === mdulName) {
  						o.funcInit(hashs);
  						callback && callback();
  						return o;
  					}
  				}
  				// 201 模块加载失败
  				rc.pub('ERROR.MODULES', {result: 201});
  				return false;
  			}
  			this._getMdulOrderByDown(mdulName, function(mdul) {
  				arr.push(mdul);
  			}, true);
  			var ni = arr.length;
  			if (!ni) {
  				// 201 模块加载失败
  				rc.pub('ERROR.MODULES', {result: 201});
  				return;
  			}
  			for (i = 0; i < ni; i++) {
  				o = arr[i];
  				o.funcInit(hashs);
  			}
  			callback && callback();
  		},
  		
  		/**
  		 * 
   		 *  获得某个模块
   		 * @param {String} mdulName				模块名
   		 * @return {Object} mdul						模块实例
  		 */
  		getMdul: function(mdulName) {
  			return this._mdulList[mdulName] || false;
  		},
  		
  		
  		
  		/**
  		 * 	正向的去查询自我起，往下查模块，并且返回操作
  		 * 	我－》子模块－》孙子模块－》重孙模块 。。。
           * @private
  		 * @param {String} mdulName				模块名
  		 * @param {Function} callback			找到后执行的回调
  		 * 					回调里有两个实参
  		 * 						mdul				传递该模块
  		 * 						isSelf				是否最初传入的模块
  		 * @param {Boolean} isFristLoop			是否第一次执行
  		 * 
  		 */
  		_getMdulOrderByDown: function(mdulName, callback, isFristLoop) {
  			var i, mdulList = this._mdulList,
  				curMdul = this.getMdul(mdulName);
  			if (!curMdul) {
  				return false;
  			}
  			// 第一时间执行自己的回调，然后再往下递归
  			isFristLoop && callback && callback(curMdul, true);
  			
  			for (i in mdulList) {
  				mdul = mdulList[i];
  				if (!mdul || mdul === curMdul) {
  					continue;
  				}
  				
  				if (mdul.depend === mdulName) {
  					callback && callback(mdul);
  					this._getMdulOrderByDown(mdul.name, callback);
  				}
  			}
  		},
  		
  		/**
  		 * 	反向的去查询自我起，往上查模块，并且返回操作
  		 * 	我－》父模块－》爷模块－》祖模块 。。。
           * @private
  		 * @param {String} mdulName				模块名
  		 * @param {Function} callback			找到后执行的回调
  		 * 					回调里有两个实参
  		 * 						mdul				传递该模块
  		 * 						isSelf				是否最初传入的模块
  		 * 
  		 */
  		_getMdulOrderByUp: function(mdulName, callback) {
  			var curMdul = this.getMdul(mdulName);
  			if (!curMdul) {
  				return false;
  			}
  			// 无依赖则到此结束
  			if (!curMdul.depend) {
  				callback && callback(curMdul, true);
  				return false;
  			}
  			var updateList = [curMdul];
  			// 向上回溯依赖
  			while (curMdul.depend !== '' && curMdul) {
  				curMdul = this.getMdul(curMdul.depend);
  				if (!curMdul) {
  					break;
  				}
  				updateList.push(curMdul);
  				//callback && callback(curMdul);
  			}
  			// update 应该是从父级往当前递归
  			var i = updateList.length - 1, ni = 0;
  			for (; i >= ni; i--) {
  				callback && callback(updateList[i], i === ni);
  			}
  		},
  		
  		/**
  		 * 
  		 * 读取一个root 的mdul，并且切换它下面active module
  		 * @param {Object} params			通过订阅事件获得的参数处理
  		 * @param {String} params.prevRoot	上一个需要销毁的模块名(root)
  		 * @param {String} params.curRoot		本次需要加载的模块名(root)
  		 * @param {String} params.curMdul	本地需要更新的模块名(mdul)
  		 * @param {String} params.prevMdul	上次需要隐藏的模块名(mdul)
  		 * @param {String} params.url				当前的url地址
  		 * @param {Object} params.hashs				当前的hashs对象
  		 */
  		rootMdulLoad: function(params) {
  			var that = this, hashs = params.hashs, url = params.url,
  				funcAct = function() {
  					that.loadMdul({mdulName: params.curRoot, hashs: hashs});
  					that.updateMdul({mdulName: params.curMdul, hashs: hashs, prevMdul: params.prevMdul, url: url}, function() {
  						that.destroyMdul({mdulName: params.prevRoot, hashs: hashs});
  					});
  				}, root_url;
  			// 如果暂时还没在目前得list 里，则需要加载
  			if (!this.getMdul(params.curMdul) && this._asyncMdulMap) {
  				// 先去请求获得资源，然后再去处理destroy等操作
  				// FIXME 暂时还没处理，待合并
                  root_url = this._asyncMdulMap[params.curRoot];
                  
                  if(!root_url){
                      // 200 模块不存在
                      rc.pub('ERROR.MODULES', {result: 200});
                      rc.pub('PAGES.GOBACK', -1);
                      return;
                  } 
                  
  				rc.load.require(root_url, function() {
  					funcAct();
  				});
  				return;
  			}
  			// 已经在list 里了，则需要处理些其他
  			funcAct();
  		},
  		
  		/**
  		 * 
  		 * 同一个root下的mdul做切换时需要
  		 * @param {Object} params			通过订阅事件获得的参数处理
  		 * @param {String} params.curMdul	本地需要更新的模块名(mdul)
  		 * @param {String} params.prevMdul	上次需要隐藏的模块名(mdul)
  		 * @param {String} params.url				当前的url地址
  		 * @param {Object} params.hashs				当前的hashs对象
  		 */
  		switchMdul: function(params) {
  			var that = this, hashs = params.hashs;
  			this.updateMdul({
  				mdulName: params.curMdul,
  				hashs: hashs
  			}, function() {
  				// false 说明不需要做切换
  				params.nPrevKey && that.disabledMdul({
  					mdulName: params.nPrevKey,
  					hashs: hashs
  				});
  			});
  		},
  		
  		
  		/**
   		 *  激活该模块，并且递归激活该模块的父级／祖父等模块（依照depend关系）
  		 * 
   		 * @param {Object} params				通过订阅事件得到的参数处理
   		 * @param {String} params.mdulName			模块名
   		 * @param {Object} params.hashs				当前解析对应的hash对象
   		 * @param {Function} callback			一个执行回调
  		 */
  		updateMdul: function(params, callback) {
  			var mdulName = params.mdulName,
  				hashs = params.hashs;
  			if (!this.getMdul(mdulName)) {
  				// 200 模块不存在
  				rc.pub('ERROR.MODULES', {result: 200});
  				rc.pub('PAGES.GOBACK', -1);
  				return;
  			}
  			var arr = [], hasDepence, next, it, ni, isDepenceRoot, that = this, prevMdulObj;
  			// 这里在循环一次是为了看当前的mdul的变化是否会有需要依赖的关系在
  			this._getMdulOrderByUp(mdulName, function(mdul, isSelf) {
  				if (mdul.hasDepence) {
  					hasDepence = true;
  					if (prevMdulObj) {
  						prevMdulObj.beDepence = true;
  					}
  				}
  				arr.push(prevMdulObj = {
  					mdulName: mdul.name,
  					isSelf: isSelf
  				});
  				//mdul.funcUpdate(hashs, isSelf);
  			});
  			if (hasDepence) {
  				next = function() {
  					if (!arr.length) {
  						callback && callback();
  						rc.pub('MODULES.MODULE_READY', params);
  						return;
  					}
  					it = arr.shift();
  					if (it.beDepence) {
  						that.getMdul(it.mdulName).funcUpdate(hashs, it.isSelf, next);
  					} else {
  						that.getMdul(it.mdulName).funcUpdate(hashs, it.isSelf);
  						next();
  					}
  				};
  				next();
  			} else {
  				callback && callback();
  				rc.util.map(arr, function(it, idx) {
  					// 直接放mdul 的话，会引起上下文的改变，实例改变
  					this.getMdul(it.mdulName).funcUpdate(hashs, it.isSelf);
  				}, this);
  				// 广播当前模块已经就绪的消息
  				rc.pub('MODULES.MODULE_READY', params);
  			}
  		},
  		
  		/**
   		 *  禁止该模块，并且递归禁止该模块的子级／孙子级等模块（依照depend关系）
  		 * 
   		 * @param {Object} params				通过订阅事件得到的参数处理
   		 * @param {String} params.mdulName			模块名
   		 * @param {Object} params.hashs				当前解析对应的hash对象
  		 */
  		disabledMdul: function(params) {
  			var mdulName = params.mdulName,
  				hashs = params.hashs,
  				arr = [];
  			this._getMdulOrderByDown(mdulName, function(mdul, isSelf) {
  				arr.push(mdul);
  			}, true);
  			var i = arr.length, mdul;
  			for (; i >= 0; i--) {
  				mdul = arr[i];
  				mdul && mdul.funcDisabled && mdul.funcDisabled(hashs, !i);
  			}
  		},
  		
  		/**
   		 *  销毁该模块，并且递归销毁该模块的子级／孙子级等模块（依照depend关系）
  		 * 
   		 * @param {Object} params				通过订阅事件得到的参数处理
   		 * @param {String} params.mdulName			模块名
   		 * @param {Object} params.hashs				当前解析对应的hash对象
  		 */
  		destroyMdul: function(params) {
  			var mdulName = params.mdulName,
  				hashs = params.hashs,
  				arr = [];
  			this._getMdulOrderByDown(mdulName, function(mdul, isSelf) {
  				arr.push(mdul);
  			}, true);
  			var i = arr.length, mdul;
  			for (; i >= 0; i--) {
  				mdul = arr[i];
  				mdul && mdul.funcDestroy && mdul.funcDestroy(hashs, !i);
  			}
  		},
  		
  		/**
   		 *  由模块内部发起的api请求或者其他请求
  		 * 
   		 * @param {Object} params						通过订阅事件得到的参数处理
   		 * @param {String} params.api: api,					api 名字
  		 * @param {String} params.mdulName: mdulName, 		模块名字
  		 * @param {String} params.reqKey: reqKey,				由模块名, api，与时间戳构成的一个临时唯一值
  		 * @param {String} params.act: 'request',				请求动作
  		 */
  		request: function(params) {
  			// 模块管理器不需要去考虑太多特别因素（如请求队列），只需要执行这一队列即可
  			params.comefrom = 'MODULES';
  			switch(params.act) {
  				case 'request':
  					this._requestList[params.reqKey] = params;
  					rc.pub('SERVER.REQUEST_SEND', params);
  					break;
  				case 'abort':
  					rc.pub('SERVER.REQUEST_SEND', params);
  					delete this._requestList[params.reqKey];
  					break;	
  			}
  		},
  		
  		/**
   		 *  管理器接收到到来自请求目的地的结束请求
  		 * 
   		 * @param {Object} params				通过订阅事件得到的参数处理
   		 * @param {String} params.api					请求的api 的名字
   		 * @param {String} params.reqKey				由模块名, api，与时间戳构成的一个临时唯一值
   		 * @param {String} params.ctrlName			模块名
   		 * @param {String} params.status				状态，有success, fail
   		 * @param {Object} params.response			返回的结果
  		 */
  		response: function(params) {
  			if (!params || !params.mdulName) {
  				return;
  			}
  			rc.pub('MODULES.RESPONSE_RECEIVER.' + params.mdulName, params);
  			delete this._requestList[params.reqKey];
  		},
  		
  		
  		/**
   		 *  初始化所有已经define的模块
  		 * 
           * @private
   		 * @param {Object} params				初始化模块功能块的基本参数
  		 */
  		_initModules: function(params) {
  			var i, ml = this._mdulList, mdul;
  			// 可空置
  			params = params || {};
  			for (i in ml) {
  				mdul = ml[i];
  				// 无依赖的 basic 模块在一开始就被初始化
  				if (mdul.type === 'basic' && !mdul.depend) {
  					mdul.funcInit(params.hashs);
  				}
  			}
  		},
  		
  		/**
           * @private
  		 * @param{Object} order		执行操作
  		 */
  		_afterInit: function(order) {
  			this[order.act] && this[order.act](order.value);
  		},
  		
  		
  		/**
  		 * 
   		 *  初始化模块管理器
   		 * @param {Object} conf				初始化模块功能块的基本参数
  		 */
  		init: function(conf) {
  			rc.sub('MODULES.LOAD', this.loadMdul, this);
  			rc.sub('MODULES.UPDATE', this.updateMdul, this);
  			rc.sub('MODULES.DISABLED', this.disabledMdul, this);
  			rc.sub('MODULES.DESTROY', this.destroyMdul, this);
  			rc.sub('MODULES.REQUEST_SEND', this.request, this);
  			rc.sub('MODULES.ROOTLOAD', this.rootMdulLoad, this);
  			rc.sub('MODULES.SWITCHMDUL', this.switchMdul, this);
  			rc.sub('SERVER.REQUEST_RESPONSE.MODULES', this.response, this);
  			rc.sub('TATAMI.FEATURESTART.MODULES', this._afterInit, this, true);
  			rc.pub('TATAMI.FEATUREREADY', {key: 'MODULES', act: '_initModules', value: conf});
  			// 缓存route里边url
  			if (!conf || !conf.route || !conf.route.cp_list) return;
  			var name, item;
  			for (name in conf.route.cp_list) {
  				item = conf.route.cp_list[name];
  				if (item.url) {
  					this._asyncMdulMap[name] = item.url;
  				}
  			}
  		}
  	};
  	
  	;(function(){
      Module.prototype.request2 = Module.prototype.request;
      Module.prototype.request = function(options, success, fail){
                  var self = this;
                  options.dataType = options.dataType||'json';
                  options.method = options.method||'get';
                  options.__module_name = this.name;
                  var success_proxy = function(){
                          success&&success.apply(self,arguments);
                      };
                  var fail_proxy = function(){
                          fail&&fail.apply(self,arguments);
                      };
                  if(rc.dofilter){
                      rc.dofilter(options, success_proxy, fail_proxy ,function(opts, success, fail){
                          if(options.method.toLowerCase()==='post'){
                              options.requestAddr = options.api;
                              options.data = options.params||{};
                              Tatami.request.forceCall(options, success, fail);
                              return;
                          }
                          self.request2(opts, success,fail );
                      });
                  }else{
                      if(options.method.toLowerCase()==='post'){
                          options.requestAddr = options.api;
                          options.data = options.params||{};
                          Tatami.request.forceCall(options, success, fail);
                          return;
                      }
                      this.request2(options, success_proxy, fail_proxy);
                  }
              }
      // Tatami.request._getApiMethod2=Tatami.request._getApiMethod;
      // Tatami.request._getApiMethod=function(params) {
      //     params.url = params.api.toString();
      //     params.api = {
      //         api:params.api,
      //         method:params.method,
      //         dataType:params.dataType,
      //         server:params.server,
      //         isSync:params.isSync,
      //         timeout:params.timeout
      //     }
      //     this._getApiMethod2(params);
      // }
      Tatami.request.getAPIParams= function(conf) {
                  var apiObject = {};
                  apiObject.url = conf.api;
                  apiObject.method = conf.method||'get';
                  apiObject.dataType = conf.dataType||'json';
                  apiObject.server = conf.server||'rc';
                  apiObject.isSync = !!conf.isSync;
                  apiObject.timeout = conf.timeout;
                  return apiObject;
              }
  })();;
  })(window.Tatami);
  ;
  /**
   * @class
   * @depend Tatami.events, Tatami.util, Tatami.pages
   */
  ;(function(rc) {
  
  	/**
  	 * =========================================
  	 * view 功能块是依赖于module功能块的存在. 主要的作用是用于承接
  	 * 	在视图里的任何dom操作.
  	 * 	他是无依赖的. 内部有一个私有的简单选择器模(也支持querySelectAll 这样浏览器带有的) 块用于对于dom 元素的
  	 * 事件绑定.
  	 * 			他只可与他相关的module 通信而不可与其他模块/视图通信.
  	 * 			他只可接受来自于module 的消息.
  	 * 			他只可被他相关的module 创建/销毁.
  	 * 	所有的关于视图的操作都只能够在他的里面进行
  	 * =========================================
  	 */
  
  	rc = rc || {};
  
  	var rce = rc.events;
  	// views 毕竟还是得和 template 有所结合的
  
  	// Easily-parseable/retrievable ID or TAG or CLASS selectors
  	var rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
  		attrExpr = /\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,
  		classCache = {};
  
  	/**
  	 sizzle的简单版，不支持伪类、属性选择器
  	  selector createBy 张谱
  
  	 */
  	function SimpleSizzle(selector, context, results) {
  		context = context || document;
  		//预留接口
  		results = results || [];
  		if ( typeof selector != "string") {
  			console.error("传入的参数只能是字符串");
  			return typeof selector === 'object' ? selector : document.body;
  		}
  		var s = selector.split(/\s+/), len = s.length, i = len - 1;
  		for (; i >= 0; i--) {
  			if (i == len - 1) {
  				results = getLastSelectorResult(s[i], context);
  			} else {
  				results = filterResult(s[i], results);
  			}
  		}
  		return results;
  	}
  
  	function getLastSelectorResult(selector, context) {
  		var m, match, elem, attribute, results = [], els, i, len, SPACE, el, t;
  
  		var _value, type, value, ieAttrFix, condition;
  		if ( match = rquickExpr.exec(selector)) {
  			if (( m = match[1])) {
  				if (( elem = context.getElementById(m))) {
  					if (elem.id === m) {
  						results.push(elem);
  						return results;
  					}
  				} else {
  					return results;
  				}
  			} else if (match[2]) {
  				els = context.getElementsByTagName(selector);
  				i = 0;
  				len = els.length;
  				for (; i < len; i++) {
  					results.push(els[i]);
  				}
  				return results;
  			} else if ( m = match[3]) {
  				//目前暂不支持tag.cls这种形式
  				els = context.getElementsByTagName("*");
  				SPACE = ' ';
  				i = 0;
  				len = els.length;
  				cls = SPACE + m + SPACE;
  				for (; i < len; ++i) {
  					el = els[i];
  					t = el.className;
  					if (t && (SPACE + t + SPACE).indexOf(cls) > -1) {
  						results.push(el);
  					}
  				}
  				return results;
  			}
  		} else if ( match = attrExpr.exec(selector)) {
  			//context = document.body; //
  			if ( attribute = match[1]) {
  				els = context.getElementsByTagName("*");
  				i = 0;
  				len = els.length;
  				type = match[2];
  				value = match[4];
  				ieAttrFix = {
  					"class" : "className",
  					"for" : "htmlFor"
  				};
  
  				if (!+"\v1") {
  					attribute = ieAttrFix[attribute] ? ieAttrFix[attribute] : attribute;
  				}
  				for (; i < len; ++i) {
  					el = els[i];
  					_value = !+"\v1" ? el[attribute] : el.getAttribute(attribute);
  
  					if ( typeof _value === "string" && _value.length > 0) {
  						if (!!value) {
  							condition = type === "=" ? //完全等于
  							_value === value : type === "!=" ? //不等于
  							_value != value : type === "*=" ? //包含
  							_value.indexOf(value) >= 0 : type === "~=" ? //匹配当中的某个单词，如<span class="red bold">警告</span>
  							(" " + _value + " ").indexOf(value) >= 0 : type === "^=" ? //以XX开头
  							_value.indexOf(value) === 0 : type === "$=" ? //以XX结尾
  							_value.slice(-value.length) === value : type === "|=" ? //匹配属性值为XX或以XX-打头的元素
  							_value === value || _value.substring(0, value.length + 1) === value + "-" : false;
  							condition && results.push(el);
  						} else {
  							results.push(el);
  						}
  					}
  				}
  				return results;
  			}
  		}
  	}
  
  	function filterResult(selector, results) {
  		var m, match, newResults = [], i, len, parent, flag;
  		if ( match = rquickExpr.exec(selector)) {
  			if (( m = match[1])) {
  				i = 0;
  				len = results.length;
  				for (; i < len; i++) {
  					parent = results[i].parentNode;
  					while (parent) {
  						if (parent.id == m) {
  							newResults.push(results[i]);
  							break;
  						}
  						parent = parent.parentNode;
  					}
  				}
  			} else if (match[2]) {
  				i = 0;
  				len = results.length;
  				for (; i < len; i++) {
  					parent = results[i].parentNode;
  					while (parent) {
  						if (parent.tagName.toLowerCase() == selector.toLowerCase()) {
  							newResults.push(results[i]);
  							break;
  						}
  						parent = parent.parentNode;
  					}
  				}
  			} else if ( m = match[3]) {
  				i = 0;
  				len = results.length;
  				for (; i < len; i++) {
  					parent = results[i].parentNode;
  					while (parent) {
  						flag = classRE(m).test(parent.className);
  						if (flag) {
  							newResults.push(results[i]);
  							break;
  						}
  						parent = parent.parentNode;
  					}
  				}
  			}
  		}
  		return newResults;
  	}
  
  	function classRE(name) {
  		return name in classCache ? classCache[name] : (classCache[name] = new RegExp('(^|\\s)' + name + '(\\s|$)'));
  	}
  
  
  
  	/**
  	 *
  	 * 	view 的构造器. 用于构造一个管理view 视图的管理器.
  	 * @param {Object} config
  	 * @param config.name {String} * 			视图的名称
  	 * @param config.tempName {String} * 			[可选] 视图的引用的模板函数名
  	 * @param config.updateMap {HashMaping} * 			用于更新视图
  	 * @param config.getResultMap {HashMapping} * 			返回一个可以操作视图的函数
  	 * @param config.renderFn {Function} * 			初始化视图操作
  	 * @param config.destroyFn {Function} * 			销毁视图
  	 * @param config.events {HashMaping} * 			视图绑定 dom 元素
  	 * @param config.triggers {HashMapping} * 			视图sub的事件，被触发
  	 * @param config.mdulType {String} * 			视图的所属的类别，为空表示为module，否则会加上mdulType 为前缀用于事件绑定
  	 *
  	 *
  	 */
  
  	function View(config) {
  		this.config = config;
  		this.name = config.name;
  		this.tempName = config.tempName;
  		this.container = config.container || document.body;
  		this.rootNode = null;
  		this._hasRender = false;
  		this._uid = (config.mdulType ? config.mdulType + '.' : '') + this.name.replace(/^view\./, '');
  
  		// update不同的名称对应的function map
  		this.updateMap = config.updateMap || {};
  
  		// ctrls 的一个列表
  		this.ctrlsMap = config.ctrlsMap || {};
  		// 用于收集来自与 controls 的组件
  		this._ctrlsMap = {};
  
  		// methods 的列表
  		this.methodsMap = config.methodsMap || {};
  
  		// 需要获得内容的操作列表.
  		this.getResultMap = config.getResultMap || {};
  
  		// 初始化的接口，通常是对rootNode元素进行赋值
  		this.renderFn = config.renderFn || function() {};
  		this._hasRenderFn = !! config.renderFn;
  
  		// 提供一个给用户使用的init 接口，不必要占用renderFn 里的操作
  		this.init = config.init || function() {};
  
  		// destroy 的时候的方法
  		this.destroy = config.destroy || function() {};
  
  		// 用户给绑定的事件集合
  		this.events = config.events || {};
  
  		// 用户需要views监听的事件
  		this.triggers = config.triggers || {};
  
  		// dom 的绑定事件，解绑时使用
  		this._domEvts = {};
  
  		// 用于事件之间的绑定等
  		this._mdulName = null;
  
          // 实例化logs
          this.logs = new rc.logs.Logs({
              name: this.name
          });
  
  	}
  
  
  	View.prototype = {
  
  		/**
  		 *  获得本地的缓存数据
  		 * @param{String}key		键值
  		 * @param{String}type		类别 session/storage，默认storage
  		 */
  		getLocalData: function(key, type) {
  			return rc.localcache.get(key, type);
  		},
  
  		/**
  		 *  设置本地的缓存数据
  		 * @param{String}key		键值
  		 * @param{Object}value		值
  		 * @param{String}type		类别 session/storage，默认storage
  		 */
  		setLocalData: function(key, value, type) {
  			return rc.localcache.set(key, value, type);
  		},
  
  		/**
  		 *  没有renderFn 的情况下，我们自己加入一套
  		 * @param {Object} data 传递进来的更新内容
  		 * @param {String} hashs 对应的当前的hash值
  		 */
  		_noRenderFn: function(data, hashs) {
  			// 存在tempName, 并且我们默认 template 里有 main 方法
  			var html, div = document.createElement('div');
  			if (this.tempName && rc.template) {
  				this.ctrlsMap['temp'] = rc.template.getTempFuncs(this.tempName);
  				html = this.getCtrl('temp').getMain(data, hashs);
  				div.innerHTML = html;
  				this.rootNode = div.children[0];
  			} else {
  				this.rootNode = div;
  			}
  			this.container.appendChild(this.rootNode);
  			return this.rootNode;
  		},
  
  		/**
  		 *  默认如果有template 存在，我们需要和template 对接起来
  		 *  初始化渲染
  		 * @param {Object} data 传递进来的更新内容
  		 * @param {String} hashs 对应的当前的hash值
  		 */
  		render : function(data, hashs) {
  			// ctrlsMap 需要事先放入引入的文件
  			if (!this._hasRender) {
  				// 如果会传入父节点容器, 我们从父节点里去寻找内容
  				if (data.viewContainer) {
  					this.container = (this._qSelector(this.container, data.viewContainer))[0];
  				} else if (typeof this.container === 'string') {
  					// 选择获得的是数组，我们取第一个
  					this.container = (this._qSelector(this.container))[0];
  				}
  				// 我们不在需要用户构建 renderFn了，我们将在此实现该部分
  				if (!this._hasRenderFn) {
  					this.rootNode = this._noRenderFn(data, hashs);
  				} else {
  					this.rootNode = this.renderFn(data, hashs);
  				}
  
  				if (data) {
  					// 当我们传输进去的module 有依赖的时候，我们应该修改他的 pub 的指定
  					if (data.mdulDepend) {
  						this._uid = data.mdulDepend;
  					}
  
  					// 传递过来的业务载体模块的名字
  					if (data.mdulName) {
  						this._mdulName = data.mdulName;
  					}
  				}
  				//dom事件绑定
  				this._eventBind();
  				this.init(data, hashs);
  			}
  			this._hasRender = true;
  		},
  
          /**
           * 获得当前的节点对象
           */
  		getContainer: function() {
  			return this.rootNode;
  		},
  
          /**
           *
           * 显示该view 层.
           */
  		show: function() {
  			return this._funcDisplay(true);
  		},
  
          /**
           * 隐藏该view 层.
           */
  		hide: function() {
  			return this._funcDisplay(false);
  		},
  
  		/**
  		 *  控制 view 层的显示隐藏
  		 * @param {Boolean} isShow 是否显示
  		 */
  		_funcDisplay: function(isShow) {
  			if (this.rootNode) {
  				this.rootNode.style.display = isShow ? '' : 'none';
  			}
  		},
  
  		_qSelector: document.querySelectorAll ? function(selector, context) {
  			return (context || this.rootNode || document.body)['querySelectorAll'](selector);
  		} : function(selector, context) {
  			return this.__querySelectorAll(selector, context || this.rootNode || document.body);
  		},
  
  		/**
  		 *  判断target 的元素是否在我们的选择器数组里
           * @private
  		 * @param {String} selector 选择器内容
  		 * @param {Function} func 执行的回调
  		 */
  		_funcSelectorCheck: function(selector, func) {
  			var that = this;
  			return function(e) {
  				var target = e.target || e.srcElement;
  				if (/^(window|document(\.body)?)$/.test(selector)) {
  					func.apply(that, [/^window$/.test(selector) ? window :
  						/^document$/.test(selector) ? document : document.body].concat([].slice.call(arguments)));
  					return;
  				}
  				var sels = that._qSelector(selector);
  				var args = [], i = 0, ni = sels.length, elm, finder;
  				for (; i < ni; i++) {
  					elm = sels[i];
  					if (that.__funcCheckParentElm(target, elm)) {
  						args.push(elm);
  						finder = elm;
  						break;
  					}
  				}
  				if (!finder) {
  					return;
  				}
  				// FIXME, 由于我们需要用到this 指向我们的view, 所以, 我们改造了arguments, 将arguments的第一个实参改成了这个element (但是不一定是target)
  				func.apply(that, args.concat([].slice.call(arguments)));
  			};
  		},
  
  		/**
  		 *  判断是否该指针对象等于该节点对象或者在这个节点对象内
  		 * @param {Object} target 当前的指针对象
  		 * @param {Object} elm 需要对比的节点对象(htmlElment)
  		 */
  		__funcCheckParentElm: function(target, elm) {
  			if (target === elm) {
  				return true;
  			}
  			var _target = target;
  			while (_target !== this.rootNode && _target !== elm && _target !== null) {
  				_target = _target.parentNode;
  				if (_target === elm) {
  					return true;
  				}
  			}
  			return false;
  		},
  
  
  		/**
  		 *
   		 * FIXME 简单选择器 未完成
   		 * @param {String} selector				选择的内容
   		 *
  		 */
  		__querySelectorAll: function(selector) {
  			return SimpleSizzle(selector, parent || document.body);
  		},
  
  		/**
  		 * 通过传递进来的event判断是否特殊的内容
  		 * @param {String} selector			选择的内容
  		 */
  		__getRootNodeBySelector: function(selector) {
  			return /^window$/.test(selector) ? window :
  					/^document$/.test(selector) ? document :
  						/^document\.body$/.test(selector) ? document.body : this.rootNode;
  		},
  
  		
      /**
       * @private
       * 给dom 和被触发的事件 绑定事件
       */
  		_eventBind: function() {
  			if (!this.rootNode) {
  				return;
  			}
  			var events = this.events,
  				p, event, type,
  				selector, he, fn;
  			// 绑定 dom 事件
  			for (p in events) {
  				event = p.split(/ \:\: /);
  				type = event[0];
  				selector = event[1];
  				fn = events[p];
  				he = this._domEvts[p] = {
  					type: type,
  					selector: this.__getRootNodeBySelector(selector),
  					func: this._funcSelectorCheck(selector, fn)
  				};
  				rce.domEvtBind(he.selector, type, he.func);
  			}
  
  			// 绑定需要订阅到事件
  			var triggers = this.triggers;
  			for (p in triggers) {
  				this.sub(p, triggers[p], this);
  			}
  
  			// 提供对于controls 的简便操作方式
  			var rcc = rc.controls,
  				ctrls = this.ctrlsMap;
  			if (rc.controls) {
  				for (p in ctrls) {
  					// 只要是 string 的说明都是我们会需要引入的control 对象
  					if (typeof ctrls[p] === 'string') {
  						// 来自view 的启动通常表示该module 肯定处于被激活状态
  						this.ctrlsMap[p] = rcc.get(ctrls[p], this._mdulName, true, this.rootNode);
  						this._ctrlsMap[p] = true;
  					}
  				}
  			}
  		},
  
  
          /**
           * 给dom 和被触发的事件 解绑事件
           */
  		_eventUnbind: function() {
  			if (!this.rootNode) {
  				return;
  			}
  			var p, domEvts = this._domEvts, it, triggers = this.triggers;
  			for (p in domEvts) {
  				it = domEvts[p];
  				rce.domEvtUnbind(it.selector, it.type, it.func);
  			}
  			this._domEvts = {};
  			for (p in triggers) {
  				this.removeSub(p, triggers[p]);
  			}
  			this.triggers = {};
  
  			// 销毁对于controls 的引用
  			var rcc = rc.controls,
  				ctrls = this.ctrlsMap,
  				_ctrls = this._ctrlsMap;
  			if (rc.controls) {
  				for (p in ctrls) {
  					// 调用我们自己组件的方法
  					if (_ctrls[p]) {
  						ctrls[p].funcDestroy && ctrls[p].funcDestroy();
  						delete _ctrls[p];
  					} else {
  						// 如果不是我们的组件，自带有destroy 的，则自己destroy掉
  						ctrls[p] && ctrls[p].destroy && ctrls[p].destroy();
  					}
  					delete ctrls[p];
  				}
  			}
  		},
  
  
  		/**
  		 *
  		 *  当module层得到数据时，对dom进行操作，根据区域（模块）进行划分，不同的name
  		 * @param {String} name
  		 * @param {Object} data
  		 * @param {Object} hashs
  		 */
  		update : function(name, data, hashs) {
  			var fn = this.updateMap[name];
  			if (!fn || !this.rootNode) {
  				throw Error('update method ' + name + ' do not defined.');
  				return;
  			}
  			fn.apply(this, [].slice.call(arguments, 1));
  		},
  
  		/**
  		 *  传入一个 args, 然后返回一个值.
           * @private
  		 * @param {String} type  所选择的类别
  		 * @param {String} name  所要选择的返回参数名
  		 * @param {Array} args		所需要返回的args 的数组
  		 */
  		_getFuncFromMap: function(type, name, args) {
  			var map = this[type];
  			if (!map) {
  				return;
  			}
  			var fn = map[name];
  			if (!this.rootNode || !fn) {
  				return;
  			}
  			return fn.apply(this, args);
  		},
  
  
  		/**
  		 *  是getResult 方法的兄弟篇，修改了必须要组装成数组才能够传递的方式
  		 * @param {String} name  所要选择的返回参数名
  		 */
  		getResult: function(name) {
  			var args = [].slice.call(arguments, 1);
  			return this._getFuncFromMap('getResultMap', name, args);
  		},
  
  
  		/**
  		 *  getMethod 方法的兄弟篇，修改了必须要组装成数组才能够传递的方式
  		 * @param {String} name  所要选择的返回参数名
  		 */
  		getMethod: function(name) {
  			var args = [].slice.call(arguments, 1);
  			return this._getFuncFromMap('methodsMap', name, args);
  		},
  
  		/**
  		 *  返回该ctrl 实例
  		 * @param {String} name  所要ctrl名
  		 * @param {String} method 需要传递的control 的方法名
  		 * @param {Array} args 会传递过去的参数
  		 */
  		getCtrl: function(name, method, args) {
  			var args2, ctrl = this.ctrlsMap[name];
  			if (!ctrl) {
  				return false;
  			}
  			if (arguments.length === 1) {
  				return ctrl;
  			} else if (arguments.length >= 2) {
  				args2 = [].slice.call(arguments, 1);
  				if (this._ctrlsMap[name]) {
  					// 对于我们的组件里的操作，可以允许通过多个实参直接呼起
  					return ctrl.getMethod.apply(ctrl, args2);
  				}
  				return ctrl[method] ?
  					ctrl[method].apply(ctrl, [].slice.call(arguments, 2)) : false;
  			}
  			return false;
  
  		},
  
  		/**
  		 * 引入pages 的暴露接口功能可以让用户减少对于外部的引用，返回一个方法集合, 具体的方法类别请查找pages.pagesInterface
  		 */
  		pages: rc.pages.pagesInterface(),
  
          /**
           *
           * 将挂在el元素下面的事件以及el对象销毁，并开放destroyFn方法，供其他的销毁事件处理
           */
  		funcDestroy: function() {
  			this.hide();
  			// 执行用户需要的destroy 操作
  			this.destroy && this.destroy();
  			this._hasRender = false;
  			if (this.rootNode) {
  				this._eventUnbind();
  				this.rootNode.parentNode && this.rootNode.parentNode.removeChild(this.rootNode);
  				this.rootNode = null;
  			}
  		},
  
  		/**
  		 * 以当前view的名义注册事件
  		 * @param {String} name				事件名称
  		 * @param {Function} callback		回调
  		 * @param {Object} context			上下文
  		 */
  		sub : function(name, callback, context) {
  			name = this.name + '.' + name;
  			return rc.sub(name, callback, context);
  		},
  
  		/**
  		 *  在该view下发布相应事件
  		 *
  		 * @param {String} name
  		 * @param {Object} params
  		 */
  		pub : function(name, params) {
  			name = this._uid + '.' + name;
  			var args = [name];
  			if (arguments.length > 1) {
  				args = args.concat([].slice.call(arguments, 1));
  			}
  			return rce.pub.apply(rce, args);
  		},
  
  		/**
  		 *
  		 *  移除事件
  		 * @param {String} name
  		 * @param {Function} callback
  		 */
  		removeSub : function(name, callback) {
  			name = this.name + '.' + name;
  			return rc.removeSub(name, callback);
  		}
  	};
  
  
  	rc.views = {
  		// views 的集合
  		_views: {},
  
  		/**
  		 * 从view 里开出一个全局的选择器操作出来
  		 * @param {}
  		 */
  		querySelector: document.querySelectorAll ? function(selector, context) {
  			return (context || document.body)['querySelectorAll'](selector);
  		} : function(selector, context) {
  			return SimpleSizzle(selector, context || document.body);
  		},
  
  		/**
  		 *
  		 *  定义一个view, 支持单个实参的传递
  		 * @param {Object} config
  		 */
  		define: function(config) {
  			if (this._views[config.name]) {
  				return;
  			}
  			this._views[config.name] = config;
  		},
  
  		/**
  		 *  获得一个view
  		 * @param {String} name
  		 */
  		get: function(name) {
  			var view = this._views[name];
  			if (!view) {
  				return false;
  			}
  			return new View(rc.util.deepClone(view));
  		},
  
  		/**
  		 *
   		 *  销毁一个view
   		 * @param {String} name
  		 */
  		destroy: function(name) {
  			var view = this.get(name);
  			if (!view) {
  				return false;
  			}
  			view.funcDestroy && view.funcDestroy();
  			delete _views[name];
  		},
  
  		init: function() {
  			rc.sub('VIEWS.GETVIEW', this.get, this);
  			rc.sub('VIEWS.DESTROYVIEW', this.destroy, this);
  		}
  	};
  })(window.Tatami);
  ;
  /**
   * @depend Tatami.events, Tatami.util
   * @by flyover
   */
  ;
  (function(rc) {
      if (!rc) {
          rc = window.Tatami = {};
      }
  
      function Log(config) {
          this.config = config;
  
  
          // 设置实例log的name
          this.name = config.name;
  
  
          // 配置输出哪些log
          this.isShowDebug = true;
          this.isShowError = true;
          //线上默认 false;
          this.isShowLog = true;
      }
  
      Log.prototype = {
          log: function() {
              if (this.isShowLog) {
                  console.log.apply(console, arguments);
                  rc.pub('LOGS.LOG', this._stringify(arguments), 'log', this.name);
              }
          },
  
          error: function() {
              if (this.isShowError) {
                  console.error.apply(console, arguments);
                  rc.pub('LOGS.ERROR', this._stringify(arguments), 'error', this.name);
              }
          },
  
          debug: function() {
              if (this.isShowDebug) {
                  console.info.apply(console, arguments);
                  rc.pub('LOGS.DEBUG', this._stringify(arguments), 'debug', this.name);
              }
          },
  
          _stringify: function(args) {
              var __stringify = function() {
                  var index;
                  var result = [], strContent, it;
                  for (index = 0; index < args.length; index++) {
                      it = args[index];
                      if (it instanceof Error) {
                          result.push(it.stack);
                      } else {
                          strContent = rc.util.jsonString ? rc.util.jsonString(it) : '';
                          if (!strContent) {
                              strContent = JSON.stringify(it);
                          }
                          result.push(strContent);
                      }
                  }
                  return result.join(' ');
              };
  
              try {
                  return __stringify();
              } catch (e) {
                  console.log(e);
                  return;
              }
          }
  
      };
  
      /**
       * @descript 我们会上报所有可能的错误日志，包括http 请求，js logs 等
       */
      rc.logs = {
  
          // 用户module/view/controls中实例化的构造函数
          Logs: Log,
  
          _limit: 1000,
  
          _logList: [],
  
          _wsReady: false,
  
          //  push到本地队列 标记
          _stopPush: false,
  
          /**
           * 加入到发送日志日志队列
           *
           * @param {Object} info
           */
          _push: function(info) {
              // 如果ws可以用了
              // 直接放入ws队列
              // 否则放入本地队列
              if (this._wsReady) {
                  // 直接调用ws方法
                  rc.ws && rc.ws.sendLog(info);
              } else {
                  // 限制本地队列大小
                  if (!this._stopPush && this._logList.length < this._limit) {
                      this._logList.push(info);
                  }
              }
          },
  
          /**
           * 构建标准的日志格式
           *
           * @param {String} type error/log/debug
           * @param {String} content
           */
          _buildInfo: function(content, type, from) {
              return {
                  type: type,
                  content: content,
                  from: from,
                  time: +new Date()
              };
          },
  
          /**
           * 收集log日志
           *
           * @param {String} content 日志
           * @param {String} type log/error/debug
           */
          _collectLog: function(content, type, from) {
              var info = this._buildInfo(content, type, from);
              // 放入发送队列
              this._push(info);
          },
  
          /**
           * 启动ws
           *
           */
          _enabledWs: function() {
              // 设置启动ws
              this._wsReady = true;
  
              // 设置停止往本地队列塞数据
              this._stopPush = true;
  
              var count = this._limit;
              // 处理缓存的数据
              while (this._logList.length && count--) {
                  this._push(this._logList.shift());
              }
          },
  
          /**
           * 关闭ws
           *
           */
          _disabledWs: function() {
              // 设置关闭ws
              this._wsReady = false;
  
              // 设置停止往本地队列塞数据
              this._stopPush = true;
  
              // 既然不启动ws
              // 直接清空本地数据队列
              this._logList.length = 0;
          },
  
          _extend: function(obj) {
              var key;
              for (key in obj) {
                  if (this[key] === void 0) this[key] = obj[key];
              }
          },
  
          init: function(conf) {
              rc.sub('LOGS.LOG', this._collectLog, this);
              rc.sub('LOGS.ERROR', this._collectLog, this);
              rc.sub('LOGS.DEBUG', this._collectLog, this);
  
              // 自定义事件监听
              conf && rc.util.map(conf.logs, function(fun, eventName) {
                  rc.sub(eventName, fun, this);
              }, this);
  
              // 监听ws事件
              rc.sub('PLUGINS.WS.ENABLED', this._enabledWs, this);
              rc.sub('PLUGINS.WS.DISABLED', this._disabledWs, this);
  
              // 实例Log
              // 给本身增加log/debug/error方法
              this._extend(new Log({
                  name: 'globel'
              }));
          },
      };
  
  })(window.Tatami);
  ;
  
  ;(function(rc) {
  	/*
  		opt:
  			api 请求地址
  			type:post/get
  			params:{} 请求数据
  		success:成功回调函数
  		fail:失败回调函数
  	after
  		所有过滤器通过后执行的方法,一般为请求ajax的方法
  
  		过滤器格式:
  			必须有filter方法
  			如果要中断之后的所有过滤器并返回,return false
  	*/
  	function blank(obj){
  		if(typeof obj === 'undefined' || obj === null){
  			return true;
  		}
  		return false;
  	}
  
  	function equals(obj1,obj2){
  		var equal = true;
  		if(blank(obj1) && blank(obj1)){
  			equal = true;
  		}
  		if(!blank(obj1) && !blank(obj2)){
  			var obj1i = 0;
  			var obj2i = 0;
  			for(var key in obj1){
  				obj1i++;
  				if(obj1[key]!=obj2[key]){
  					equal = false;
  					break;
  				}
  			}
  			if(equal){
  				for(var key in obj2){
  					obj2i++;
  					if(obj1[key]!=obj2[key]){
  						equal = false;
  						break;
  					}
  				}
  			}
  			if(obj1i!==obj2i){
  				equal = false;
  			}
  		}
  		return equal;
  	}
  
  	function data_filter(conf,context){
  		var self = this;
  		self.url = conf.url;
  		self.effect = conf.effect||[];
  		self.expire = conf.expire;
  		self.get = function(params,callback,fail){
  			var __update = false;
  			if(!__update){
  				if(self.updateTime){
  					if((new Date().getTime()-(self.updateTime||0))>self.expire){
  						__update = true;
  					}
  				}
  				if(!equals(self.params,params)){
  					__update = true;
  				}
  				if(!self.data || !self.updateTime){
  					__update = true;
  				}
  			}
  			if(__update){
  				context.request({
  					api: self.url,
  					params:params
  				}, function(data) {
  					self.data = data;
  					self.updateTime = new Date().getTime();
  					(typeof callback === 'function')&&callback(data);
  				}, function(data) {
  					(typeof fail === 'function')&&fail(data);
  				});
  			}else{
  				(typeof callback === 'function')&&callback(self.data);
  			}
  			self.params = params;
  		}
  
  		self.clear = function(){
  			self.data = undefined;
  			self.updateTime=0;
  		}
  		if(conf.init && (typeof conf.init === 'function')){
  			conf.init(this);
  		}
  	}
  
  	rc.filter = {
  		_requestIndex:0,
  		_requestList:[],
  		send_request:function(args){
  			var options = args.options,
  				success = args.success,
  				fail = args.fail;
  
  			var reqKey = "filter" + '::' + options.api + '::' + (+new Date()) + '::' + (this._requestIndex ++);
  			this._requestList[reqKey] = {
  				isHideLoading: options.isHideLoading,
  				isHideSuccess: options.isHideSuccess,
  				isHideError: options.isHideError,
  				success: success,
  				fail: fail
  			};
  			var params = {
  				api: options.api,
  				isSync:options.isSync,
  				filterName: "filter",
  				reqKey: reqKey,
  				act: 'request',
  				params: options.params
  			}
  			rc.pub('SERVER.REQUEST_SEND', params);
  		},
  		request:function(options,success,fail){
  			var params = {
  				options: options,
  				success:success,
  				fail:fail
  			}
  			rc.pub('FILTER.REQUEST_SEND', params);
  		},
  		filter_list:[],
  		// dataMap:{},
  		response: function(params) {
  			var req = this._requestList[params.reqKey],
  				that = this,
  				funcComplete = function(func) {
  						func && func.apply(that, [].slice.call(arguments).slice(1));
  					};
  			switch(params.status) {
  				case 'success':
  					funcComplete(req.success, params.response);
  					break;
  				case 'fail':
  					funcComplete(req.fail, params.response, params);
  					break;	
  			}
  			// 得到请求回馈后，删除之前的请求链
  			delete this._requestList[params.reqKey];
  		},
  		init:function(conf){
  			if (!conf.plugins || !conf.plugins.filter) {
  				return;
  			}
  			// if(!conf.plugins.filter.filters && !conf.plugins.filter.dataMap){
  			if(!conf.plugins.filter.filters){
  				return;
  			}
  			if(conf.plugins.filter.filters){
  				this.filter_list = conf.plugins.filter.filters;
  			}
  			// if(conf.plugins.filter.dataMap){
  			// 	this._init_dataMap_filter(conf.plugins.filter.dataMap);
  			// }
  			rc.sub('SERVER.REQUEST_RESPONSE.OTHERS', this.response, this);
  			rc.sub('FILTER.REQUEST_SEND', this.send_request, this);
  		},
  		// _init_dataMap_filter:function(dm){
  		// 	for(var key in dm){
  		// 		if(dm[key].url){
  		// 			this.dataMap[key] = new data_filter(dm[key],this);
  		// 		}
  		// 	}
  		// },
  		need_filter:function(url,list){
  			for(var i=0,length=list.length;i<length;i++){
  				if(typeof list[i] === 'string' && list[i] == url){
  					return true;
  				}
  				if(list[i].test&&list[i].test(url)){
  					return true;
  				}
  			}
  			return false;
  		},
  		_to_filterlist:function(opt, success, fail,after){
  			if(!this.filter_list || this.filter_list.length==0){
  				after(opt, success, fail);
  				return;
  			}
  			var _this = this;
  			var num = 0;
  			var next = function(opt, success, fail){
  				var next_filter = _this.filter_list[num++];
  				if(next_filter){
  					if(_this.need_filter(opt.api,next_filter.filter_list||[])){
  						var result = next_filter.filter && next_filter.filter(opt, success, fail, next);
  					}else{
  						next(opt, success, fail);
  					}
  				}else{
  					after(opt, success, fail);
  				}
  			}
  			next(opt, success, fail);
  		},
  		dofilter:function(opt, success, fail,after){
  			//对dataMap进行过滤,判断是否是dataMap里的请求,是直接返回该数据,判断该次请求是否会对dataMap里的数据产生影响,会的话清空dataMap里的数据
  			// var url = opt.api,item,key,item_url;
  			// if(url.indexOf("?")!=-1){
  			// 	url = url.substr(0,url.indexOf("?"));
  			// }
  			// if(url.charAt(0)!='/'){
  			// 	url = "/"+url;
  			// }
  			// if(url.charAt(url.length-1)!='/'){
  			// 	url = url+"/";
  			// }
  			// for(key in this.dataMap){
  			// 	item = this.dataMap[key];
  			// 	item_url = item.url;
  			// 	if(item_url.indexOf("?")!=-1){
  			// 		item_url = item_url.substr(0,item_url.indexOf("?"));
  			// 	}
  			// 	if(item_url.charAt(0)!='/'){
  			// 		item_url = "/"+item_url;
  			// 	}
  			// 	if(item_url.charAt(item_url.length-1)!='/'){
  			// 		item_url = item_url+"/";
  			// 	}
  			// 	if(item_url===url){
  			// 		item.get(opt.params,success, fail);
  			// 		return;
  			// 	}else{
  			// 		//遍历effect
  			// 		for(var i=0,length=item.effect.length;i<length;i++){
  			// 			if(item.effect[i].test&&item.effect[i].test(url)){
  			// 				item.clear();
  			// 				break;
  			// 			}
  			// 		}
  			// 	}
  			// }
  
  			this._to_filterlist(opt, success, fail,after);
  		}
  	}
  
  	rc.dofilter = function(opt, success, fail,after){
  		rc.filter.dofilter(opt, success, fail,after);
  		return ;
  	}
  })(window.Tatami);;
  /**
   * @author Jerrod
   */
  ;(function(rc) {
  	if (!rc) {
  		rc = window.Tatami = {};
  	}
  	
  	var readyList = [];
  	
  	/*
  	 * 
  	 * 将需要在初始化完成之后发送的内容放到这个里面去
  	 * @param{Object}order 传入的指令
  	 * @param order.key: 对应的功能块
  	 * @param order.act: [可选]对应的功能块里的子集，可以省略
  	 * @param order.value: 对应的当前的内容
  	 */
  	function getReadyList(order) {
  		readyList.push(order);
  	}
  	
  	/**
  	 * 开始分配各个需要在初始化之后发送的内容
  	 * @param {Function} callback				执行完成所有的init 之后传递的回调
  	 */
  	function resolveReadyList(callback) {
  		rc.util.map(readyList, function(o) {
  			rc.pub('TATAMI.FEATURESTART.' + o.key, o);
  		});
  		callback && callback();
  	}
  	
  	/**
  	 * 
  	 * Tatami 对于自身
  	 * @param {Object} conf							初始化的时候需要配置的内容
  	 * @param {Function} callback					执行完成所有的init 之后传递的回调
  	 */
  	rc.init = function(conf, callback) {
  		// 最开始的时候收集那些需要在所有功能件初始化完成之后的任务
  		this.sub('TATAMI.FEATUREREADY', getReadyList, this, true);
  		
  		// 初始化事件管理器
  		this.events.init(conf);
  		// 初始化请求管理器
  		this.request.init(conf);
  		// 初始化模块管理器
  		this.modules.init(conf);
  		// 初始化视图管理器
  		this.views.init(conf);
  		// 组件管理器
  		// this.controls.init(conf);
  		// 初始化路由管理器
  		this.pages.init(conf);
  		// 错误日志的上报等处理
  		// this.error.init(conf);
          // 日志信息上报处理
          this.logs.init(conf);
  		// 初始化util管理器
  		this.util.init(conf);
  		// 本地缓存部分的加载
  		// this.localcache.init(conf);
  		this.filter.init(conf);
  		// 向订阅了任务的所有功能件派发收集之后的任务
  		resolveReadyList(callback);
  	};
  })(window.Tatami);
  ;
  
  module.exports = window.Tatami

});
